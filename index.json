[{"content":"è¿›è¡Œæ·±åº¦å­¦ä¹ å®è·µçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æ‰€éœ€è¦åšçš„ä¸ä»…ä»…åªæ˜¯æ­å»ºå¥½æ¨¡å‹ï¼Œå¦‚ä½•é€šè¿‡ä¸€ç³»åˆ—çš„æŠ€å·§æ¥è®­ç»ƒå‡ºä¸€ä¸ªè¾ƒä¸ºä¼˜ç§€çš„æ¨¡å‹ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚æ²¡æœ‰è®­ç»ƒå¥½çš„æ¨¡å‹ä½œä¸ºè¯æ˜å°±ç®—æ¨¡å‹æ¶æ„å†å¥½ä¹Ÿæ— æ³•è¯´æ˜æå‡ºçš„æ¨¡å‹çš„ä¼˜è¶Šæ€§ï¼Œè¿™ä¸€ç¯‡åšå®¢ä¸»è¦ä»‹ç»æˆ‘ä»¬å¯ä»¥ä»å“ªäº›æ–¹é¢æ¥ä¼˜åŒ–æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚\nä¼˜åŒ–å™¨ ä¼˜åŒ–å™¨æ˜¯æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„æˆåˆ†ï¼Œä½¿ç”¨ä¸åŒç§ç±»çš„ä¼˜åŒ–å™¨æœ‰æ—¶ä¼šå¯¹è®­ç»ƒçš„è¿‡ç¨‹äº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼ŒåŒæ—¶ä¼˜åŒ–å™¨ä¸­ä¸€äº›è¶…å‚æ•°çš„é€‰æ‹©æœ‰æ—¶å€™ä¹Ÿä¼šå¯¹è®­ç»ƒè¿‡ç¨‹äº§ç”Ÿå¾ˆå¤§çš„å½±å“ã€‚ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„ä¼˜åŒ–å™¨ä»¥åŠå…¶ä¸­çš„è¶…å‚æ•°ä»‹ç»ï¼š\nä»‹ç»ä¼˜åŒ–å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆå®šä¹‰è®­ç»ƒé›†$ \\mathcal{D}_{train} $\n$$ \\mathcal{D}_{train} = \\begin{cases} \\lbrace \\mathbf{x_{i}}\\rbrace_{i=1}^{N_{train}} \u0026 no\\:labels \\\\ \\lbrace (\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N_{train}} \u0026 labels \\end{cases} $$ ç„¶åä»è®­ç»ƒé›†ä¸­é‡‡é›†åŒ…å«$ B_{s} $ä¸ªæ ·æœ¬çš„å°æ‰¹é‡$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ï¼Œä¸‹é¢åœ¨ä¸Šé¢çš„è®¾å®šä¸‹ä»‹ç»å„ä¸ªä¼˜åŒ–å™¨ï¼Œä¸ºäº†é€‚åº”æœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æƒ…å†µæœ€ç»ˆæ‰€è®¡ç®—çš„æŸå¤±æˆ‘ä»¬ç»Ÿä¸€è®°ä¸º$ \\mathcal{L}(\\mathbf{x}, \\boldsymbol{\\theta}) $ã€‚\nSGDä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{\\theta}_{t + 1} = \\boldsymbol{\\theta}_{t} - \\eta\\: \\boldsymbol{g}_{t}\\quad \u0026\\text{(update the parameters)} \\end{array} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚\nä½¿ç”¨NesterovåŠ¨é‡çš„SGDä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\textcolor{red}{\\tilde{\\boldsymbol{\\theta}}_{t}} = \\boldsymbol{\\theta}_{t} + \\alpha\\textcolor{blue}{\\boldsymbol{v}_{t}} \\quad \u0026\\text{(look ahead to the future position)} \\\\ \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\textcolor{red}{\\tilde{\\boldsymbol{\\theta}}_{t}})\\quad \u0026\\text{(compute gradient at the lookahead position)} \\\\ \\textcolor{blue}{\\boldsymbol{v}_{t+1}} = \\alpha\\textcolor{blue}{\\boldsymbol{v}_{t}} - \\eta\\boldsymbol{g}_{t} \\quad \u0026\\text{(update the velocity)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} + \\textcolor{blue}{\\boldsymbol{v}_{t+1}}\\quad \u0026\\text{(update the parameters)} \\end{array} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\alpha $è¡¨ç¤ºåŠ¨é‡å‚æ•°ï¼Œ$ \\boldsymbol{v}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹é€Ÿåº¦ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚\nRMSPropä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{r}_{t+1} = \\rho\\boldsymbol{r}_{t} + (1 - \\rho)\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t} \\quad \u0026\\text{(update the running average of squared gradients)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\frac{\\eta}{\\sqrt{ \\delta + \\boldsymbol{r}_{t+1} }}\\circ \\boldsymbol{g}_{t} \\quad \u0026\\text{(update the parameters with the adaptive scaling)} \\end{array} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho $è¡¨ç¤ºè¡°å‡é€Ÿç‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚\nä½¿ç”¨NesterovåŠ¨é‡çš„RMSPropä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\textcolor{red}{\\tilde{\\boldsymbol{\\theta}}_{t}} = \\boldsymbol{\\theta}_{t} + \\alpha\\textcolor{blue}{\\boldsymbol{v}_{t}} \\quad \u0026\\text{(look ahead to the future position)} \\\\ \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\textcolor{red}{\\tilde{\\boldsymbol{\\theta}}_{t}})\\quad \u0026\\text{(compute gradient at the lookahead position)} \\\\ \\textcolor{purple}{\\boldsymbol{r}_{t+1}} = \\rho\\textcolor{purple}{\\boldsymbol{r}_{t}} + (1 - \\rho)\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t} \\quad \u0026\\text{(update the running average of squared gradients)} \\\\ \\textcolor{blue}{\\boldsymbol{v}_{t+1}} = \\alpha\\textcolor{blue}{\\boldsymbol{v}_{t}} - \\frac{\\eta}{\\sqrt{ \\delta + \\textcolor{purple}{\\boldsymbol{r}_{t+1}} }}\\circ\\boldsymbol{g}_{t} \\quad \u0026\\text{(update the velocity with adaptive scaling)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} + \\textcolor{blue}{\\boldsymbol{v}_{t+1}}\\quad \u0026\\text{(update the parameters)} \\end{array} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho $è¡¨ç¤ºè¡°å‡é€Ÿç‡ï¼Œ$ \\alpha $è¡¨ç¤ºåŠ¨é‡å‚æ•°ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ï¼Œ$ \\boldsymbol{v}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹é€Ÿåº¦ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚\nAdamä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{s}_{t+1} = \\rho_{1}\\boldsymbol{s}_{t} + (1 - \\rho_{1})\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased first momentum)} \\\\ \\boldsymbol{r}_{t+1} = \\rho_{2}\\boldsymbol{r}_{t} + (1 - \\rho_{2})\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased second momentum)} \\\\ \\hat{\\boldsymbol{s}}_{t+1}, \\hat{\\boldsymbol{r}}_{t+1} = \\frac{\\boldsymbol{s}_{t+1}}{1 - \\rho_{1}^{t + 1}}, \\frac{\\boldsymbol{r}_{t+1}}{1 - \\rho_{2}^{t + 1}}\\quad\u0026\\text{(bias correction of first momentum and second momentum)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta \\:\\cdot\\frac{\\hat{\\boldsymbol{s}}_{t+1}}{\\delta + \\sqrt{ \\hat{\\boldsymbol{r}}_{t+1} }} \\quad\u0026\\text{(update the parameters)} \\end{array} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho_{1} $å’Œ$ \\rho_{2} $è¡¨ç¤ºä¸€é˜¶çŸ©ä¼°è®¡å’ŒäºŒé˜¶çŸ©ä¼°è®¡çš„è¡°å‡é€Ÿç‡ï¼Œ$ \\boldsymbol{s}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å˜é‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚\nä½¿ç”¨NesterovåŠ¨é‡çš„Adamä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{s}_{t+1} = \\rho_{1}\\boldsymbol{s}_{t} + (1 - \\rho_{1})\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased first momentum)} \\\\ \\boldsymbol{r}_{t+1} = \\rho_{2}\\boldsymbol{r}_{t} + (1 - \\rho_{2})\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased second momentum)} \\\\ \\hat{\\boldsymbol{s}}_{t+1}, \\hat{\\boldsymbol{r}}_{t+1} = \\frac{\\boldsymbol{s}_{t+1}}{1 - \\rho_{1}^{t + 1}}, \\frac{\\boldsymbol{r}_{t+1}}{1 - \\rho_{2}^{t + 1}}\\quad\u0026\\text{(bias correction of first momentum and second momentum)} \\\\ \\textcolor{red}{\\tilde{\\boldsymbol{s}}_{t+1}}=\\rho_{1}\\hat{\\boldsymbol{s}}_{t+1}+\\frac{1-\\rho_{1}}{1-\\rho_{1}^{t+1}}\\boldsymbol{g}_{t}\\quad\u0026\\text{(lookahead adjustment of first momentum)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta \\:\\cdot\\frac{\\textcolor{red}{\\tilde{\\boldsymbol{s}}_{t+1}}}{\\delta + \\sqrt{ \\hat{\\boldsymbol{r}}_{t+1} }} \\quad\u0026\\text{(update the parameters)} \\end{array} $$ åŒæ ·ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho_{1} $å’Œ$ \\rho_{2} $è¡¨ç¤ºä¸€é˜¶çŸ©ä¼°è®¡å’ŒäºŒé˜¶çŸ©ä¼°è®¡çš„è¡°å‡é€Ÿç‡ï¼Œ$ \\boldsymbol{s}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å˜é‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚ä½¿ç”¨NesterovåŠ¨é‡çš„Adamä¼˜åŒ–å™¨ä¸Adamçš„åŒºåˆ«ï¼šæå‰é¢„çŸ¥ä¸€é˜¶çŸ©åŠ¨é‡$ \\tilde{\\boldsymbol{s}}_{t+1} $ã€‚\nAdamaxä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{s}_{t+1} = \\rho_{1}\\boldsymbol{s}_{t} + (1 - \\rho_{1})\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased first momentum)} \\\\ \\boldsymbol{r}_{t+1} = \\max(\\rho_{2}\\boldsymbol{r}_{t}, \\lvert \\boldsymbol{g}_{t} \\rvert )\\quad\u0026\\text{(update exponentially weighted infinity norm)} \\\\ \\hat{\\boldsymbol{s}}_{t+1} = \\frac{\\boldsymbol{s}_{t+1}}{1 - \\rho_{1}^{t + 1}}\\quad\u0026\\text{(bias correction of the first momentum)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta \\:\\cdot\\frac{\\hat{\\boldsymbol{s}}_{t+1}}{\\delta + \\boldsymbol{r}_{t+1}} \\quad\u0026\\text{(update the parameters)} \\end{array} $$ åŒæ ·ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho_{1} $å’Œ$ \\rho_{2} $è¡¨ç¤ºä¸€é˜¶çŸ©ä¼°è®¡å’Œæ— ç©·èŒƒæ•°çš„è¡°å‡é€Ÿç‡ï¼Œ$ \\boldsymbol{s}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å˜é‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦æ— ç©·èŒƒæ•°å˜é‡ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚Adamaxä¼˜åŒ–å™¨å’ŒAdamä¼˜åŒ–å™¨çš„åŒºåˆ«ï¼šä½¿ç”¨æ— ç©·èŒƒæ•°æ¥ä»£æ›¿äºŒé˜¶çŸ©ä¼°è®¡ã€‚\nAdamWä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{s}_{t+1} = \\rho_{1}\\boldsymbol{s}_{t} + (1 - \\rho_{1})\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased first momentum)} \\\\ \\boldsymbol{r}_{t+1} = \\rho_{2}\\boldsymbol{r}_{t} + (1 - \\rho_{2})\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased second momentum)} \\\\ \\hat{\\boldsymbol{s}}_{t+1}, \\hat{\\boldsymbol{r}}_{t+1} = \\frac{\\boldsymbol{s}_{t+1}}{1 - \\rho_{1}^{t + 1}}, \\frac{\\boldsymbol{r}_{t+1}}{1 - \\rho_{2}^{t + 1}}\\quad\u0026\\text{(bias correction of first momentum and second momentum)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta \\:\\cdot\\frac{\\hat{\\boldsymbol{s}}_{t+1}}{\\delta + \\sqrt{ \\hat{\\boldsymbol{r}}_{t+1} }}-\\eta\\:\\cdot \\lambda\\boldsymbol{\\theta}_{t} \\quad\u0026\\text{(separates weight decay from adaptive gradient scaling, ensuring true L2 regularization)} \\end{array} $$ åŒæ ·ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho_{1} $å’Œ$ \\rho_{2} $è¡¨ç¤ºä¸€é˜¶çŸ©ä¼°è®¡å’ŒäºŒé˜¶çŸ©ä¼°è®¡çš„è¡°å‡é€Ÿç‡ï¼Œ$ \\lambda $è¡¨ç¤º$ \\text{L2} $æ­£åˆ™é¡¹ç³»æ•°ã€‚$ \\boldsymbol{s}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å˜é‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚AdamWä¼˜åŒ–å™¨å’ŒAdamä¼˜åŒ–å™¨çš„ä¸»è¦åŒºåˆ«ï¼šæŠŠ$ \\text{L2} $æ­£åˆ™åŒ–ä»æ¢¯åº¦æ›´æ–°ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œé˜²æ­¢æ­£åˆ™åŒ–ä¸çº¯ç²¹ã€‚\nRAdamä¼˜åŒ–å™¨ $$ \\begin{array}{l} \\boldsymbol{g}_{t} = \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t})\\quad \u0026\\text{(compute gradient at the current position)} \\\\ \\boldsymbol{s}_{t+1} = \\rho_{1}\\boldsymbol{s}_{t} + (1 - \\rho_{1})\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased first momentum)} \\\\ \\boldsymbol{r}_{t+1} = \\rho_{2}\\boldsymbol{r}_{t} + (1 - \\rho_{2})\\boldsymbol{g}_{t}\\circ\\boldsymbol{g}_{t}\\quad\u0026\\text{(update the biased second momentum)} \\\\ \\hat{\\boldsymbol{s}}_{t+1}, \\hat{\\boldsymbol{r}}_{t+1} = \\frac{\\boldsymbol{s}_{t+1}}{1 - \\rho_{1}^{t + 1}}, \\frac{\\boldsymbol{r}_{t+1}}{1 - \\rho_{2}^{t + 1}}\\quad\u0026\\text{(bias correction of first momentum and the second momentum)} \\\\ \\gamma_{t + 1} = \\gamma_{\\infty} - \\frac{2(t+1)\\rho_{2}^{t+1}}{1 - \\rho_{2}^{t+1}}\\quad \u0026\\text{(compute the length of the approximated SMA)} \\\\ \\begin{cases} \\psi_{t+1} = \\sqrt{ \\frac{(\\gamma_{t+1} - 4)(\\gamma_{t+1} - 2)\\gamma_{\\infty}}{(\\gamma_{\\infty} - 4)(\\gamma_{\\infty} - 2)\\gamma_{t+1}} }\\quad\u0026\\text{(compute the variance rectification term)} \\\\ \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta\\:\\cdot \\psi_{t+1}\\frac{\\hat{\\boldsymbol{s}}_{t+1}}{\\delta + \\sqrt{ \\hat{\\boldsymbol{r}}_{t+1}} } \\quad\u0026\\text{(update the parameters with adaptive momentum)} \\end{cases}\\quad\u0026(\\text{if}\\:\\gamma_{t+1} \u003e 4) \\\\ \\begin{cases} \\boldsymbol{\\theta}_{t+1} = \\boldsymbol{\\theta}_{t} - \\eta\\:\\cdot \\hat{\\boldsymbol{s}}_{t+1}\\quad\\quad\\quad\\quad\\quad\u0026\\text{(update the parameters with un-adaptive momentum)} \\end{cases} \\quad\u0026\\text{(else)} \\end{array} $$ åŒæ ·ä¸Šè¿°å…¬å¼ä¸­$ \\eta $è¡¨ç¤ºå­¦ä¹ ç‡ï¼Œ$ \\delta $è¡¨ç¤ºä¸€ä¸ªè¾ƒå°çš„å¸¸æ•°ï¼Œç”¨äºè¢«å°æ•°é™¤æ—¶çš„æ•°å€¼ç¨³å®šï¼Œ$ \\rho_{1} $å’Œ$ \\rho_{2} $è¡¨ç¤ºä¸€é˜¶çŸ©ä¼°è®¡å’ŒäºŒé˜¶çŸ©ä¼°è®¡çš„è¡°å‡é€Ÿç‡ã€‚$ \\boldsymbol{s}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å˜é‡ï¼Œ$ \\boldsymbol{r}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹ç´¯ç§¯æ¢¯åº¦å¹³æ–¹å˜é‡ï¼Œ$ \\gamma_{\\infty}=\\frac{2}{1-\\rho_{2}} - 1 $è¡¨ç¤ºè®¡ç®—çš„è¿‘ä¼¼SMAçš„æœ€å¤§é•¿åº¦ã€‚$ \\boldsymbol{\\theta}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹å‚æ•°ï¼Œ$ \\boldsymbol{\\theta}_{t+1} $è¡¨ç¤ºåœ¨å¤„ç†è¿‡å°æ‰¹é‡æ•°æ®$ \\lbrace\\mathbf{x}^{1}, \\mathbf{x}^2, \\dots, \\mathbf{x}^{B_{s}}\\rbrace $ä¹‹åç¬¬$ t+1 $æ­¥çš„æ¨¡å‹å‚æ•°ã€‚å…¶ä¸Adamä¼˜åŒ–å™¨çš„åŒºåˆ«æ˜¯)ï¼ŒRAdamæå‡ºäº†ä¸€ä¸ªæ–¹å·®æ ¡æ­£å› å­$ \\psi $(rectification term)ï¼Œè‡ªåŠ¨è°ƒæ•´æœ‰æ•ˆå­¦ä¹ ç‡ï¼Œè®©ä¼˜åŒ–åœ¨åˆæœŸæ›´åŠ ç¨³å®šã€‚\nè°ƒåº¦å™¨ ä¸Šé¢ä¸€èŠ‚ä¸­ä¼˜åŒ–å™¨ä¸­çš„è¶…å‚æ•°å­¦ä¹ ç‡$ \\eta $æˆ‘ä»¬è®¾å®šæˆäº†å›ºå®šå€¼ï¼Œä½†æ˜¯åœ¨çœŸæ­£å®è·µä¸­æˆ‘ä»¬å¯ä»¥è®¾å®šå­¦ä¹ ç‡$ \\eta $éšç€$ \\text{epoch} $å˜åŒ–($ \\text{epoch-based} $)æˆ–è€…éšç€$ \\text{step} $å˜åŒ–($ \\text{step-based} $)ï¼Œè¿™äº›å˜åŒ–æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒåº¦å™¨æ¥è¿›è¡Œå®ç°ï¼Œä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€äº›å¸¸è§çš„è°ƒåº¦å™¨ã€‚\nä½™å¼¦è°ƒåº¦å™¨ ç”±å›¾å¯çŸ¥ï¼Œ`$ \\text{step-based} $`çš„ä½™å¼¦è°ƒåº¦å™¨åœ¨æ¯ä¸ª`$ \\text{step} $`éƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè€Œ`$ \\text{epoch-based} $`çš„ä½™å¼¦è°ƒåº¦å™¨åœ¨æ¯ä¸ª`$ \\text{epoch} $`å‘ç”Ÿå˜åŒ–ï¼Œè€Œåœ¨ç›¸é‚»ä¹‹é—´çš„`$ \\text{step} $`åŒºé—´ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œé€šå¸¸`$ \\text{1 epoch}=\\text{1 step}\\times \\text{num batches} $`ã€‚ $$ \\eta_{t} = \\eta_{min} + \\frac{1}{2}(\\eta_{max} - \\eta_{min})\\left( 1 + \\cos\\left( \\frac{t}{T_{\\text{max}}} \\pi\\right) \\right) $$ å…¶ä¸­$ t $è¡¨ç¤ºè°ƒåº¦çš„ç²’åº¦ï¼Œæ—¢å¯ä»¥æ˜¯$ \\text{step} $çº§åˆ«åˆå¯ä»¥æ˜¯$ \\text{epoch} $çº§åˆ«ã€‚\nçº¿æ€§è°ƒåº¦å™¨ åŒä½™å¼¦è°ƒåº¦å™¨çš„ç»˜åˆ¶è¯´æ˜ï¼Œçº¿æ€§è°ƒåº¦å™¨çš„å…¬å¼ä¸º $$ \\eta_{t} = \\eta_{\\text{max}} - \\frac{t}{T_{\\text{max}}}(\\eta_{\\text{max}} - \\eta_{\\text{min}}) $$ å…¶ä¸­$ t $è¡¨ç¤ºè°ƒåº¦çš„ç²’åº¦ï¼Œæ—¢å¯ä»¥æ˜¯$ \\text{step} $çº§åˆ«åˆå¯ä»¥æ˜¯$ \\text{epoch} $çº§åˆ«ã€‚\nå¤šé¡¹å¼è°ƒåº¦å™¨ åŒä½™å¼¦è°ƒåº¦å™¨ç»˜åˆ¶è¯´æ˜ï¼Œå¤šé¡¹å¼è°ƒåº¦å™¨çš„å…¬å¼ä¸º $$ \\eta_{t} = \\eta_{\\text{min}} + (\\eta_{\\text{max}} - \\eta_{\\text{min}})\\left( 1 - \\frac{t}{T_{\\text{max}}} \\right)^p $$ å…¶ä¸­$ t $è¡¨ç¤ºè°ƒåº¦çš„ç²’åº¦ï¼Œæ—¢å¯ä»¥æ˜¯$ \\text{step} $çº§åˆ«åˆå¯ä»¥æ˜¯$ \\text{epoch} $çº§åˆ«ã€‚$ p $è¡¨ç¤ºå¤šé¡¹å¼å¹‚æŒ‡æ•°ã€‚\né¢„çƒ­è°ƒåº¦å™¨ é¢„çƒ­è°ƒåº¦å™¨ä¸€èˆ¬æ˜¯ä½¿ç”¨`$ \\text{step} $`ç²’åº¦çº§åˆ«çš„çº¿æ€§å¢é•¿è°ƒåº¦ã€‚ä¹Ÿå°±æ˜¯ä¸Šå›¾ä¸­çš„5ä¸ª`$ \\text{epoch} $`ä¹‹å‰çš„è¿‡ç¨‹éƒ½å±äº`$ \\text{warmup} $`è¿‡ç¨‹ã€‚ æ¢¯åº¦ç´¯ç§¯ä¼˜åŒ– å½“ä½¿ç”¨å•å¡GPUè¿›è¡Œæ¨¡å‹è®­ç»ƒæ—¶å½“æˆ‘ä»¬çš„æ‰¹æ¬¡å¤§å°è®¾å®šè¿‡å¤§æ—¶ä¼šå‡ºç°æ˜¾å­˜ä¸è¶³çš„æƒ…å†µï¼Œæ‰€ä»¥å•å¡GPUå¾€å¾€è®¾å®šçš„æ‰¹æ¬¡å¤§å°åå°ä»¥é¿å…æ˜¾å­˜çˆ†ç‚¸ï¼Œä½†æ˜¯å°æ‰¹é‡çš„è®­ç»ƒæ–¹å¼å¾€å¾€ä¼šå¯¼è‡´å¤šä¸ªæ‰¹æ¬¡è®¡ç®—çš„æ¢¯åº¦ä¸ç¨³å®šï¼Œæœ€ç»ˆå¯¼è‡´æŸå¤±çš„æ”¶æ•›ä¸ç¨³å®šã€‚ä¸ºäº†è§£å†³ä¸Šè¿°å›°å¢ƒï¼Œä¸€ä¸ªæœ‰æ•ˆçš„è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ¢¯åº¦ç´¯ç§¯ä¼˜åŒ–ã€‚\nå‡è®¾å°æ‰¹é‡è®¾å®šä¸º$ b_{s} $ï¼Œç´¯ç§¯çš„å¤§æ‰¹é‡è®¾å®šä¸º$ B_{s} $ï¼Œä¹ æƒ¯ä¸Š$ B_{s}=n\\:\\cdot b_{s} $ï¼Œ$ n $è¡¨ç¤ºæ¢¯åº¦ç´¯ç§¯çš„$ \\text{step} $æ•°ã€‚æˆ‘ä»¬å¯ä»¥è¯æ˜$ n $ä¸ª$ b_{s} $æ‰¹æ¬¡æ¢¯åº¦ç´¯ç§¯ä¼˜åŒ–ç­‰ä»·äºä¸€æ¬¡$ B_{s} $æ‰¹æ¬¡æ¢¯åº¦ä¼˜åŒ–ã€‚\n$$ \\begin{align} \\boldsymbol{g}_{t} \u0026= \\frac{1}{n}\\sum_{i=1}^n\\boldsymbol{g}_{t}^i\\\\ \u0026= \\frac{1}{n}\\sum_{i=1}^n \\frac{1}{b_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{j=1}^{b_{s}}\\mathcal{L}(\\mathbf{x}_{i}^j, \\boldsymbol{\\theta}_{t}) \\\\ \u0026= \\frac{1}{nb_{s}}\\sum_{i=1}^n\\sum_{j=1}^{b_{s}}\\nabla_{\\boldsymbol{\\theta}}\\mathcal{L}(\\mathbf{x}_{i}^j, \\boldsymbol{\\theta}_{t}) \\\\ \u0026= \\frac{1}{B_{s}}\\nabla_{\\boldsymbol{\\theta}}\\sum_{i=1}^{B_{s}}\\mathcal{L}(\\mathbf{x}^i, \\boldsymbol{\\theta}_{t}) \\end{align} $$ æ ‡ç­¾å¹³æ»‘ æ ‡ç­¾å¹³æ»‘æ˜¯åˆ†ç±»ä»»åŠ¡é‡çš„ä¸€ç§æ­£åˆ™åŒ–æŠ€æœ¯ï¼Œå…¶æ€æƒ³æ˜¯å°†åŸæ¥çš„çœŸå®æ ‡ç­¾(one hotç¼–ç )è½¬æ¢ä¸ºâ€œè½¯åŒ–â€æ ‡ç­¾ã€‚åœ¨æ­£ç¡®ç±»åˆ«ä¸Šèµ‹äºˆ$ 1 - \\epsilon $çš„æ¦‚ç‡ï¼Œå†åœ¨å…¶ä»–ç±»åˆ«ä¸Šå‡åŒ€åˆ†é…$ \\epsilon $çš„æ¦‚ç‡ï¼Œå…¶ä¸­$ K $ä¸ºå¤šåˆ†ç±»çš„ç±»åˆ«æ€»æ•°ã€‚\nå…¶ä¸­æ ‡ç­¾åˆ†ç±»åˆ†å¸ƒå¦‚ä¸‹\n$$ p(y\\mid\\mathbf{z})=\\mathrm{softmax}_{y}(\\mathbf{z})=\\frac{\\exp[z_{y}]}{\\sum_{y'=1}^{K}\\exp[z_{y'}]} $$ å–è´Ÿ$ \\log $ä¹‹åå¾—åˆ°æŸå¤±å‡½æ•°\n$$ -\\log p(y\\mid\\mathbf{z})=-\\log[\\mathrm{softmax}_{y}(\\mathbf{z})]=-\\log\\left[\\frac{\\exp[z_{y}]}{\\sum_{y'=1}^{K}\\exp[z_{y'}]}\\right] $$ $$ -\\nabla_{\\mathbf{z}}\\log[\\mathrm{softmax}_{y}(\\mathbf{z})] = \\mathrm{softmax}(\\mathbf{z}) - \\mathbf{e}_{y} $$ ä¸Šè¿°æŸå¤±å‡½æ•°æ±‚å¾—æ¢¯åº¦ä¹‹åå¾—åˆ°çš„ç»“æœè¡¨æ˜äº†æˆ‘ä»¬æœ€ç»ˆä¼˜åŒ–çš„ç»“æœåº”è¯¥ä½¿å¾—$ \\mathrm{softmax}(\\mathbf{z}) $å’ŒçœŸå®æ ‡ç­¾åˆ†å¸ƒ$ \\mathbf{e}_{y} $å°½å¯èƒ½æ¥è¿‘ã€‚\nå¦‚æœæ˜¯å¹³æ»‘ä¹‹åçš„æ ‡ç­¾æ¨¡å‹è¾“å‡ºåˆ†ç±»åˆ†å¸ƒå’ŒçœŸå®æ ‡ç­¾åˆ†ç±»åˆ†å¸ƒå¦‚ä¸‹\n$$ p(y=k\\mid\\mathbf{z})=\\mathrm{softmax}_{k}(\\mathbf{z})=\\frac{\\exp[z_{k}]}{\\sum_{k'=1}^{K}\\exp[z_{k'}]} $$ $$ p(y=k) = q_{k} $$ ä¸¤ä¸ªåˆ†å¸ƒçš„äº¤å‰ç†µå¦‚ä¸‹ï¼Œæœ€å°åŒ–äº¤å‰ç†µç­‰ä»·äºæœ€å°åŒ–ä¸¤ä¸ªåˆ†å¸ƒçš„$ \\mathrm{KL} $æ•£åº¦ã€‚\n$$ H(p(y=k), p(y=k\\mid\\mathbf{z})) = -\\sum_{k=1}^K q_{k}\\log\\left[\\frac{\\exp[z_{k}]}{\\sum_{k'=1}^{K}\\exp[z_{k'}]}\\right] $$ $$ \\nabla_{\\mathbf{z}}H(p(y=k), p(y=k\\mid\\mathbf{z})) = \\mathrm{softmax}(\\mathbf{z}) - \\mathbf{y} $$ å¹³æ»‘æ ‡ç­¾ä¹‹åçš„æ¢¯åº¦ä½¿å¾—$ \\mathrm{softmax}(\\mathbf{z}) $å’Œå¹³æ»‘æ ‡ç­¾åˆ†å¸ƒ$ \\mathbf{y} $å°½å¯èƒ½æ¥è¿‘ã€‚\næŒ‡æ•°ç§»åŠ¨å¹³å‡ åœ¨ä¼˜åŒ–å™¨ä¸€èŠ‚ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»äº†ç§»åŠ¨å¹³å‡çš„æ€æƒ³ä½¿å¾—å­¦ä¹ ç‡çš„æ”¶ç¼©ä¸æ¢¯åº¦è¾ƒè¿‘çš„å†å²ä¿¡æ¯ç›¸å…³ã€‚è€Œæ¨¡å‹çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ä¸»è¦æ˜¯è¿›è¡Œæƒé‡çš„æŒ‡æ•°ç§»åŠ¨å¹³å‡ï¼Œä½¿å¾—æœ€ç»ˆå¾—åˆ°çš„æƒé‡å‚æ•°æ›´åŠ å¹³ç¨³ï¼Œä»è€Œæå‡æ³›åŒ–èƒ½åŠ›ã€‚\n$$ \\mathbf{ema}_{t+1} = \\rho \\cdot\\mathbf{ema}_{t} + (1 - \\rho)\\cdot \\mathbf{w}_{t} $$ $ \\mathbf{w}_{t} $è¡¨ç¤ºç¬¬$ t $æ­¥æ—¶çš„æ¨¡å‹æƒé‡ï¼Œ$ \\mathbf{ema}_{0}=\\mathbf{0} $è¡¨ç¤ºåˆå§‹æŒ‡æ•°ç§»åŠ¨å¹³å‡æƒé‡ã€‚\nè¿˜æœ‰ä¸€äº›å°$ \\mathrm{trick} $åŒ…æ‹¬æ¢¯åº¦è£å‰ªï¼ˆ$ \\tilde{\\boldsymbol{g}}_{t}=\\frac{\\mathrm{n_{max}}}{\\max(\\lvert \\lvert \\boldsymbol{g}_{t} \\rvert \\rvert_{p}^p, \\mathrm{n_{max}})}\\boldsymbol{g}_{t} $ï¼‰ã€æ—©åœç­–ç•¥ä»¥åŠæ··åˆç²¾åº¦è®¡ç®—ï¼ˆAMPï¼‰ä¹Ÿæœ‰æ—¶ä¹Ÿéƒ½å¯ä»¥ä¼˜åŒ–æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚\n","permalink":"https://fordelkon.github.io/posts/train_trick/","summary":"\u003cp\u003eè¿›è¡Œæ·±åº¦å­¦ä¹ å®è·µçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æ‰€éœ€è¦åšçš„ä¸ä»…ä»…åªæ˜¯æ­å»ºå¥½æ¨¡å‹ï¼Œå¦‚ä½•é€šè¿‡ä¸€ç³»åˆ—çš„æŠ€å·§æ¥è®­ç»ƒå‡ºä¸€ä¸ªè¾ƒä¸ºä¼˜ç§€çš„æ¨¡å‹ä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚æ²¡æœ‰è®­ç»ƒå¥½çš„æ¨¡å‹ä½œä¸ºè¯æ˜å°±ç®—æ¨¡å‹æ¶æ„å†å¥½ä¹Ÿæ— æ³•è¯´æ˜æå‡ºçš„æ¨¡å‹çš„ä¼˜è¶Šæ€§ï¼Œè¿™ä¸€ç¯‡åšå®¢ä¸»è¦ä»‹ç»æˆ‘ä»¬å¯ä»¥ä»å“ªäº›æ–¹é¢æ¥ä¼˜åŒ–æ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚\u003c/p\u003e","title":"æ·±åº¦å­¦ä¹ è®­ç»ƒæŠ€å·§"},{"content":"å‘ç°äº†ä¸€ä¸ªæ–°çš„GitHubçš„é¡¹ç›®ï¼Œå‘ç°è¦ä½¿ç”¨condaåº“æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒè£…ä¸€å¤§å †pythonåº“æ‰èƒ½è¿è¡Œèµ·æ¥è¿™ä¸ªé¡¹ç›®\u0026hellip;å¿ƒä¸­çš„æ¿€æƒ…ä¹‹ç«å·²ç»æµ‡ç­äº†ä¸€å¤§åŠğŸ˜’ï¼›è¿™æ—¶å€™åˆçªç„¶å‘ç°è¯¥é¡¹ç›®æ”¯æŒDockerç¯å¢ƒéƒ¨ç½²ï¼Œå¯ä»¥ç›´æ¥æ‹‰å–Dockeré•œåƒæ¥è¿è¡Œè¯¥é¡¹ç›®ï¼Œå¥½äº†ï¼Œå¿ƒä¸­å†æ¬¡ç‡ƒèµ·æ¿€æƒ…ä¹‹ç«ğŸ˜Šã€‚æ€»ä¹‹ï¼ŒDockerå¯ä»¥å¸®åŠ©æˆ‘ä¹ˆçœä¸‹é…ç¯å¢ƒçš„æ—¶é—´ï¼Œè€Œä¸”ä½ æ‹‰å–åˆ«äººå·²ç»å‘å¸ƒçš„é•œåƒä¸€èˆ¬æ˜¯åˆ«äººå·²ç»åœ¨å®¿ä¸»æœºä¸Šå·²ç»è·‘é€šçš„é•œåƒï¼Œé‚£ä¹ˆä¸ç®¡ä½ çš„å¹³å°æ˜¯ä»€ä¹ˆä½ ä¹Ÿä¸€å®šèƒ½è·‘é€šã€‚ä¸‹é¢è®©æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹çœ‹Dockerå§\u0026hellip;\nDockeråŸºæœ¬æ¦‚å¿µ å®¹å™¨ï¼ˆContainerï¼‰æ˜¯ä¸€ä¸ªéš”ç¦»çš„è¿›ç¨‹ï¼Œåœ¨ä¸»æœºæœºå™¨ä¸Šè¿è¡Œï¼Œä¸è¯¥ä¸»æœºä¸Šè¿è¡Œçš„æ‰€æœ‰å…¶ä»–è¿›ç¨‹éš”ç¦»ã€‚ é•œåƒï¼ˆImageï¼‰é•œåƒæ˜¯ä¸€ä¸ªåªè¯»æ¨¡æ¿ï¼ŒåŒ…å«åˆ›å»º Docker å®¹å™¨çš„æŒ‡ä»¤ã€‚ å®é™…ä¸Šä½ å¯ä»¥è¿™æ ·æ¥ç±»æ¯”é•œåƒå’Œå®¹å™¨ï¼Œå‰è€…æ˜¯ä¸€ä¸ªè£…äº†æ“ä½œç³»ç»Ÿçš„ç¡¬ç›˜ï¼Œä½†ä»–æ˜¯é™æ€çš„ï¼Œä¸èƒ½ç›´æ¥æ¥è¿è¡Œï¼Œåè€…æ˜¯ä¸€ä¸ªæ²¡æœ‰ç¡¬ç›˜çš„ç”µè„‘ï¼Œå¿…é¡»å®‰è£…ç¡¬ç›˜æ‰èƒ½è¿è¡Œå¯¹åº”çš„æ“ä½œç³»ç»Ÿã€‚å½“ç„¶è¿™æ ·çš„ç±»æ¯”æœ‰ç‚¹ç‘•ç–µï¼Œä½†æ˜¯å®¹å™¨å¯¹äºé•œåƒçš„ä¾èµ–æ€§å¯ä»¥å¾ˆå¥½åœ°ä½“ç°å‡ºæ¥ã€‚ æˆ‘ä»¬ä»é•œåƒå¯ä»¥åˆ›å»ºå‡ºæ— æ•°çš„å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥éšä¾¿å¯¹å·²ç»åˆ›å»ºçš„å®¹å™¨è¿›è¡Œå®éªŒï¼Œä¸æ€•æ‹…å¿ƒå…¶ä¸­çš„æ“ä½œç³»ç»Ÿå´©æºƒï¼Œå› ä¸ºæˆ‘ä»¬åªè¦åˆ é™¤è¿™ä¸ªå´©æºƒçš„ç³»ç»Ÿå†é‡å¼€å°±å¥½äº†ï¼ˆæœ‰ç‚¹åƒé‡ç”Ÿæµäº†ï¼‰ã€‚\nDockeræ“ä½œæµç¨‹ æ‹‰å–é•œåƒï¼ˆdocker pullï¼‰ è·å–å®¹å™¨è¿è¡Œæ‰€éœ€è¦çš„åŸºç¡€é•œåƒã€‚\ndocker pull [-aq] name[:tag|@digest] é€‰é¡¹å‚æ•°ï¼š -a ï¼šä¸‹è½½ä»“åº“ä¸­çš„æ‰€æœ‰æ ‡ç­¾é•œåƒ -q ï¼šæŠ‘åˆ¶è¯¦ç»†è¾“å‡º # ä¸æŒ‡å®šæ ‡ç­¾æ—¶é»˜è®¤ä½¿ç”¨:latestæ ‡ç­¾ docker pull debian # (== docker pull debian:latest) # Using default tag: latest # latest: Pulling from library/debian # e756f3fdd6a3: Pull complete # Digest: sha256:3f1d6c17773a45c97bd8f158d665c9709d7b29ed7917ac934086ad96f92e4510 # Status: Downloaded newer image for debian:latest # docker.io/library/debian:latest # é€šè¿‡æ‘˜è¦æ‹‰å–å¯ä»¥ç¡®ä¿è·å–ç‰¹å®šç‰ˆæœ¬çš„é•œåƒï¼Œè€Œä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ docker pull ubuntu@sha256:2e863c44b718727c860746568e1d54afd13b2fa71b160f5cd9058fc436217b30 åˆ›å»ºå¹¶å¯åŠ¨æ–°å®¹å™¨ï¼ˆdocker runï¼‰ æ ¹æ®é•œåƒåˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ã€‚docker runæœ¬èº«å¸¦æœ‰docker pullçš„åŠŸèƒ½ï¼Œå½“å®ƒåœ¨æœ¬åœ°é•œåƒåº“ä¸­æ‰¾ä¸åˆ°æ‰€æ‹‰å–çš„é•œåƒåç§°æ—¶ï¼Œå°±ä¼šå…ˆå»docker pullè¯¥é•œåƒäº†ï¼Œä¹‹åå†æ ¹æ®é•œåƒåˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ã€‚\ndocker run [options] name[:tag|@digest] [command] [arg...] é€‰é¡¹å‚æ•°ï¼š -d ï¼šåå°è¿è¡Œå®¹å™¨ï¼ˆâ€œdetachedâ€ æ¨¡å¼ï¼‰ã€‚å®¹å™¨åœ¨åå°è¿è¡Œï¼Œç»ˆç«¯ä¸ä¼šè¢«é˜»å¡ã€‚ -it ï¼šåˆ†é…äº¤äº’å¼ç»ˆç«¯ï¼Œå¯ä»¥è¿›å…¥å®¹å™¨å†…éƒ¨è¿›è¡Œäº¤äº’æ“ä½œã€‚ --name ï¼šä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„åå­—ã€‚ --rm ï¼šå½“å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤å®¹å™¨ã€‚ -p ï¼šç«¯å£æ˜ å°„ï¼Œå°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨å†…éƒ¨çš„ç«¯å£ï¼ˆå®¹å™¨å†…éƒ¨ç«¯å£æš´éœ²ç»™ä¸»æœºç«¯å£ï¼‰ã€‚ç”±äºå®¹å™¨é»˜è®¤æ˜¯éš”ç¦»çš„ï¼Œå¤–éƒ¨æ˜¯æ— æ³•è®¿é—®å®¹å™¨å†…çš„æœåŠ¡çš„ï¼Œå› æ­¤éœ€è¦åˆ›å»ºæ˜ å°„è§„åˆ™ï¼Œå…è®¸å¤–éƒ¨é€šè¿‡ä¸»æœºç«¯å£è®¿é—®å®¹å™¨å†…çš„æœåŠ¡ã€‚ -v ï¼šæŒ‚è½½å·ï¼Œå°†ä¸»æœºçš„ç›®å½•æˆ–æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨çš„ç›®å½•ã€‚ -e ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚ docker run --name test -d nginx:alpine docker run -p 8080:80 docker/welcome-to-doc docker run -it ubuntu /bin/bash # è¿›å…¥bashç»ˆç«¯ docker run --rm alpine echo \u0026#34;test\u0026#34; # test docker run -it --rm -v /home/delkon/compiler:/root/compiler maxxing/compiler-dev bash # -v /home/delkon/compiler:/root/compileré€‰é¡¹, è¿™ä¸ªé€‰é¡¹ä»£è¡¨: æˆ‘å¸Œæœ›æŠŠå®¿ # ä¸»æœºçš„ /home/delkon/compiler ç›®å½•, æŒ‚è½½ (mount) åˆ°å®¹å™¨ # çš„Â /root/compilerÂ ç›®å½•. è¿™æ ·, åœ¨è¿›å…¥å®¹å™¨ä¹‹å, æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿ # é—®Â /root/compilerÂ æ¥è®¿é—®å®¿ä¸»æœºçš„Â /home/max/compilerÂ ç›®å½•äº†ï¼ˆä¿® # æ”¹Â /root/compiler çš„å†…å®¹ä¹Ÿä¼šæ”¹å˜æœ¬åœ°Â /home/max/compilerÂ çš„å†…å®¹ï¼‰ã€‚ docker run -e foo=bar postgres env # æ·»åŠ foo=barè¿›å…¥ç¯å¢ƒå˜é‡ æ ¹æ®å®¹å™¨IDï¼ˆæˆ–åç§°ï¼‰å¯åŠ¨æ—§å®¹å™¨ï¼ˆdocker execï¼‰ æœ‰äº›æ—¶å€™æˆ‘ä»¬æƒ³è¦å¤ç”¨æŸäº›å®¹å™¨è€Œä¸æ˜¯åœ¨åˆ›å»ºå¯åŠ¨ä¹‹åå°±å°†å…¶åˆ é™¤ï¼Œè¿™æ—¶å€™å¯ä»¥æ ¹æ®å®¹å™¨IDï¼ˆæˆ–åç§°ï¼‰æ¥å†æ¬¡å¯åŠ¨è¯¥å®¹å™¨ã€‚å¯åŠ¨æ—§å®¹å™¨æ—¶æˆ‘ä»¬é¦–å…ˆåº”è¯¥ä¿è¯æ—§å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ä½¿ç”¨docker psæŸ¥çœ‹å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨åˆ—è¡¨ï¼Œå¦‚æœè¦è¿è¡Œdocker execçš„å®¹å™¨ä¸å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå…ˆè¿è¡Œdocker start containeræ¥æ˜¯è¯¥å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ä¸Šé¢çš„containerå¯ä»¥ç´¢å¼•åˆ°docker runè¿è¡Œåå¾—åˆ°çš„å®¹å™¨ã€‚\u0026ndash;nameå‚æ•°å¯¹åº”çš„åç§°æˆ–åŸå§‹ç´¢å¼•ã€‚\ndocker exec [options] container command [arg...] é€‰é¡¹å‚æ•°ï¼š -d ï¼šåå°è¿è¡Œå®¹å™¨ï¼ˆâ€œdetachedâ€ æ¨¡å¼ï¼‰ã€‚å®¹å™¨åœ¨åå°è¿è¡Œï¼Œç»ˆç«¯ä¸ä¼šè¢«é˜»å¡ã€‚ -it ï¼šåˆ†é…äº¤äº’å¼ç»ˆç«¯ï¼Œå¯ä»¥è¿›å…¥å®¹å™¨å†…éƒ¨è¿›è¡Œäº¤äº’æ“ä½œã€‚ -u ï¼šæŒ‡å®šç‰¹å®šçš„ç”¨æˆ·èº«ä»½æ¥è¿è¡Œå®¹å™¨ã€‚ -e ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚ -w ï¼š æŒ‡å®šå®¹å™¨å†…çš„å·¥ä½œç›®å½•æ¥è¿è¡Œå®¹å™¨ã€‚ **ä¸‹é¢çš„containerå¯ä»¥ç´¢å¼•åˆ°`docker run`è¿è¡Œåå¾—åˆ°çš„å®¹å™¨ã€‚--nameå‚æ•°å¯¹åº”çš„åç§°æˆ–åŸå§‹ç´¢å¼•ã€‚** docker exec -it container bash # è¿›å…¥äº¤äº’å¼bashç»ˆç«¯ã€‚ docker exec -d container touch /tmp/execWorks # åœ¨åå°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œä¸ä¼šç­‰å¾…å‘½ä»¤å®Œæˆã€‚ docker exec -e VAR_A=1 -e VAR_B=2 å®¹å™¨åç§° env # æ‰§è¡Œå‘½ä»¤æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ docker exec -it -w /root container pwd # åœ¨æŒ‡å®šçš„å·¥ä½œç›®å½•/rootä¸­æ‰§è¡Œå‘½ä»¤ è‡ªå®šä¹‰é•œåƒ ä¸Šé¢çš„æµç¨‹ä¸»è¦æ˜¯é’ˆå¯¹æˆ‘ä»¬ä»æœ¬åœ°æ‹‰å–åˆ«äººçš„å†™å¥½ä¸Šä¼ åˆ°Docker Hubä¸Šçš„é•œåƒï¼Œç„¶åè¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œã€‚ä¸è¿‡åˆ«äººçš„é•œåƒä¹Ÿä¸æ€»æ˜¯èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰é•œåƒæ¥å®Œæˆæˆ‘ä»¬è‡ªå·±çš„ç‹¬ç‰¹éœ€æ±‚ã€‚è‡ªå®šä¹‰é•œåƒéœ€è¦ç”¨åˆ°Dockerfileæ–‡ä»¶å•¦ï¼Œå¯ä»¥è¿™æ ·æ¥è¿›è¡Œç®€å•ç±»æ¯”ï¼šå†™é•œåƒå°±éœ€è¦Dockerfileï¼ŒDockerfileå°±æ˜¯é•œåƒçš„â€œæºä»£ç â€ï¼ŒDockerå°±æ˜¯\u0026quot;ç¼–è¯‘å™¨\u0026quot;ã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä½¿ç”¨docker buildå‘½ä»¤è¡Œæ¥ä½¿å¾—è¯¥ç¼–è¯‘è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæ¥å­¦ä¹ Dockerfileçš„ç¼–å†™è§„åˆ™ã€‚\nDockerfileç»“æ„ æŒ‡ä»¤ æè¿° FROM \u0026lt;image\u0026gt; å®šä¹‰æ„å»ºé•œåƒçš„åŸºç¡€é•œåƒã€‚ RUN \u0026lt;command\u0026gt; åœ¨å½“å‰é•œåƒçš„åŸºç¡€ä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œå¹¶æäº¤ç»“æœä¸ºä¸€ä¸ªæ–°å±‚ã€‚RUNä¹Ÿæœ‰ shell å½¢å¼ç”¨äºæ‰§è¡Œå‘½ä»¤ã€‚ WORKDIR \u0026lt;directory\u0026gt; ä¸ºåç»­çš„RUNã€CMDã€ENTRYPOINTã€COPY å’Œ ADD æŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ã€‚ COPY \u0026lt;src\u0026gt; \u0026lt;dest\u0026gt; å°†æ–°çš„æ–‡ä»¶æˆ–ç›®å½•ä» \u0026lt;src\u0026gt; å¤åˆ¶åˆ°å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ \u0026lt;dest\u0026gt; è·¯å¾„ä¸‹ã€‚ CMD \u0026lt;command\u0026gt; å®šä¹‰å¯åŠ¨åŸºäºæ­¤é•œåƒçš„å®¹å™¨æ—¶é»˜è®¤è¿è¡Œçš„ç¨‹åºã€‚æ¯ä¸ª Dockerfile åªèƒ½æœ‰ä¸€ä¸ª CMDï¼Œå¦‚æœæœ‰å¤šä¸ª CMD æŒ‡ä»¤ï¼Œåªæœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆã€‚ EXPOSE \u0026lt;port\u0026gt; å£°æ˜å®¹å™¨ç›‘å¬çš„ç«¯å£ ARG \u0026lt;expression\u0026gt; å®šä¹‰å˜é‡åç§°å’Œå˜é‡å€¼ï¼Œå¯ä»¥åœ¨docker buildä¸­åŠ ä»¥è°ƒæ§ã€‚ ä¸€ä¸ªç®€å•çš„welcome-to-dockerç½‘é¡µçš„Dockerfileçš„ç¼–å†™ã€‚\n# åŸºç¡€nodeé•œåƒ FROM node:18-alpine # åç»­å‘½ä»¤è¿è¡Œçš„å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶æœ¬åœ°çš„package.jsonå’Œpackage-lock.jsonåˆ°å®¹å™¨çš„/appç›®å½•ä¸‹ COPY package*.json ./ # åŒä¸Š COPY ./src ./src COPY ./public ./public # â€œå®‰è£… Node åŒ…ï¼Œå®‰è£… serveï¼Œæ„å»ºåº”ç”¨ï¼Œå¹¶åœ¨æœ€åç§»é™¤ä¾èµ–ã€‚â€ RUN npm install \\ \u0026amp;\u0026amp; npm install -g serve \u0026amp;\u0026amp; npm run build \u0026amp;\u0026amp; rm -rf node_modules EXPOSE 3000 # ä½¿ç”¨serveå‘½ä»¤å¯åŠ¨è¯¥åº”ç”¨ CMD [ \u0026#34;serve\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;build\u0026#34; ] â€œç¼–è¯‘â€Dockerfileæ–‡ä»¶ï¼šdocker build æœ‰äº†Dockerfileæ–‡ä»¶ä¹‹åæ¥ä¸‹æ¥å°±å¯ä»¥è¿è¡Œdocker buildæ¥æ„å»ºè‡ªå®šä¹‰é•œåƒäº†ã€‚\ndocker build [options] path | url | - é€‰é¡¹å‚æ•°ï¼š -t ï¼šä¸ºæ„å»ºçš„é•œåƒå‘½åå¹¶æ‰“æ ‡ç­¾ï¼ˆå¦‚ myimage:tagï¼‰ã€‚ä¸æŒ‡å®šæ ‡ç­¾æ—¶é»˜è®¤æ˜¯ latestã€‚ -f ï¼šæŒ‡å®šä½¿ç”¨çš„ Dockerfile æ–‡ä»¶ï¼Œé»˜è®¤æŸ¥æ‰¾ path ä¸‹çš„ Dockerfileã€‚ --rm ï¼šæ„å»ºå®Œæˆåç§»é™¤ä¸­é—´å®¹å™¨ï¼Œé»˜è®¤æ˜¯ trueã€‚ --build-arg ï¼šè®¾ç½®æ„å»ºæ—¶çš„å˜é‡ **path ï¼šæŒ‡å‘åŒ…å« Dockerfile çš„ç›®å½•ï¼Œæˆ–è€…å¯ä»¥ä½¿ç”¨ url æŒ‡å‘ä¸€ä¸ªè¿œç¨‹çš„ Dockerfileã€‚** docker build -t test:latest . # path docker build -f path/to/Dockerfile . # path docker build --build-arg NODE_VERSION=current . # path docker build https://github.com/docker-library/hello-world.git # url ","permalink":"https://fordelkon.github.io/posts/docker_intro/","summary":"\u003cp\u003eå‘ç°äº†ä¸€ä¸ªæ–°çš„GitHubçš„é¡¹ç›®ï¼Œå‘ç°è¦ä½¿ç”¨condaåº“æ¥åˆ›å»ºæ–°çš„è™šæ‹Ÿç¯å¢ƒè£…ä¸€å¤§å †pythonåº“æ‰èƒ½è¿è¡Œèµ·æ¥è¿™ä¸ªé¡¹ç›®\u0026hellip;å¿ƒä¸­çš„æ¿€æƒ…ä¹‹ç«å·²ç»æµ‡ç­äº†ä¸€å¤§åŠğŸ˜’ï¼›è¿™æ—¶å€™åˆçªç„¶å‘ç°è¯¥é¡¹ç›®æ”¯æŒDockerç¯å¢ƒéƒ¨ç½²ï¼Œå¯ä»¥ç›´æ¥æ‹‰å–Dockeré•œåƒæ¥è¿è¡Œè¯¥é¡¹ç›®ï¼Œå¥½äº†ï¼Œå¿ƒä¸­å†æ¬¡ç‡ƒèµ·æ¿€æƒ…ä¹‹ç«ğŸ˜Šã€‚æ€»ä¹‹ï¼ŒDockerå¯ä»¥å¸®åŠ©æˆ‘ä¹ˆçœä¸‹é…ç¯å¢ƒçš„æ—¶é—´ï¼Œè€Œä¸”ä½ æ‹‰å–åˆ«äººå·²ç»å‘å¸ƒçš„é•œåƒä¸€èˆ¬æ˜¯åˆ«äººå·²ç»åœ¨å®¿ä¸»æœºä¸Šå·²ç»è·‘é€šçš„é•œåƒï¼Œé‚£ä¹ˆä¸ç®¡ä½ çš„å¹³å°æ˜¯ä»€ä¹ˆä½ ä¹Ÿä¸€å®šèƒ½è·‘é€šã€‚ä¸‹é¢è®©æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹çœ‹Dockerå§\u0026hellip;\u003c/p\u003e","title":"ä½¿ç”¨Dockerçš„è‰ºæœ¯"},{"content":"ç†Ÿç»ƒä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ä¸€ç§å¸¸å¸¸è¢«å¿½è§†ï¼Œæˆ–è¢«è®¤ä¸ºéš¾ä»¥æŒæ¡çš„æŠ€èƒ½ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä¼šæé«˜ä½ ä½œä¸ºå·¥ç¨‹å¸ˆçš„çµæ´»æ€§ä»¥åŠç”Ÿäº§åŠ›ã€‚æœ¬æ–‡æ—¨åœ¨äº†è§£å‘½ä»¤è¡Œä¸­çš„é‡å®šå‘åŠŸèƒ½å’Œæ–‡ä»¶ç®¡ç†åŠŸèƒ½ã€‚\né‡å®šå‘ï¼ˆredirectï¼‰ è¾“å…¥è¾“å‡ºé‡å®šå‘ \u0026gt;è¦†ç›–ï¼Œ\u0026gt;\u0026gt;ç´¯åŠ \næ ‡å‡†è¾“å…¥ã€€(stdin) ï¼šä»£ç ä¸º0ï¼Œä½¿ç”¨\u0026lt;æˆ–\u0026lt;\u0026lt;ï¼› æ ‡å‡†è¾“å‡ºã€€(stdout)ï¼šä»£ç ä¸º1ï¼Œä½¿ç”¨\u0026gt;æˆ–\u0026gt;\u0026gt;ï¼› æ ‡å‡†é”™è¯¯è¾“å‡º(stderr)ï¼šä»£ç ä¸º2ï¼Œä½¿ç”¨2\u0026gt;æˆ–2\u0026gt;\u0026gt;ï¼› 2\u0026gt;\u0026amp;1æ¥å°†2\u0026gt;è½¬åˆ°1\u0026gt;å»ï¼Œè€Œ1\u0026gt;\u0026amp;2æ¥å°†1\u0026gt;è½¬åˆ°2\u0026gt;å»ã€‚ï¼ˆæ„Ÿè§‰åƒæ˜¯é¦–è¦å®šæ€§ï¼Œå…ˆåˆ†é…å¥½stdoutå’Œstderrçš„èµ°å‘ï¼‰ 2\u0026gt;\u0026amp;1:\ntype list \u0026gt; list # bash: type: list: not found cat list type list \u0026gt; list 2\u0026gt;\u0026amp;1 cat list # bash: type: list: not found type cd \u0026gt; list 2\u0026gt;\u0026amp;1 # cd is a shell builtin 1\u0026gt;\u0026amp;2:\necho \u0026#34;error message\u0026#34; 1\u0026gt;\u0026amp;2 # error message echo \u0026#34;error message\u0026#34; 2\u0026gt; /dev/null 1\u0026gt;\u0026amp;2 ç®¡é“é‡å®šå‘ |ï¼šä»…èƒ½å¤„ç†ç»ç”±å‰é¢ä¸€ä¸ªæŒ‡ä»¤ä¼ æ¥çš„æ­£ç¡®ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ stdout çš„ä¿¡æ¯ï¼Œå¯¹äº stderrå¹¶æ²¡æœ‰ç›´æ¥å¤„ç†çš„èƒ½åŠ›ï¼›å¿…é¡»è¦èƒ½å¤Ÿæ¥å—æ¥è‡ªå‰ä¸€ä¸ªæŒ‡ä»¤çš„æ•°æ®æˆä¸º standard input ç»§ç»­å¤„ç†æ‰è¡Œã€‚\nåŸºç¡€æ­£åˆ™è¡¨è¾¾å¼(grepä¸­çš„\u0026rsquo;pattern\u0026rsquo;æ ¼å¼) RE å­—ç¬¦ æ„ä¹‰ä¸èŒƒä¾‹ ^word æ„ä¹‰ï¼šå¾…æœç´¢çš„å­—ç¬¦ä¸²(word)åœ¨è¡Œé¦–ï¼ èŒƒä¾‹ï¼šæœç´¢è¡Œé¦–ä¸º # å¼€å§‹çš„é‚£ä¸€è¡Œï¼Œå¹¶åˆ—å‡ºè¡Œå·\ngrep -n '^#' regular_express.txt word$ æ„ä¹‰ï¼šå¾…æœç´¢çš„å­—ç¬¦ä¸²(word)åœ¨è¡Œå°¾ï¼ èŒƒä¾‹ï¼šå°†è¡Œå°¾ä¸º ! çš„é‚£ä¸€è¡Œæ‰“å°å‡ºæ¥ï¼Œå¹¶åˆ—å‡ºè¡Œå·\ngrep -n '!$' regular_express.txt . æ„ä¹‰ï¼šä»£è¡¨ä¸€å®šæœ‰ä¸€ä¸ªä»»æ„å­—ç¬¦çš„å­—ç¬¦ï¼ èŒƒä¾‹ï¼šæœç´¢çš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ (eve) (eae) (eee) (e e)ï¼Œ ä½†ä¸èƒ½ä»…æœ‰ (ee) ï¼äº¦å³ e ä¸ e ä¸­é—´ã€ä¸€å®šã€ä»…æœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œç©ºç™½å­—ç¬¦ä¹Ÿæ˜¯å­—ç¬¦ï¼\ngrep -n 'e.e' regular_express.txt \\ æ„ä¹‰ï¼šè·³è„±å­—ç¬¦ï¼Œå°†ç‰¹æ®Šç¬¦å·çš„ç‰¹æ®Šæ„ä¹‰å»é™¤ï¼ èŒƒä¾‹ï¼šæœç´¢å«æœ‰å•å¼•å· \u0026rsquo; çš„é‚£ä¸€è¡Œï¼\ngrep -n \\' regular_express.txt * æ„ä¹‰ï¼šé‡å¤é›¶ä¸ªåˆ°æ— ç©·å¤šä¸ªçš„å‰ä¸€ä¸ª RE å­—ç¬¦ èŒƒä¾‹ï¼šæ‰¾å‡ºå«æœ‰ (es) (ess) (esss) ç­‰ç­‰çš„å­—ç¬¦ä¸²ï¼Œæ³¨æ„ï¼Œå› ä¸º * å¯ä»¥æ˜¯ 0 ä¸ªï¼Œæ‰€ä»¥ es ä¹Ÿæ˜¯ç¬¦åˆå¸¦æœç´¢å­—ç¬¦ä¸²ã€‚å¦å¤–ï¼Œå› ä¸º * ä¸ºé‡å¤å‰ä¸€ä¸ª RE å­—ç¬¦çš„ç¬¦å·ï¼Œ å› æ­¤ï¼Œåœ¨ * ä¹‹å‰å¿…é¡»è¦ç´§æ¥ç€ä¸€ä¸ª RE å­—ç¬¦å–”ï¼ä¾‹å¦‚ä»»æ„å­—ç¬¦åˆ™ä¸º .* ï¼\ngrep -n 'ess*' regular_express.txt [list] æ„ä¹‰ï¼šå­—ç¬¦é›†åˆçš„ RE å­—ç¬¦ï¼Œé‡Œé¢åˆ—å‡ºæƒ³è¦æˆªå–çš„å­—ç¬¦ï¼ èŒƒä¾‹ï¼šæœç´¢å«æœ‰ (gl) æˆ– (gd) çš„é‚£ä¸€è¡Œï¼Œéœ€è¦ç‰¹åˆ«ç•™æ„çš„æ˜¯ï¼Œåœ¨[]å½“ä¸­è°¨ä»£è¡¨ä¸€ä¸ªå¾…æœç´¢çš„å­—ç¬¦ï¼Œ ä¾‹å¦‚a[afl]yä»£è¡¨æœç´¢çš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ aay, afy, aly å³ [afl]ä»£è¡¨ a æˆ– f æˆ– l çš„æ„æ€ï¼\ngrep -n 'g[ld]' regular_express.txt [n1-n2] æ„ä¹‰ï¼šå­—ç¬¦é›†åˆçš„ RE å­—ç¬¦ï¼Œé‡Œé¢åˆ—å‡ºæƒ³è¦æˆªå–çš„å­—ç¬¦èŒƒå›´ï¼ èŒƒä¾‹ï¼šæœç´¢å«æœ‰ä»»æ„æ•°å­—çš„é‚£ä¸€è¡Œï¼éœ€ç‰¹åˆ«ç•™æ„ï¼Œåœ¨å­—ç¬¦é›†åˆ [] ä¸­çš„å‡å· - æ˜¯æœ‰ç‰¹æ®Šæ„ä¹‰çš„ï¼Œä»–ä»£è¡¨ä¸¤ä¸ªå­—ç¬¦ä¹‹é—´çš„æ‰€æœ‰è¿ç»­å­—ç¬¦ï¼ä½†è¿™ä¸ªè¿ç»­ä¸å¦ä¸ ASCII ç¼–ç æœ‰å…³ï¼Œå› æ­¤ï¼Œä½ çš„ç¼–ç éœ€è¦è®¾ç½®æ­£ç¡®(åœ¨ bash å½“ä¸­ï¼Œéœ€è¦ç¡®å®š LANG ä¸ LANGUAGE çš„å˜é‡æ˜¯å¦æ­£ç¡®ï¼) ä¾‹å¦‚æ‰€æœ‰å¤§å†™å­—ç¬¦åˆ™ä¸º [A-Z]\ngrep -n '[A-Z]' regular_express.txt [^list] æ„ä¹‰ï¼šå­—ç¬¦é›†åˆçš„ RE å­—ç¬¦ï¼Œé‡Œé¢åˆ—å‡ºä¸è¦çš„å­—ç¬¦ä¸²æˆ–èŒƒå›´ï¼ èŒƒä¾‹ï¼šæœç´¢çš„å­—ç¬¦ä¸²å¯ä»¥æ˜¯ (oog) (ood) ä½†ä¸èƒ½æ˜¯ (oot) ï¼Œé‚£ä¸ª ^ åœ¨ [] å†…æ—¶ï¼Œä»£è¡¨çš„æ„ä¹‰æ˜¯ã€åå‘é€‰æ‹©ã€çš„æ„æ€ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä¸è¦å¤§å†™å­—ç¬¦ï¼Œåˆ™ä¸º[^A-Z]ã€‚ä½†æ˜¯ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä»¥ grep -n [^A-Z] regular_express.txt æ¥æœç´¢ï¼Œå´å‘ç°è¯¥æ–‡ä»¶å†…çš„æ‰€æœ‰è¡Œéƒ½è¢«åˆ—å‡ºï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ä¸ª [^A-Z] æ˜¯éå¤§å†™å­—ç¬¦çš„æ„æ€ï¼Œ å› ä¸ºæ¯ä¸€è¡Œå‡æœ‰éå¤§å†™å­—ç¬¦ï¼Œä¾‹å¦‚ç¬¬ä¸€è¡Œçš„ \u0026ldquo;Open Source\u0026rdquo; å°±æœ‰ p,e,n,o\u0026hellip;. ç­‰ç­‰çš„å°å†™å­—\ngrep -n 'oo[^t]' regular_express.txt \\{n,m\\} æ„ä¹‰ï¼šè¿ç»­ n åˆ° m ä¸ªçš„å‰ä¸€ä¸ª RE å­—ç¬¦ æ„ä¹‰ï¼šè‹¥ä¸º \\{n\\} åˆ™æ˜¯è¿ç»­ n ä¸ªçš„å‰ä¸€ä¸ª RE å­—ç¬¦ï¼Œ æ„ä¹‰ï¼šè‹¥æ˜¯ \\{n,\\} åˆ™æ˜¯è¿ç»­ n ä¸ªä»¥ä¸Šçš„å‰ä¸€ä¸ª RE å­—ç¬¦ï¼Â èŒƒä¾‹ï¼šåœ¨ g ä¸ g ä¹‹é—´æœ‰ 2 ä¸ªåˆ° 3 ä¸ªçš„ o å­˜åœ¨çš„å­—ç¬¦ä¸²ï¼Œäº¦å³ (goog)(gooog)\ngrep -n 'go\\{2,3\\}g' regular_express.txt å¸¸ç”¨çš„ç®¡é“å‘½ä»¤grep:\ngrep [-acinv] [--color=auto] \u0026#39;pattern\u0026#39; filename é€‰é¡¹ä¸å‚æ•°ï¼š -i ï¼šå¿½ç•¥å¤§å°å†™çš„ä¸åŒï¼Œæ‰€ä»¥å¤§å°å†™è§†ä¸ºç›¸åŒ -o ï¼šåªè¾“å‡ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œ -v ï¼šåå‘é€‰æ‹©ï¼Œäº¦å³æ˜¾ç¤ºå‡ºæ²¡æœ‰åŒ¹é…\u0026#39;pattern\u0026#39;çš„å­—ç¬¦ä¸²å†…å®¹çš„é‚£äº›è¡Œï¼ -A ï¼šæ˜¾ç¤ºåŒ¹é…è¡Œ+åŒ¹é…è¡Œè¡Œåçš„å‡ è¡Œ(after) -B ï¼šæ˜¾ç¤ºåŒ¹é…è¡Œ+åŒ¹é…è¡Œè¡Œå‰çš„å‡ è¡Œ(before) -C ï¼šæ˜¾ç¤ºåŒ¹é…è¡Œ+åŒ¹é…è¡Œè¡Œå‰åçš„å‡ è¡Œ(context) --color=auto ï¼šå¯ä»¥å°†æ‰¾åˆ°çš„å…³é”®å­—éƒ¨åˆ†åŠ ä¸Šé¢œè‰²çš„æ˜¾ç¤ºå–”ï¼ # å°†æœ‰å‡ºç° root çš„é‚£ä¸€è¡Œå°±å–å‡ºæ¥ï¼› last | grep \u0026#39;root\u0026#39; # åªè¦æ²¡æœ‰ root çš„å°±å–å‡ºï¼ last | grep -v \u0026#39;root\u0026#39; # # wtmp begins Tue Mar 11 22:41:15 2025 # åœ¨ last çš„è¾“å‡ºæ¶ˆæ¯ä¸­ï¼Œåªè¦æœ‰ root å°±å–å‡ºï¼Œå¹¶ä¸”ä»…å–ç¬¬ä¸€æ  last | grep -v \u0026#39;root\u0026#39; | cut -d \u0026#39; \u0026#39; -f 1 # # wtmp # åœ¨å–å‡º root ä¹‹åï¼Œåˆ©ç”¨ä¸Šä¸ªæŒ‡ä»¤ cut çš„å¤„ç†ï¼Œå°±èƒ½å¤Ÿä»…å–å¾—ç¬¬ä¸€æ å•°ï¼ # ç¥å¥‡çš„æ˜¯ï¼Œå¦‚æœåŠ ä¸Š --color=auto çš„é€‰é¡¹ï¼Œæ‰¾åˆ°çš„å…³é”®å­—éƒ¨åˆ†ä¼šç”¨ç‰¹æ®Šé¢œè‰²æ˜¾ç¤ºå–”ï¼ å¸¸ç”¨çš„ç®¡é“å‘½ä»¤awkï¼š\nawk [-F] [delimiter] \u0026#39;pattern {action}\u0026#39; filename é€‰é¡¹ä¸å‚æ•°ï¼š -F ï¼šåˆ¶å®šåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ # åˆ—å‡ºå½“å‰GPUä¸‹æ‰€æœ‰çš„pythonè¿›ç¨‹å· nvidia-smi | grep python | awk \u0026#39;{print $5}\u0026#39; # 18108 # 18737 # 19383 # 19565 # 19725 # 19799 # 19859 # 19977 # 20550 # 20733 awk \u0026#39;FS=\u0026#34;:\u0026#34; { print $1, $3 }\u0026#39; /etc/passwd # root:x:0:0:root:/root:/bin/bash # daemon 1 # bin 2 # sys 3 # sync 4 # games 5 # man 6 # ...... awkåŠ¨ä½œä¸­çš„å†…ç½®å˜é‡ï¼ŒåŠ¨ä½œä¸­çš„å…³é”®å­—æ˜¯printï¼š\n$0ï¼šå½“å‰è¡Œçš„æ‰€æœ‰å†…å®¹ã€‚ $1, $2, $3,\u0026hellip;ï¼šæ¯è¡Œçš„å„ä¸ªå­—æ®µï¼Œä»ç¬¬ä¸€ä¸ªå­—æ®µå¼€å§‹ã€‚ NRï¼šå½“å‰è¡Œå·ã€‚ NFï¼šå½“å‰è¡Œçš„å­—æ®µæ•°ã€‚ FSï¼šå­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ã€‚ OFSï¼šè¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºç©ºæ ¼ã€‚ RSï¼šè¡Œåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚ ORSï¼šè¾“å‡ºè¡Œåˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚ å¸¸ç”¨ç®¡é“å‘½ä»¤sedï¼š\nsed [-nefr] [action] é€‰é¡¹ä¸å‚æ•°ï¼š -n ï¼šä½¿ç”¨å®‰é™(silent)æ¨¡å¼ã€‚åœ¨ä¸€èˆ¬ sed çš„ç”¨æ³•ä¸­ï¼Œæ‰€æœ‰æ¥è‡ª STDIN çš„æ•°æ®ä¸€èˆ¬éƒ½ä¼šè¢«åˆ—å‡ºåˆ°å±å¹•ä¸Šã€‚ ä½†å¦‚æœåŠ ä¸Š -n å‚æ•°åï¼Œåˆ™åªæœ‰ç»è¿‡ sed ç‰¹æ®Šå¤„ç†çš„é‚£ä¸€è¡Œ(æˆ–è€…åŠ¨ä½œ)æ‰ä¼šè¢«åˆ—å‡ºæ¥ã€‚ -e ï¼šç›´æ¥åœ¨æŒ‡ä»¤åˆ—æ¨¡å¼ä¸Šè¿›è¡Œ sed çš„åŠ¨ä½œç¼–è¾‘ï¼› -f ï¼šç›´æ¥å°† sed çš„åŠ¨ä½œå†™åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ï¼Œ -f filename åˆ™å¯ä»¥è¿è¡Œ filename å†…çš„ sed åŠ¨ä½œï¼› -r ï¼šsed çš„åŠ¨ä½œæ”¯æŒçš„æ˜¯å»¶ä¼¸å‹æ­£è§„è¡¨ç¤ºæ³•çš„è¯­æ³•ã€‚(ç¼ºçœæ˜¯åŸºç¡€æ­£è§„è¡¨ç¤ºæ³•è¯­æ³•) -i ï¼šç›´æ¥ä¿®æ”¹è¯»å–çš„æ–‡ä»¶å†…å®¹ï¼Œè€Œä¸æ˜¯ç”±å±å¹•è¾“å‡ºã€‚ åŠ¨ä½œè¯´æ˜ï¼š [n1[,n2]]function n1, n2 ï¼šä¸è§å¾—ä¼šå­˜åœ¨ï¼Œä¸€èˆ¬ä»£è¡¨ã€é€‰æ‹©è¿›è¡ŒåŠ¨ä½œçš„è¡Œæ•°ã€ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæˆ‘çš„åŠ¨ä½œ æ˜¯éœ€è¦åœ¨ 10 åˆ° 20 è¡Œä¹‹é—´è¿›è¡Œçš„ï¼Œåˆ™ã€ 10,20[åŠ¨ä½œè¡Œä¸º] ã€ function æœ‰åº•ä¸‹è¿™äº›å’šå’šï¼š a ï¼šæ·»åŠ ï¼Œ a çš„åé¢å¯ä»¥æ¥å­—ç¬¦ä¸²ï¼Œè€Œè¿™äº›å­—ç¬¦ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸‹ä¸€è¡Œ)ï½ c ï¼šå–ä»£ï¼Œ c çš„åé¢å¯ä»¥æ¥å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²å¯ä»¥å–ä»£ n1,n2 ä¹‹é—´çš„è¡Œï¼ d ï¼šåˆ é™¤ï¼Œå› ä¸ºæ˜¯åˆ é™¤å•Šï¼Œæ‰€ä»¥ d åé¢é€šå¸¸ä¸æ¥ä»»ä½•å’šå’šï¼› i ï¼šæ’å…¥ï¼Œ i çš„åé¢å¯ä»¥æ¥å­—ç¬¦ä¸²ï¼Œè€Œè¿™äº›å­—ç¬¦ä¸²ä¼šåœ¨æ–°çš„ä¸€è¡Œå‡ºç°(ç›®å‰çš„ä¸Šä¸€è¡Œ)ï¼› p ï¼šæ‰“å°ï¼Œäº¦å³å°†æŸä¸ªé€‰æ‹©çš„æ•°æ®å°å‡ºã€‚é€šå¸¸ p ä¼šä¸å‚æ•° sed -n ä¸€èµ·è¿ä½œï½ s ï¼šå–ä»£ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œå–ä»£çš„å·¥ä½œå“©ï¼é€šå¸¸è¿™ä¸ª s çš„åŠ¨ä½œå¯ä»¥æ­é…æ­£è§„è¡¨ç¤ºæ³•ï¼ ä¾‹å¦‚ 1,20s/old/new/g å°±æ˜¯å•¦ï¼ï¼ˆç±»ä¼¼vimå‘½ä»¤è¡Œæ›¿æ¢æ“ä½œï¼‰ nl /etc/passwd | sed \u0026#39;2,5d\u0026#39; # å°† /etc/passwd çš„å†…å®¹åˆ—å‡ºå¹¶ä¸”æ‰“å°è¡Œå·ï¼ŒåŒæ—¶ï¼Œè¯·å°†ç¬¬ 2~5 è¡Œåˆ é™¤ï¼ nl /etc/passwd | sed \u0026#39;2a drink tea\u0026#39; # åœ¨ç¬¬äºŒè¡Œå(äº¦å³æ˜¯åŠ åœ¨ç¬¬ä¸‰è¡Œ)åŠ ä¸Šã€drink teaã€å­—æ ·ï¼ nl /etc/passwd | sed \u0026#39;2i drink tea\u0026#39; # åœ¨ç¬¬äºŒè¡Œå‰(äº¦å³æ˜¯åŠ åœ¨ç¬¬ä¸‰è¡Œ)åŠ ä¸Šã€drink teaã€å­—æ ·ï¼ nl /etc/passwd | sed \u0026#39;2,5c No 2-5 number\u0026#39; # å°†ç¬¬2-5è¡Œçš„å†…å®¹å–ä»£æˆä¸ºã€No 2-5 numberã€ nl /etc/passwd | sed -n \u0026#39;5,7p\u0026#39; # åˆ—å‡º /etc/passwd æ–‡ä»¶å†…çš„ç¬¬ 5-7 è¡Œ cat /etc/man_db.conf | grep \u0026#39;MAN\u0026#39;| sed \u0026#39;s/#.*$//g\u0026#39; åˆ é™¤æ‰æ³¨è§£ä¹‹åçš„æ•°æ®ï¼ xargs + |ï¼šxargså¯ä»¥è¯»å…¥stdinçš„æ•°æ®ï¼Œå¹¶ä¸”ä»¥ç©ºæ ¼æˆ–æ¢è¡Œå­—ç¬¦ä½œä¸ºåˆ†è¾¨ï¼Œå°†stdinçš„æ•°æ®åˆ†éš”æˆä¸ºargumentsã€‚\nxargsæ­é…ï½œæ›´åŠ ç¾å‘³ğŸ˜‹ï¼š\ncommand1 | xargs [-ndI{}] command2 é€‰é¡¹ä¸å‚æ•°ï¼š -n ï¼šåé¢æ¥æ¬¡æ•°ï¼Œæ¯æ¬¡command2æŒ‡ä»¤è¿è¡Œæ—¶ï¼Œè¦ä½¿ç”¨å‡ ä¸ªå‚æ•°çš„æ„æ€ã€‚ -d ï¼šæŒ‡å®šå®šç•Œç¬¦ï¼Œé»˜è®¤æ˜¯ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚delimiter -I{}ï¼šæŒ‡å®šæ›¿æ¢å­—ç¬¦ä¸²ã€‚æ¯æ¬¡è¯»å–ä¸€è¡Œæ•°æ®å¹¶å°†{}æ›¿æ¢ä¸ºè¯¥è¡Œæ•°æ®ã€‚ cat hosts # delkon # study # flypig # ikun # daniel cat hosts | xargs -I{} echo root@{} # root@delkon # root@study # root@flypig # root@ikun # root@daniel cat hosts | xargs -n 2 echo # delkon study # flypig ikun # daniel ls # dataloaders.py lr_scheduler.py torch_utils.py find . -name \u0026#39;*.py\u0026#39; | xargs grep \u0026#39;matplotlib\u0026#39; # ./dataloaders.py:import matplotlib.pyplot as plt # ./dataloaders.py:from matplotlib import rcParams æ–‡ä»¶ç®¡ç† ls -lå±•ç¤ºæ–‡ä»¶å±æ€§ ls -l # total 64 # lrwxrwxrwx 1 root root 7 Apr 22 2024 bin -\u0026gt; usr/bin # drwxr-xr-x 2 root root 4096 Apr 22 2024 boot # drwxr-xr-x 5 root root 360 Mar 13 15:38 dev # drwxr-xr-x 1 root root 4096 Mar 12 20:33 etc # drwxr-xr-x 1 root root 4096 Jan 27 10:19 home # lrwxrwxrwx 1 root root 7 Apr 22 2024 lib -\u0026gt; usr/lib # drwxr-xr-x 2 root root 4096 Jan 27 10:12 media # drwxr-xr-x 2 root root 4096 Jan 27 10:12 mnt # drwxr-xr-x 2 root root 4096 Jan 27 10:12 opt # dr-xr-xr-x 213 root root 0 Mar 13 15:38 proc # drwx------ 1 root root 4096 Mar 13 16:25 root # drwxr-xr-x 4 root root 4096 Jan 27 10:19 run # lrwxrwxrwx 1 root root 8 Apr 22 2024 sbin -\u0026gt; usr/sbin # drwxr-xr-x 2 root root 4096 Jan 27 10:12 srv # dr-xr-xr-x 11 root root 0 Mar 13 15:51 sys # drwxrwxrwt 1 root root 4096 Mar 12 17:30 tmp # drwxr-xr-x 1 root root 4096 Jan 27 10:12 usr # drwxr-xr-x 1 root root 4096 Jan 27 10:19 var ç¬¬ä¸€åˆ—æ€»å…±10ä½\nç¬¬ä¸€ä½è¡¨ç¤ºæ–‡ä»¶ç±»å‹ï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§å­—æ¯è¡¨ç¤ºï¼š -ï¼šæ™®é€šæ–‡ä»¶ dï¼šç›®å½• lï¼šç¬¦å·è¿æ¥ bï¼šå—è®¾å¤‡æ–‡ä»¶ cï¼šå­—ç¬¦è®¾å¤‡æ–‡ä»¶ sï¼šå¥—æ¥å­— pï¼šå‘½åç®¡é“ å‰©ä¸‹9ä½åˆ†ä¸º3ç»„ï¼Œæ¯ç»„3ä½åˆ†åˆ«æœ‰ä»¥ä¸‹æƒé™rï¼ˆå¯è¯»ï¼‰wï¼ˆå¯å†™ï¼‰xï¼ˆå¯æ‰§è¡Œï¼‰ 2-4ä½ï¼šæ–‡ä»¶å±ä¸»ï¼ˆownerï¼‰çš„æƒé™ 5-7ä½ï¼šåŒç»„ç”¨æˆ·ï¼ˆgroupï¼‰çš„æƒé™ 8-10ä½ï¼šå…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™ ç¬¬äºŒåˆ—è¡¨ç¤ºç¡¬é“¾æ¥æ•°ï¼Œç¡¬é“¾æ¥æ˜¯æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶çš„å¤šä¸ªæ–‡ä»¶åã€‚å¯¹äºç›®å½•ï¼Œè¿™ä¸ªæ•°å­—è¡¨ç¤ºç›®å½•ä¸‹çš„å­ç›®å½•æ•°é‡åŠ  2ï¼ˆå½“å‰ç›®å½• . å’Œçˆ¶ç›®å½• ..ï¼‰ã€‚\nç¬¬ä¸‰åˆ—å’Œç¬¬å››åˆ—åˆ†åˆ«è¡¨ç¤ºæ–‡ä»¶å±ä¸»å’Œæ–‡ä»¶å±ç»„ã€‚\nç¬¬äº”åˆ—è¡¨ç¤ºæ–‡ä»¶å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚å¦‚æœæ–‡ä»¶æ˜¯ç¬¦å·é“¾æ¥ï¼Œå¤§å°ä¸ºé“¾æ¥ç›®æ ‡çš„è·¯å¾„é•¿åº¦ï¼ˆå¦‚ bin -\u0026gt; usr/bin ä¸­ï¼Œå¤§å°ä¸º 7 æ˜¯å› ä¸º usr/bin æœ‰ 7 ä¸ªå­—ç¬¦ï¼‰ã€‚å¦‚æœæ˜¯ç›®å½•ï¼Œåˆ™ä¸€èˆ¬å›ºå®šä¸º 4096 å­—èŠ‚ã€‚\nç¬¬å…­åˆ—ç¬¬ä¸ƒåˆ—ç¬¬å…«åˆ—è¡¨ç¤ºæœ€åä¿®æ”¹æ—¶é—´ã€‚\nç¬¬ä¹åˆ—è¡¨ç¤ºæ–‡ä»¶åï¼Œå¦‚æœæ˜¯ç¬¦å·é“¾æ¥ï¼ˆå¦‚ bin -\u0026gt; usr/binï¼‰ï¼Œåˆ™åé¢ä¼šæ˜¾ç¤ºé“¾æ¥çš„ç›®æ ‡ã€‚\nlnè¿›è¡Œç¬¦å·é“¾æ¥å’Œç¡¬é“¾æ¥ ln [-sf] src dst é€‰é¡¹ä¸å‚æ•°ï¼š -s ï¼šåˆ›å»ºç¬¦å·é“¾æ¥ã€‚ -f ï¼šå¼ºåˆ¶åˆ›å»ºé“¾æ¥æ–‡ä»¶ï¼Œè¦†ç›–å·²ç»å­˜åœ¨çš„ç›®æ ‡æ–‡ä»¶ã€‚ ls # Python hosts ln hosts hardlink_hosts ls # Python hardlink_hosts hosts ln -s hosts symboliclink_hosts ls # Python hardlink_hosts hosts symboliclink_hosts ls -l # drwxr-xr-x 2 root root 4096 Mar 13 16:25 Python # -rw-r--r-- 2 root root 32 Mar 13 16:09 hardlink_hosts # -rw-r--r-- 2 root root 32 Mar 13 16:09 hosts # lrwxrwxrwx 1 root root 5 Mar 13 17:25 symboliclink_hosts -\u0026gt; hosts cat hosts cat hardlink_hosts cat symboliclink_hosts # delkon # study # flypig # ikun # daniel ç‰¹æ€§ ç¡¬é“¾æ¥ï¼ˆHard Linkï¼‰ ç¬¦å·é“¾æ¥ï¼ˆSymbolic Linkï¼‰ æŒ‡å‘ æŒ‡å‘æ–‡ä»¶çš„ç‰©ç†æ•°æ®å— æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„ æ–‡ä»¶å¤§å° ä¸åŸæ–‡ä»¶ç›¸åŒ ç¬¦å·é“¾æ¥æœ¬èº«åªå ç”¨å°‘é‡ç©ºé—´ï¼ˆä¿å­˜è·¯å¾„ï¼‰ æ–‡ä»¶ç³»ç»Ÿé™åˆ¶ åªèƒ½åœ¨åŒä¸€æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»º å¯ä»¥è·¨æ–‡ä»¶ç³»ç»Ÿåˆ›å»º åˆ é™¤æ•ˆæœ åˆ é™¤ç¡¬é“¾æ¥ä¸ä¼šåˆ é™¤æ–‡ä»¶æ•°æ®ï¼Œé™¤éæ‰€æœ‰ç¡¬é“¾æ¥è¢«åˆ é™¤ åˆ é™¤ç¬¦å·é“¾æ¥ä¸ä¼šå½±å“åŸæ–‡ä»¶ é€‚ç”¨åœºæ™¯ æ–‡ä»¶å¤‡ä»½ï¼Œé˜²æ­¢æ„å¤–åˆ é™¤ å¿«æ·è®¿é—®å…¶ä»–æ–‡ä»¶ã€è·¨ç›®å½•ã€æ–‡ä»¶ç³»ç»Ÿä½¿ç”¨ ç¡¬ç›˜ ç¡¬ç›˜çš„ä½¿ç”¨ï¼šç¡¬ç›˜åˆ†åŒº-\u0026gt;ç¡¬ç›˜æ ¼å¼åŒ–ï¼ˆformat)-\u0026gt;æ–‡ä»¶ç³»ç»Ÿçš„æŒ‚è½½\nç¡¬ç›˜åˆ†åŒº /dev/sd[a-p][1-128]ï¼šä¸ºåˆ†åŒºåçš„å®ä½“ç¡¬ç›˜åˆ†é…çš„ç¡¬ç›˜æ–‡ä»¶åï¼› /dev/vd[a-d][1-128]ï¼šä¸ºåˆ†åŒºåçš„è™šæ‹Ÿç¡¬ç›˜åˆ†é…çš„ç¡¬ç›˜æ–‡ä»¶åã€‚ æœ¬ç³»ç»Ÿä¸‹çš„æ‰€æœ‰ç£ç›˜ä¸ç£ç›˜å†…çš„åˆ†å‰²ä¿¡æ¯ä½¿ç”¨lsblk(list block device)æŸ¥çœ‹\nlsblk [-dfimpt] [device] é€‰é¡¹ä¸å‚æ•°ï¼š -d ï¼šä»…åˆ—å‡ºç£ç›˜æœ¬èº«ï¼Œå¹¶ä¸ä¼šåˆ—å‡ºè¯¥ç£ç›˜çš„åˆ†å‰²æ•°æ® -f ï¼šåŒæ—¶åˆ—å‡ºè¯¥ç£ç›˜å†…çš„æ–‡ä»¶ç³»ç»Ÿåç§° -i ï¼šä½¿ç”¨ ASCII çš„çº¿æ®µè¾“å‡ºï¼Œä¸è¦ä½¿ç”¨å¤æ‚çš„ç¼–ç  (å†æŸäº›ç¯å¢ƒä¸‹å¾ˆæœ‰ç”¨) -m ï¼šåŒæ—¶è¾“å‡ºè¯¥è®¾å¤‡åœ¨ /dev åº•ä¸‹çš„æƒé™æ•°æ® (rwx çš„æ•°æ®) -p ï¼šåˆ—å‡ºè¯¥è®¾å¤‡çš„å®Œæ•´æ–‡ä»¶åï¼è€Œä¸æ˜¯ä»…åˆ—å‡ºæœ€åçš„åå­—è€Œå·²ã€‚ -t ï¼šåˆ—å‡ºè¯¥ç£ç›˜è®¾å¤‡çš„è¯¦ç»†æ•°æ®ï¼ŒåŒ…æ‹¬ç£ç›˜é˜Ÿåˆ—æœºåˆ¶ã€é¢„è¯»å†™çš„æ•°æ®é‡å¤§å°ç­‰ lsblk # NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINTS # nbd0 43:0 0 0B 0 disk # nbd1 43:32 0 0B 0 disk # nbd2 43:64 0 0B 0 disk # nbd3 43:96 0 0B 0 disk # nbd4 43:128 0 0B 0 disk # nbd5 43:160 0 0B 0 disk # nbd6 43:192 0 0B 0 disk # nbd7 43:224 0 0B 0 disk # vda 254:0 0 59.6G 0 disk # `-vda1 254:1 0 59.6G 0 part /etc/hosts # /etc/hostname # /etc/resolv.conf # vdb 254:16 0 535.2M 1 disk # nbd8 43:256 0 0B 0 disk # nbd9 43:288 0 0B 0 disk # nbd10 43:320 0 0B 0 disk # nbd11 43:352 0 0B 0 disk # nbd12 43:384 0 0B 0 disk # nbd13 43:416 0 0B 0 disk # nbd14 43:448 0 0B 0 disk # nbd15 43:480 0 0B 0 disk NAMEï¼šå°±æ˜¯è®¾å¤‡çš„æ–‡ä»¶åï¼ä¼šçœç•¥ /dev ç­‰å‰å¯¼ç›®å½•ï¼ MAJ:MINï¼šå…¶å®æ ¸å¿ƒè®¤è¯†çš„è®¾å¤‡éƒ½æ˜¯é€è¿‡è¿™ä¸¤ä¸ªä»£ç æ¥ç†Ÿæ‚‰çš„ï¼åˆ†åˆ«æ˜¯ä¸»è¦ï¼šæ¬¡è¦è®¾å¤‡ä»£ç ï¼ RMï¼šæ˜¯å¦ä¸ºå¯å¸è½½è®¾å¤‡ (removable device)ï¼Œå¦‚å…‰ç›˜ã€USB ç£ç›˜ç­‰ç­‰ SIZEï¼šå½“ç„¶å°±æ˜¯å®¹é‡å•°ï¼ ROï¼šæ˜¯å¦ä¸ºå”¯è¯»è®¾å¤‡çš„æ„æ€ TYPEï¼šæ˜¯ç£ç›˜ (disk)ã€åˆ†åŒº (partition) è¿˜æ˜¯å”¯è¯»å†…å­˜ (rom) ç­‰è¾“å‡º MOUTPOINTï¼šå°±æ˜¯æŒ‚è½½ç‚¹ï¼ ç¡¬ç›˜æ ¼å¼åŒ– åˆ†å‰²å®Œæ¯•åè‡ªç„¶å°±æ˜¯è¦è¿›è¡Œæ–‡ä»¶ç³»ç»Ÿçš„æ ¼å¼åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨mkfs(make filesystem)æ¥è¿›è¡Œåˆ†åŒºåç¡¬ç›˜çš„æ ¼å¼åŒ–ã€‚\nmkfs[tab][tab] # mkfs mkfs.cramfs mkfs.ext3 mkfs.minix # mkfs.bfs mkfs.ext2 mkfs.ext4 æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ æˆ‘ä»¬é¦–å…ˆè¦æ˜ç¡®ï¼ŒæŒ‚è½½ç‚¹æ˜¯ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯è¿›å…¥ç¡¬ç›˜åˆ†åŒºï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰çš„å…¥å£ã€‚åŒæ—¶æŒ‚è½½ä¹‹å‰æˆ‘ä»¬è¿˜åº”è¯¥ç¡®å®šä¸€äº›äº‹ï¼š\nå•ä¸€æ–‡ä»¶ç³»ç»Ÿä¸åº”è¯¥è¢«é‡å¤æŒ‚è½½åœ¨ä¸åŒçš„æŒ‚è½½ç‚¹(ç›®å½•)ä¸­ï¼› å•ä¸€ç›®å½•ä¸åº”è¯¥é‡å¤æŒ‚è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼› è¦ä½œä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ï¼Œç†è®ºä¸Šåº”è¯¥éƒ½æ˜¯ç©ºç›®å½•æ‰æ˜¯ã€‚ æŒ‚è½½ä½¿ç”¨çš„å‘½ä»¤æ˜¯mountï¼Œå…·ä½“å¦‚ä¸‹ï¼š\nmount -a mount [-l] mount [-t æ–‡ä»¶ç³»ç»Ÿ] LABEL=\u0026#39;\u0026#39; æŒ‚è½½ç‚¹ mount [-t æ–‡ä»¶ç³»ç»Ÿ] UUID=\u0026#39;\u0026#39; æŒ‚è½½ç‚¹ # é¸Ÿå“¥è¿‘æœŸå»ºè®®ç”¨è¿™ç§æ–¹å¼å–”ï¼ mount [-t æ–‡ä»¶ç³»ç»Ÿ] è®¾å¤‡æ–‡ä»¶å æŒ‚è½½ç‚¹ é€‰é¡¹ä¸å‚æ•°ï¼š -a ï¼šä¾ç…§è®¾ç½®æ¡£ [/etc/fstab](https://muicoder.github.io/linux_basic/0230filesystem.html#fstab)çš„æ•°æ®å°†æ‰€æœ‰æœªæŒ‚è½½çš„ç£ç›˜éƒ½æŒ‚è½½ä¸Šæ¥ -l ï¼šå•çº¯çš„è¾“å…¥ mount ä¼šæ˜¾ç¤ºç›®å‰æŒ‚è½½çš„ä¿¡æ¯ã€‚åŠ ä¸Š -l å¯å¢åˆ— Label åç§°ï¼ -t ï¼šå¯ä»¥åŠ ä¸Šæ–‡ä»¶ç³»ç»Ÿç§ç±»æ¥æŒ‡å®šæ¬²æŒ‚è½½çš„ç±»å‹ã€‚å¸¸è§çš„ Linux æ”¯æŒç±»å‹æœ‰ï¼šxfs, ext3, ext4, reiserfs, vfat, iso9660(å…‰ç›˜æ ¼å¼), nfs, cifs, smbfs (åä¸‰ç§ä¸ºç½‘ç»œæ–‡ä»¶ç³»ç»Ÿç±»å‹) è®¾å¤‡æ–‡ä»¶çš„å¸è½½ umount [-fn] è®¾å¤‡æ–‡ä»¶åæˆ–æŒ‚è½½ç‚¹ é€‰é¡¹ä¸å‚æ•°ï¼š -f ï¼šå¼ºåˆ¶å¸è½½ï¼å¯ç”¨åœ¨ç±»ä¼¼ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿ (NFS) æ— æ³•è¯»å–åˆ°çš„æƒ…å†µä¸‹ï¼› -l ï¼šç«‹åˆ»å¸è½½æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯” -f è¿˜å¼ºï¼ -n ï¼šä¸æ›´æ–° /etc/mtab æƒ…å†µä¸‹å¸è½½ã€‚ ç¡¬ç›˜çŠ¶æ€ dfï¼ˆdisk freeï¼‰ç”¨äºæ˜¾ç¤ºç£ç›˜çš„æ•´ä½“ä½¿ç”¨æƒ…å†µã€‚\ndf [-akmhHTi] [ç›®å½•æˆ–æ–‡ä»¶å] é€‰é¡¹ä¸å‚æ•°ï¼š -a ï¼šåˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç³»ç»Ÿç‰¹æœ‰çš„ /proc ç­‰æ–‡ä»¶ç³»ç»Ÿï¼› -k ï¼šä»¥ KBytes çš„å®¹é‡æ˜¾ç¤ºå„æ–‡ä»¶ç³»ç»Ÿï¼› -m ï¼šä»¥ MBytes çš„å®¹é‡æ˜¾ç¤ºå„æ–‡ä»¶ç³»ç»Ÿï¼› -h ï¼šä»¥äººä»¬è¾ƒæ˜“é˜…è¯»çš„ GBytes, MBytes, KBytes ç­‰æ ¼å¼è‡ªè¡Œæ˜¾ç¤ºï¼› -H ï¼šä»¥ M=1000K å–ä»£ M=1024K çš„è¿›ä½æ–¹å¼ï¼› -T ï¼šè¿åŒè¯¥ partition çš„ filesystem åç§° (ä¾‹å¦‚ xfs) ä¹Ÿåˆ—å‡ºï¼› -i ï¼šä¸ç”¨ç£ç›˜å®¹é‡ï¼Œè€Œä»¥ inode çš„æ•°é‡æ¥æ˜¾ç¤º df -h # Filesystem Size Used Avail Use% Mounted on # overlay 59G 1.3G 55G 3% / # tmpfs 64M 0 64M 0% /dev # shm 64M 0 64M 0% /dev/shm # /dev/vda1 59G 1.3G 55G 3% /etc/hosts # tmpfs 2.0G 0 2.0G 0% /proc/scsi # tmpfs 2.0G 0 2.0G 0% /sys/firmware duï¼ˆdisk usageï¼‰ç”¨äºæŸ¥çœ‹æ–‡ä»¶å’Œç›®å½•çš„ç£ç›˜ä½¿ç”¨æƒ…å†µã€‚\ndu [-ahskm] æ–‡ä»¶æˆ–ç›®å½•åç§° -a ï¼šåˆ—å‡ºæ‰€æœ‰çš„æ–‡ä»¶ä¸ç›®å½•å®¹é‡ï¼Œå› ä¸ºç¼ºçœä»…ç»Ÿè®¡ç›®å½•åº•ä¸‹çš„æ–‡ä»¶é‡è€Œå·²ã€‚ -h ï¼šä»¥äººä»¬è¾ƒæ˜“è¯»çš„å®¹é‡æ ¼å¼ (G/M) æ˜¾ç¤ºï¼› -s ï¼šåˆ—å‡ºæ€»é‡è€Œå·²ï¼Œè€Œä¸åˆ—å‡ºæ¯ä¸ªå„åˆ«çš„ç›®å½•å ç”¨å®¹é‡ï¼› -S ï¼šä¸åŒ…æ‹¬å­ç›®å½•ä¸‹çš„æ€»è®¡ï¼Œä¸ -s æœ‰ç‚¹å·®åˆ«ã€‚ -k ï¼šä»¥ KBytes åˆ—å‡ºå®¹é‡æ˜¾ç¤ºï¼› -m ï¼šä»¥ MBytes åˆ—å‡ºå®¹é‡æ˜¾ç¤ºï¼› Linuxæ–‡ä»¶ æ–‡ä»¶å±æ€§å’Œæƒé™çš„æ›´æ”¹ â€¢ chown ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…å’Œç»„ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œ ç”¨æˆ·å¿…é¡»æ˜¯å·²ç»å­˜åœ¨ç³»ç»Ÿä¸­çš„å¸å·ï¼Œä¹Ÿå°±æ˜¯åœ¨/etc/passwdÂ è¿™ä¸ªæ–‡ä»¶ä¸­æœ‰çºªå½•çš„ç”¨æˆ·åæ‰èƒ½æ”¹å˜ã€‚å¯æ›´æ”¹çš„ç»„åä¹Ÿè®°å½•åœ¨/etc/groupä¸­ã€‚\nchown [-R] ç”¨æˆ· æ–‡ä»¶æˆ–ç›®å½• chown [-R] ç”¨æˆ·:ç»„ æ–‡ä»¶æˆ–ç›®å½• é€‰é¡¹ä¸å‚æ•°ï¼š -R : è¿›è¡Œé€’å½’(recursive)çš„æŒç»­å˜æ›´ï¼Œäº¦å³è¿åŒæ¬¡ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½å˜æ›´ ll # total 32 # drwxr-xr-x 2 ubuntu ubuntu 4096 Mar 14 11:24 ./ # drwxr-x--- 1 ubuntu ubuntu 4096 Mar 14 11:24 ../ # -rw-r--r-- 1 ubuntu ubuntu 8733 Mar 13 16:25 dataloaders.py # -rw-r--r-- 1 ubuntu ubuntu 4231 Mar 13 16:24 lr_scheduler.py # -rw-r--r-- 1 ubuntu ubuntu 4043 Mar 13 16:24 torch_utils.py chown -R root:root ./ ll # total 32 # drwxr-xr-x 2 root root 4096 Mar 14 11:27 ./ # drwxr-x--- 1 ubuntu ubuntu 4096 Mar 14 11:24 ../ # -rw-r--r-- 1 root root 8748 Mar 14 11:27 dataloaders.py # -rw-r--r-- 1 root root 4231 Mar 13 16:24 lr_scheduler.py # -rw-r--r-- 1 root root 4043 Mar 13 16:24 torch_utils.py â€¢ chmod ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ï¼Œæ§åˆ¶è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€‚\næ•°å­— chmod [-R] xyz æ–‡ä»¶æˆ–ç›®å½• é€‰é¡¹ä¸å‚æ•°ï¼š xyz : å°±æ˜¯åˆšåˆšæåˆ°çš„æ•°å­—ç±»å‹çš„æƒé™å±æ€§ï¼Œä¸º r(4)w(2)x(1) å±æ€§æ•°å€¼çš„ç›¸åŠ ã€‚ -R : è¿›è¡Œé€’å½’(recursive)çš„æŒç»­å˜æ›´ï¼Œäº¦å³è¿åŒæ¬¡ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå˜æ›´ ll ./dataloader.py # -rw-r--r-- 1 root root 8748 Mar 14 11:27 dataloaders.py chmod a+w ./dataloader.py ll ./dataloader.py # -rw-rw-rw- 1 root root 8748 Mar 14 11:27 dataloaders.py chmod u=rw.go=r ./dataloader.py ll ./dataloader.py # -rw-r--r-- 1 root root 8748 Mar 14 11:27 ./dataloaders.py ç¬¦å· chmod u (user)\ng (group)\no (others)\na (all) +(åŠ å…¥) -(é™¤å») =(è®¾ç½®) r w x æ–‡ä»¶æˆ–ç›®å½• æ–‡ä»¶æœç´¢ find [PATH] [option] [action] é€‰é¡¹ä¸å‚æ•°ï¼š ä¸æ–‡ä»¶æƒé™åŠåç§°æœ‰å…³çš„å‚æ•°ï¼š -name filenameï¼šæœç´¢æ–‡ä»¶åç§°ä¸º filename çš„æ–‡ä»¶ï¼› -size [+-]SIZEï¼šæœç´¢æ¯” SIZE è¿˜è¦å¤§(+)æˆ–å°(-)çš„æ–‡ä»¶ã€‚è¿™ä¸ª SIZE çš„è§„æ ¼æœ‰ï¼šc: ä»£è¡¨ byteï¼Œ k: ä»£è¡¨ 1024bytesã€‚æ‰€ä»¥ï¼Œè¦æ‰¾æ¯” 50KBè¿˜è¦å¤§çš„æ–‡ä»¶ï¼Œå°±æ˜¯ã€ -size +50k ã€ -type TYPE ï¼šæœç´¢æ–‡ä»¶çš„ç±»å‹ä¸º TYPE çš„ï¼Œç±»å‹ä¸»è¦æœ‰ï¼šä¸€èˆ¬æ­£è§„æ–‡ä»¶ (f), è®¾å¤‡æ–‡ä»¶ (b, c), ç›®å½• (d), é“¾æ¥æ¡£ (l), socket (s), åŠ FIFO (p) ç­‰å±æ€§ã€‚ ll /Python # total 32 # drwxr-xr-x 2 root root 4096 Mar 14 11:40 ./ # drwxr-x--- 1 ubuntu ubuntu 4096 Mar 14 12:50 ../ # -rw-r--r-- 1 root root 8748 Mar 14 11:27 dataloaders.py # -rw-r--r-- 1 root root 4231 Mar 13 16:24 lr_scheduler.py # -rw-r--r-- 1 root root 4043 Mar 13 16:24 torch_utils.py find Python/ -name \u0026#39;*.py\u0026#39; # Python/torch_utils.py # Python/lr_scheduler.py # Python/dataloaders.py find Python/ -size -20k # Python/ # Python/torch_utils.py # Python/lr_scheduler.py # Python/dataloaders.py find Python/ -type f # Python/torch_utils.py # Python/lr_scheduler.py # Python/dataloaders.py ","permalink":"https://fordelkon.github.io/posts/cmd_intro_2/","summary":"\u003cp\u003eç†Ÿç»ƒä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ä¸€ç§å¸¸å¸¸è¢«å¿½è§†ï¼Œæˆ–è¢«è®¤ä¸ºéš¾ä»¥æŒæ¡çš„æŠ€èƒ½ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä¼šæé«˜ä½ ä½œä¸ºå·¥ç¨‹å¸ˆçš„çµæ´»æ€§ä»¥åŠç”Ÿäº§åŠ›ã€‚æœ¬æ–‡æ—¨åœ¨äº†è§£å‘½ä»¤è¡Œä¸­çš„é‡å®šå‘åŠŸèƒ½å’Œæ–‡ä»¶ç®¡ç†åŠŸèƒ½ã€‚\u003c/p\u003e","title":"ä½¿ç”¨å‘½ä»¤è¡Œçš„è‰ºæœ¯2"},{"content":"ç†Ÿç»ƒä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ä¸€ç§å¸¸å¸¸è¢«å¿½è§†ï¼Œæˆ–è¢«è®¤ä¸ºéš¾ä»¥æŒæ¡çš„æŠ€èƒ½ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä¼šæé«˜ä½ ä½œä¸ºå·¥ç¨‹å¸ˆçš„çµæ´»æ€§ä»¥åŠç”Ÿäº§åŠ›ã€‚æœ¬æ–‡æ—¨åœ¨äº†è§£å‘½ä»¤è¡Œçš„Shellè¯­è¨€çš„ä¸€äº›åŸºç¡€æ¦‚å¿µå’Œæœ‰å…³ä½¿ç”¨å‘½ä»¤è¡Œçš„Shellçš„ä¸€äº›å¿«æ·æ“ä½œï¼Œé¢å¤–å¸¦ä¸€äº›Linuxç³»ç»Ÿä¸­ç³»ç»Ÿæ–‡ä»¶è¯´æ˜\u0026hellip;\nä½¿ç”¨dockeræ‹‰å–Ubuntuå®¹å™¨ ç”±äºæœ¬äººçš„ç¬”è®°æœ¬å¹¶éLinuxæ“ä½œç³»ç»Ÿï¼Œä¸ºäº†æ–¹ä¾¿å‘½ä»¤è¡Œçš„å­¦ä¹ è€Œåˆä¸æƒ³æ­å»ºè™šæ‹ŸæœºåŒå¼€ç³»ç»Ÿï¼Œæˆ‘ä»¬ä½¿ç”¨Dockeræ¥æ‹‰å–ä¸€ä¸ªUbuntué•œåƒæ¥æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼Œæœ‰å…³Dockerçš„ä»‹ç»å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ä½¿ç”¨Dockerçš„è‰ºæœ¯ã€‚\næ‹‰å–Ubuntué•œåƒ docker pull ubuntu è¿è¡Œä¸€ä¸ªäº¤äº’å¼çš„ Ubuntu å®¹å™¨ docker run -it ubuntu docker runä¼šæ ¹æ®åé¢çš„é•œåƒåç§°æ‹‰èµ·ä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿›å…¥å®ƒçš„å‘½ä»¤è¡Œã€‚-it æ ‡å¿—è¡¨ç¤ºä»¥äº¤äº’æ¨¡å¼å¯åŠ¨ï¼Œå¹¶è¿æ¥åˆ°è¯¥å®¹å™¨çš„ç»ˆç«¯ã€‚è¿›å…¥å®¹å™¨åï¼Œä½ å°†è·å¾—ä¸€ä¸ªå®Œå…¨éš”ç¦»çš„ Linux ç³»ç»Ÿï¼Œå¯ä»¥åƒå¹³å¸¸ä¸€æ ·ä½¿ç”¨ Shellã€‚\né€€å‡ºå®¹å™¨ ä½ å¯ä»¥åœ¨Linuxç³»ç»Ÿä¸­è¿è¡Œ exit å‘½ä»¤æ¥é€€å‡ºå®¹å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½ é€€å‡ºå®¹å™¨åï¼Œå®¹å™¨ä¹Ÿä¼šè‡ªåŠ¨åœæ­¢ã€‚å¦‚æœä½ æƒ³ä¿æŒå®¹å™¨åœ¨åå°è¿è¡Œï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿è¡Œå®¹å™¨ï¼š docker run -d ubuntu é‡æ–°è¿›å…¥å®¹å™¨ å¦‚æœæ˜¯åœ¨Linuxç³»ç»Ÿä¸­è¿è¡Œexitå‘½ä»¤åï¼Œé€€å‡ºå®¹å™¨åå®¹å™¨è‡ªåŠ¨åœæ­¢ï¼Œæ­¤æ—¶å†æƒ³æ‰“å¼€è¿™ä¸ªå®¹å™¨çš„è¯æˆ‘ä»¬å…ˆè¿è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ˆåŒ…æ‹¬å·²ç»åœæ­¢çš„ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­æ‰¾åˆ°æˆ‘ä»¬çš„å®¹å™¨IDã€‚ docker ps -a # æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬åœæ­¢çš„ æˆ‘çš„ç”µè„‘ä¸Šè¾“å‡ºçš„ç»“æœæ˜¯ï¼š\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 3a8357da8968 ubuntu \u0026#34;/bin/bash\u0026#34; 2 minutes ago Exited (0) About a minute ago tender_elbakyan ç„¶åå†æ ¹æ®å®¹å™¨IDå¯åŠ¨ä¸€ä¸ªåœæ­¢çš„å®¹å™¨ï¼š\ndocker start 3a8357da8968 docker execä¼šè¿›å…¥ä¸€ä¸ªå·²ç»åœ¨è¿è¡Œçš„å®¹å™¨ï¼š\ndocker exec -it 3a8357da8968 /bin/bash åˆ é™¤å®¹å™¨å’Œé•œåƒ å½“æˆ‘ä»¬ä¸åœ¨éœ€è¦å®¹å™¨å’Œé•œåƒçš„æ—¶å€™ï¼Œå¯ä»¥åˆ é™¤å®¹å™¨å’Œé•œåƒæ¥èŠ‚çœå†…å­˜ã€‚é¦–å…ˆæ ¹æ®å®¹å™¨IDåˆ é™¤å®¹å™¨ï¼š docker rm 3a8357da8968 å†æ ¹æ®é•œåƒIDåˆ é™¤é•œåƒã€‚å…ˆå¾—åˆ°é•œåƒIDï¼š\ndocker images æˆ‘çš„ç”µè„‘çš„è¿è¡Œç»“æœæ˜¯ï¼š\nREPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest c3d1a3432580 6 weeks ago 101MB å†åˆ é™¤é•œåƒï¼š\ndocker rmi c3d1a3432580 Bash Shell Linuxç³»ç»Ÿæ–‡ä»¶ä¸­çš„shell Shellï¼ˆå£³ç¨‹åºï¼‰å¯ä»¥æä¾›ä½¿ç”¨è€…æ“ä½œåº”ç”¨ç¨‹åºçš„æ¥å£ã€‚/bin/bashæ˜¯Linuxé»˜è®¤çš„shellï¼ŒLinuxå¯ç”¨çš„shellè®°å½•åœ¨/etc/shellsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹Linuxå¯ç”¨çš„shellsï¼š\ncat /etc/shells å¾—åˆ°çš„è¾“å‡ºæ˜¯ï¼š\n# /etc/shells: valid login shells /bin/sh /usr/bin/sh /bin/bash /usr/bin/bash /bin/rbash /usr/bin/rbash /usr/bin/dash ç™»é™†Linuxç³»ç»Ÿæ—¶ï¼Œç³»ç»Ÿä¼šç»™äºˆä¸€ä¸ªshellï¼Œè¿™ä¸ªç™»é™†å–å¾—çš„shellè®°å½•åœ¨/etc/passwdä¸­ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š\ncat /etc/passwd å¾—åˆ°çš„è¾“å‡ºæ˜¯ï¼š\nroot@611b47761989:/# cat /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin ......ï¼ˆä¸‹é¢çœç•¥ï¼‰...... bash shellçš„åŠŸèƒ½ è®°å¿†ä½¿ç”¨è¿‡çš„æŒ‡ä»¤ï¼ˆè®°å½•çš„æŒ‡ä»¤åœ¨~/.bash_historyä¸­ï¼‰ å‘½ä»¤ä¸æ–‡ä»¶çš„è¡¥å…¨ï¼ˆä½¿ç”¨tabé”®ï¼Œä¸¤æ¬¡è¿æŒ‰tabé”®ä¼šå¯¹åŒ¹é…çš„å‘½ä»¤æˆ–æ–‡ä»¶è¿›è¡Œæ˜¾ç¤ºï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªä¸ä¹‹åŒ¹é…çš„å‘½ä»¤æˆ–æ–‡ä»¶ï¼Œåˆ™ä¸€æ¬¡tabé”®ä¼šè‡ªåŠ¨è¡¥å…¨ï¼‰ è®¾ç½®å‘½ä»¤åˆ«å æ¯”å¦‚è¦ç°å®ç›®å½•ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶ ï¼ˆåŒ…å«éšè—æ–‡ä»¶ï¼‰ åŠæ‰€æœ‰çš„æ–‡ä»¶å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ls -al ä½†æˆ‘ä»¬åˆæ˜¯å«Œå¼ƒè¿™æ ·å†™å¤ªè¿‡éº»çƒ¦ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»¥ä¸Šå‘½ä»¤è¿›è¡Œåˆ«åå‘½åï¼š\nalias lm=\u0026#39;ls -al\u0026#39; é‚£ä¹ˆlmçš„åŠŸèƒ½å°±å’Œä¹‹å‰çš„ls -alåŠŸèƒ½ä¸€è‡´äº†ã€‚\nç¨‹åºåŒ–è„šæœ¬ï¼ˆshell scriptï¼‰ ä¸‡ç”¨å­—ç¬¦åŒ¹é…*ï¼ˆæŒ‡ä»¤åˆ—è¾“å…¥æŒ‡ä»¤çš„ä¸‡ç”¨å­—ç¬¦ï¼Œä¸å¸¦å¼•å·ï¼‰ ç¬¦å· æ„ä¹‰ * ä»£è¡¨â€œ 0 ä¸ªåˆ°æ— ç©·å¤šä¸ªâ€ä»»æ„å­—ç¬¦ ? ä»£è¡¨â€œä¸€å®šæœ‰ä¸€ä¸ªâ€ä»»æ„å­—ç¬¦ [ ] åŒæ ·ä»£è¡¨â€œä¸€å®šæœ‰ä¸€ä¸ªåœ¨æ‹¬å·å†…â€çš„å­—ç¬¦ï¼ˆéä»»æ„å­—ç¬¦ï¼‰ã€‚ä¾‹å¦‚[abcd] ä»£è¡¨â€œä¸€å®šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œ å¯èƒ½æ˜¯ a, b, c, d è¿™å››ä¸ªä»»ä½•ä¸€ä¸ªâ€ [ - ] è‹¥æœ‰å‡å·åœ¨ä¸­æ‹¬å·å†…æ—¶ï¼Œä»£è¡¨â€œåœ¨ç¼–ç é¡ºåºå†…çš„æ‰€æœ‰å­—ç¬¦â€ã€‚ä¾‹å¦‚[0-9] ä»£è¡¨ 0 åˆ° 9 ä¹‹é—´çš„æ‰€æœ‰æ•°å­—ï¼Œå› ä¸ºæ•°å­—çš„è¯­ç³»ç¼–ç æ˜¯è¿ç»­çš„ï¼ [^ ] è‹¥ä¸­æ‹¬å·å†…çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºæŒ‡æ•°ç¬¦å· ï¼ˆ^ï¼‰ ï¼Œé‚£è¡¨ç¤ºâ€œåå‘é€‰æ‹©â€ï¼Œä¾‹å¦‚ [^abc] ä»£è¡¨ ä¸€å®šæœ‰ä¸€ä¸ªå­—ç¬¦ï¼Œåªè¦æ˜¯é a, b, c çš„å…¶ä»–å­—ç¬¦å°±æ¥å—çš„æ„æ€ã€‚ ä¸å‘½ä»¤è¡Œç›¸å…³çš„ç‰¹æ®Šç¬¦å· # æ³¨è§£ç¬¦å·ï¼šè¿™ä¸ªæœ€å¸¸è¢«ä½¿ç”¨åœ¨ script å½“ä¸­ï¼Œè§†ä¸ºè¯´æ˜ï¼åœ¨åçš„æ•°æ®å‡ä¸æ‰§è¡Œ \\ è·³è„±ç¬¦å·ï¼šå°†â€œç‰¹æ®Šå­—ç¬¦æˆ–ä¸‡ç”¨å­—ç¬¦â€è¿˜åŸæˆä¸€èˆ¬å­—ç¬¦ | ç®¡é“ï¼ˆpipeï¼‰ï¼šåˆ†éš”ä¸¤ä¸ªç®¡çº¿å‘½ä»¤çš„ç•Œå®šï¼› ; è¿ç»­æŒ‡ä»¤ä¸‹è¾¾åˆ†éš”ç¬¦å·ï¼šè¿ç»­æ€§å‘½ä»¤çš„ç•Œå®š ï¼ˆæ³¨æ„ï¼ä¸ç®¡çº¿å‘½ä»¤å¹¶ä¸ç›¸åŒï¼‰ ~ ä½¿ç”¨è€…çš„ä¸»æ–‡ä»¶å¤¹ $ å–ç”¨å˜é‡å‰ç½®å­—ç¬¦ï¼šäº¦å³æ˜¯å˜é‡ä¹‹å‰éœ€è¦åŠ çš„å˜é‡å–ä»£å€¼ \u0026amp; å·¥ä½œæ§åˆ¶ ï¼ˆjob controlï¼‰ï¼šå°†æŒ‡ä»¤å˜æˆèƒŒæ™¯ä¸‹å·¥ä½œ ! é€»è¾‘è¿ç®—æ„ä¹‰ä¸Šçš„â€œéâ€ not çš„æ„æ€ï¼ / ç›®å½•ç¬¦å·ï¼šè·¯å¾„åˆ†éš”çš„ç¬¦å· \u0026gt;, \u0026raquo; æ•°æ®æµé‡å¯¼å‘ï¼šè¾“å‡ºå¯¼å‘ï¼Œåˆ†åˆ«æ˜¯â€œå–ä»£â€ä¸â€œç´¯åŠ â€ \u0026lt;, \u0026laquo; æ•°æ®æµé‡å¯¼å‘ï¼šè¾“å…¥å¯¼å‘ \u0026rsquo; ' å•å¼•å·ï¼Œä¸å…·æœ‰å˜é‡ç½®æ¢çš„åŠŸèƒ½ ï¼ˆ$ å˜ä¸ºçº¯æ–‡æœ¬ï¼‰ \u0026quot; \u0026quot; å…·æœ‰å˜é‡ç½®æ¢çš„åŠŸèƒ½ï¼ ï¼ˆ$ å¯ä¿ç•™ç›¸å…³åŠŸèƒ½ï¼‰ ä¸¤ä¸ªâ€œ ` â€ä¸­é—´ä¸ºå¯ä»¥å…ˆæ‰§è¡Œçš„æŒ‡ä»¤ï¼Œäº¦å¯ä½¿ç”¨ $ï¼ˆ ï¼‰ ï¼ˆ ï¼‰ åœ¨ä¸­é—´ä¸ºå­ shell çš„èµ·å§‹ä¸ç»“æŸ { } åœ¨ä¸­é—´ä¸ºå‘½ä»¤åŒºå—çš„ç»„åˆï¼ bash shellçš„å†…ç½®å‘½ä»¤æŸ¥è¯¢ï¼štype é€šè¿‡typeæŒ‡ä»¤æˆ‘ä»¬å¯ä»¥çŸ¥é“æ¯ä¸ªæŒ‡ä»¤æ˜¯å¦ä¸º bash çš„å†…ç½®æŒ‡ä»¤ï¼Œæ­¤å¤–åˆ©ç”¨typeæœå¯»åé¢çš„åç§°æ—¶ï¼Œå¦‚æœåé¢æ¥çš„åç§°å¹¶ä¸èƒ½ä»¥å¯æ‰§è¡Œæ–‡ä»¶çš„çŠ¶æ€è¢«æ‰¾åˆ°ï¼Œ é‚£ä¹ˆè¯¥åç§°æ˜¯ä¸ä¼šè¢«æ˜¾ç¤ºå‡ºæ¥çš„ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æ¥ä»£æ›¿åŸå‘½ä»¤ã€‚\ntype -a ls å¾—åˆ°çš„è¾“å‡ºä¸ºï¼š\nls is aliased to `ls --color=auto\u0026#39; ls is /usr/bin/ls ls is /bin/ls å› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ/usr/bin/lsæˆ–/bin/lsæ¥ä»£æ›¿lsã€‚æ‰¾æŒ‡ä»¤ä¹Ÿå¯ä»¥ä½¿ç”¨whichã€‚\nbash shellä¸­çš„å¿«é€Ÿç¼–è¾‘æŒ‰é’® ctrl-ræœç´¢å‘½ä»¤è¡Œå†å²è®°å½•ï¼ˆæŒ‰ä¸‹æŒ‰é”®ä¹‹åï¼Œè¾“å…¥å…³é”®å­—ä¾¿å¯ä»¥æœç´¢ï¼Œé‡å¤æŒ‰ä¸‹ctrl-rä¼šå‘åæŸ¥æ‰¾åŒ¹é…é¡¹ï¼ŒæŒ‰ä¸‹Enteré”®ä¼šæ‰§è¡Œå½“å‰åŒ¹é…çš„å‘½ä»¤ï¼Œè€ŒæŒ‰ä¸‹å³æ–¹å‘é”®ä¼šå°†åŒ¹é…é¡¹æ”¾å…¥å½“å‰è¡Œä¸­ï¼Œä¸ä¼šç›´æ¥æ‰§è¡Œï¼Œä»¥ä¾¿åšå‡ºä¿®æ”¹ï¼‰ã€‚ ctrl-wåˆ é™¤ä½ é”®å…¥çš„æœ€åä¸€ä¸ªå•è¯ï¼Œctrl-uå¯ä»¥åˆ é™¤è¡Œå†…å…‰æ ‡æ‰€åœ¨ä½ç½®ä¹‹å‰çš„å†…å®¹ï¼Œalt-bå’ŒÂ alt-få¯ä»¥ä»¥å•è¯ä¸ºå•ä½ç§»åŠ¨å…‰æ ‡ï¼Œctrl-aå¯ä»¥å°†å…‰æ ‡ç§»è‡³è¡Œé¦–ï¼Œctrl-eå¯ä»¥å°†å…‰æ ‡ç§»è‡³è¡Œå°¾ï¼Œctrl-kå¯ä»¥åˆ é™¤å…‰æ ‡è‡³è¡Œå°¾çš„æ‰€æœ‰å†…å®¹ï¼Œctrl-lå¯ä»¥æ¸…å±ã€‚é”®å…¥Â man readlineÂ å¯ä»¥æŸ¥çœ‹ Bash ä¸­çš„é»˜è®¤å¿«æ·é”®ã€‚å†…å®¹æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚Â alt-.å¾ªç¯åœ°ç§»å‘å‰ä¸€ä¸ªå‚æ•°ï¼Œè€Œalt-*å¯ä»¥å±•å¼€é€šé…ç¬¦ã€‚ shellçš„å˜é‡ å­—ç¬¦ä¸²å’Œæ•°ç»„æ˜¯ Shell ä¸­æœ€å¸¸ç”¨çš„å˜é‡ç±»å‹ã€‚ å¦‚æœå˜é‡ç±»å‹æ˜¯æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éå†æ‰€æœ‰å…ƒç´ ï¼š\nnames=(\u0026#34;delkon\u0026#34; \u0026#34;ikun\u0026#34; \u0026#34;bob\u0026#34;) echo \u0026#34;${names[@]}\u0026#34; # delkon ikun bob # ä½†æ˜¯ä¸‹é¢çš„å‘½ä»¤åªèƒ½ç´¢å¼•åˆ°ç¬¬ä¸€ä¸ªå…ƒç´  echo \u0026#34;$names\u0026#34; delkon ä½¿ç”¨echoå‘½ä»¤å¯ä»¥è¯»å‡ºå˜é‡ echo ${variable}è¯»å‡ºvariableçš„å€¼(variableæ˜¯å­—ç¬¦ä¸²) echo $(command)è¯»å‡ºcommandçš„stdout echo $((expression))è¯»å‡ºè¡¨è¾¾å¼çš„å€¼\nç³»ç»Ÿè‡ªå¸¦çš„ç¯å¢ƒå˜é‡ åˆ©ç”¨etcè§‚å¯Ÿç³»ç»Ÿè‡ªå¸¦ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼š\nHOSTNAME=611b47761989 # è¿™éƒ¨ä¸»æœºçš„ä¸»æœºåç§° PWD=/ # å½“å‰å·¥ä½œç›®å½• HOME=/root # å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½• LS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=00:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.avif=01;35:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.webp=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:*~=00;90:*#=00;90:*.bak=00;90:*.crdownload=00;90:*.dpkg-dist=00;90:*.dpkg-new=00;90:*.dpkg-old=00;90:*.dpkg-tmp=00;90:*.old=00;90:*.orig=00;90:*.part=00;90:*.rej=00;90:*.rpmnew=00;90:*.rpmorig=00;90:*.rpmsave=00;90:*.swp=00;90:*.tmp=00;90:*.ucf-dist=00;90:*.ucf-new=00;90:*.ucf-old=00;90: TERM=xterm # è¿™ä¸ªç»ˆç«¯æœºä½¿ç”¨çš„ç¯å¢ƒæ˜¯ä»€ä¹ˆç±»å‹ SHLVL=1 # å½“å‰ shell ä¼šè¯çš„æ·±åº¦å±‚çº§ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin # ç³»ç»Ÿæœç´¢å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„åˆ—è¡¨ _=/usr/bin/env # è¿™æ˜¯æœ€åä¸€ä¸ªæ‰§è¡Œå‘½ä»¤çš„è·¯å¾„ æ¯”è¾ƒé‡è¦çš„é™¤äº†ä¸Šé¢ä»‹ç»çš„ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªRANDOMå˜é‡ï¼Œåœ¨ BASH çš„ç¯å¢ƒä¸‹ï¼Œè¿™ä¸ª RANDOM å˜é‡çš„å†…å®¹ï¼Œä»‹äº 0~32767 ä¹‹é—´ï¼Œç”±/dev/randomä¹±æ•°å™¨äº§ç”Ÿã€‚\nbashå†…çš„è‡ªè®¢å˜é‡ åˆ©ç”¨setå‘½ä»¤è§‚å¯Ÿbashå†…çš„å…¶ä»–å˜é‡å¦‚ä¸‹ï¼š\nBASH=/bin/bash ...... BASH_ALIASES=() BASH_ARGC=([0]=\u0026#34;0\u0026#34;) BASH_ARGV=() BASH_CMDS=() BASH_LINENO=() BASH_LOADABLES_PATH=/usr/local/lib/bash:/usr/lib/bash:/opt/local/lib/bash:/usr/pkg/lib/bash:/opt/pkg/lib/bash:. BASH_SOURCE=() BASH_VERSINFO=([0]=\u0026#34;5\u0026#34; [1]=\u0026#34;2\u0026#34; [2]=\u0026#34;21\u0026#34; [3]=\u0026#34;1\u0026#34; [4]=\u0026#34;release\u0026#34; [5]=\u0026#34;aarch64-unknown-linux-gnu\u0026#34;) BASH_VERSION=\u0026#39;5.2.21(1)-release\u0026#39; COLUMNS=80 DIRSTACK=() EUID=0 GROUPS=() HISTCONTROL=ignoredups:ignorespace HISTFILE=/root/.bash_history HISTFILESIZE=2000 HISTSIZE=1000 HOME=/root HOSTNAME=611b47761989 HOSTTYPE=aarch64 IFS=$\u0026#39; \\t\\n\u0026#39; LINES=25 ...... MACHTYPE=aarch64-unknown-linux-gnu MAILCHECK=60 OPTERR=1 OPTIND=1 OSTYPE=linux-gnu PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin PIPESTATUS=([0]=\u0026#34;0\u0026#34;) PPID=0 PS1=\u0026#39;\\[\\e]0;\\u@\\h: \\w\\a\\]${debian_chroot:+($debian_chroot)}\\u@\\h:\\w\\$ \u0026#39; PS2=\u0026#39;\u0026gt; \u0026#39; PS4=\u0026#39;+ \u0026#39; PWD=/ SHELL=/bin/bash SHELLOPTS=braceexpand:emacs:hashall:histexpand:history:interactive-comments:monitor SHLVL=1 TERM=xterm UID=0 _=clear ä¸Šé¢çš„å˜é‡æœ‰ä¸€äº›æ¯”è¾ƒé‡è¦ï¼Œæˆ‘ä»¬åˆ†è€Œè¿°ä¹‹ã€‚\nPS1ï¼šï¼ˆæç¤ºå­—ç¬¦çš„è®¾ç½®ï¼‰ å½“æˆ‘ä»¬æ¯æ¬¡æŒ‰ä¸‹enteré”®å»æ‰§è¡ŒæŸä¸ªæŒ‡ä»¤åï¼Œæœ€åè¦å†æ¬¡å‡ºç°æç¤ºç¬¦æ—¶å°±ä¼šå»è¯»å–è¿™ä¸ªå˜é‡å€¼ã€‚ PS1=\u0026#39;\\[\\e]0;\\u@\\h: \\w\\a\\]${debian_chroot:+($debian_chroot)}\\u@\\h:\\w\\$ \u0026#39; å…¶ä¸­\\[\\e]0;...\\a\\]: è¿™æ˜¯ä¸€ä¸ª ANSI è½¬ä¹‰åºåˆ—ï¼Œç”¨äºåœ¨æ”¯æŒçš„ç»ˆç«¯ä¸­è®¾ç½®çª—å£çš„æ ‡é¢˜æˆ–å›¾æ ‡ã€‚${debian_chroot:+($debian_chroot)}æ˜¯æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºåœ¨ Debian æˆ–å…¶ä»–å¸¦æœ‰ chroot ç¯å¢ƒæ—¶æ˜¾ç¤ºå½“å‰çš„ chroot åç§°ã€‚\\u@\\hæ˜¾ç¤ºæ ¼å¼ä¸º ç”¨æˆ·å@ä¸»æœºåï¼Œ\\wæ˜¾ç¤ºå½“å‰çš„å·¥ä½œç›®å½•ï¼Œæœ€å\\$æ ¹æ®å½“å‰ç”¨æˆ·æ˜¯å¦æ˜¯è¶…çº§ç”¨æˆ·æ˜¾ç¤ºä¸åŒçš„ç¬¦å·ã€‚è¿˜æœ‰ä¸€äº›å…¶ä»–æ¯”è¾ƒæœ‰æ„æ€çš„ç¬¦å·ï¼Œæ¯”å¦‚\n# ï¼š ä¸‹è¾¾çš„ç¬¬å‡ ä¸ªæŒ‡ä»¤ã€‚ \\t ï¼šæ˜¾ç¤ºæ—¶é—´ï¼Œä¸º 24 å°æ—¶æ ¼å¼çš„â€œHH:MM:SSâ€ \\T ï¼šæ˜¾ç¤ºæ—¶é—´ï¼Œä¸º 12 å°æ—¶æ ¼å¼çš„â€œHH:MM:SSâ€ \\A ï¼šæ˜¾ç¤ºæ—¶é—´ï¼Œä¸º 24 å°æ—¶æ ¼å¼çš„â€œHH:MMâ€ \\@ ï¼šæ˜¾ç¤ºæ—¶é—´ï¼Œä¸º 12 å°æ—¶æ ¼å¼çš„â€œam/pmâ€æ ·å¼ $ï¼šæœ¬shellçš„PID æˆ‘ä»¬å¯ä»¥è¿è¡Œecho ${$}æ¥å±•ç¤ºæœ¬shellçš„PIDå·ç ï¼Œç»“æœå¦‚ä¸‹: 51 ?ï¼šä¸Šä¸ªæ‰§è¡ŒæŒ‡ä»¤çš„å›ä¼ å€¼ å¦‚æœæˆåŠŸçš„æ‰§è¡Œä¸Šä¸ªæŒ‡ä»¤ï¼Œ åˆ™ä¼šå›ä¼ ä¸€ä¸ª 0 å€¼ï¼Œå¦‚æœæ‰§è¡Œè¿‡ç¨‹å‘ç”Ÿé”™è¯¯ï¼Œå°±ä¼šå›ä¼ éä¸º 0 çš„æ•°å€¼ã€‚å…·ä½“æƒ…å½¢å¦‚ä¸‹æ‰€ç¤ºï¼š cd cati ç»“æœä¸ºï¼š\nbash: cd: cati: No such file or directory å†è¿è¡Œï¼š\necho ${?} ç»“æœä¸ºï¼š\n1 è‡ªè®¢å˜é‡å’Œç¯å¢ƒå˜é‡çš„è½¬æ¢ è‡ªè®¢å˜é‡è½¬æˆç¯å¢ƒå˜é‡ é‡‡ç”¨exportå‘½ä»¤æˆ–declare -xï¼š export variable declare -x variable ç¯å¢ƒå˜é‡ï¼ˆç”±è‡ªè®¢å˜é‡è½¬æ¢è€Œæˆçš„ç¯å¢ƒå˜é‡ï¼‰è½¬æˆè‡ªè®¢å˜é‡ declare [-aixr] variable é€‰é¡¹ä¸å‚æ•°ï¼š -a ï¼šå°†åé¢åä¸º variable çš„å˜é‡å®šä¹‰æˆä¸ºé˜µåˆ— ï¼ˆarrayï¼‰ ç±»å‹ -i ï¼šå°†åé¢åä¸º variable çš„å˜é‡å®šä¹‰æˆä¸ºæ•´æ•°æ•°å­— ï¼ˆintegerï¼‰ ç±»å‹ -x ï¼šç”¨æ³•ä¸ export ä¸€æ ·ï¼Œå°±æ˜¯å°†åé¢çš„ variable å˜æˆç¯å¢ƒå˜é‡ï¼› -r ï¼šå°†å˜é‡è®¾ç½®æˆä¸º readonly ç±»å‹ï¼Œè¯¥å˜é‡ä¸å¯è¢«æ›´æ”¹å†…å®¹ï¼Œä¹Ÿä¸èƒ½ unset é‡‡ç”¨declare +x:\ndeclare +x variable bashä¸­ä¸å˜é‡æ‰©å±•æ–¹å¼ #ï¼šä»å­—ç¬¦ä¸²å¼€å¤´åˆ é™¤ä¸patternåŒ¹é…çš„æœ€çŸ­éƒ¨åˆ†ï¼Œå¹¶è¿”å›å‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚ä¹Ÿå¯ä»¥ç”¨æ¥è·å–å˜é‡çš„å­—ç¬¦é•¿åº¦ã€‚ è¯­æ³•ï¼š${variable#pattern} è¯­æ³•ï¼š${#variable} ##ï¼šä»å­—ç¬¦ä¸²å¼€å¤´åˆ é™¤ä¸patternåŒ¹é…çš„æœ€é•¿éƒ¨åˆ†ï¼Œå¹¶è¿”å›å‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼š${variable##pattern} å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š\nstr=abc.defg.hijkl.txt echo ${str#*.} # defg.hijkl.txt echo ${str##*.} # txt %: ä»å­—ç¬¦ä¸²æœ«å°¾åˆ é™¤ä¸ pattern åŒ¹é…çš„æœ€çŸ­éƒ¨åˆ†ï¼Œå¹¶è¿”å›å‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼š${variable%pattern} %%ï¼šä»å­—ç¬¦ä¸²æœ«å°¾åˆ é™¤ä¸ pattern åŒ¹é…çš„æœ€çŸ­éƒ¨åˆ†ï¼Œå¹¶è¿”å›å‰©ä¸‹çš„å­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼š${variable%%pattern} å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š echo ${str%.*} # abc.defg.hijkl echo ${str%%.*} # abc /ï¼šå°†å˜é‡ variable ä¸­ç¬¬ä¸€ä¸ªåŒ¹é… pattern çš„éƒ¨åˆ†æ›¿æ¢ä¸º replacementã€‚ è¯­æ³•ï¼š${variable/pattern/replacement} //ï¼šå°†å˜é‡ variable ä¸­æ‰€æœ‰åŒ¹é… pattern çš„éƒ¨åˆ†æ›¿æ¢ä¸º replacementã€‚ è¯­æ³•ï¼š${variable//pattern/replacement} å…·ä½“ç¤ºä¾‹å¦‚ä¸‹ï¼š fname=delkon-university-works echo ${fname/-/_} # delkon_university-works echo ${fname//-/_} # delkon_university_works :-ï¼šå¦‚æœå˜é‡æœªå®šä¹‰æˆ–ä¸ºç©ºï¼Œåˆ™è¿”å›defaultå€¼ã€‚ è¯­æ³•ï¼š${variable:-default} :=ï¼šå¦‚æœå˜é‡æœªå®šä¹‰æˆ–ä¸ºç©ºï¼Œåˆ™å°†å…¶èµ‹å€¼ä¸º defaultã€‚ è¯­æ³•ï¼š${variable:=default} :+ï¼šå¦‚æœå˜é‡å·²å®šä¹‰ä¸”ä¸ä¸ºç©ºï¼Œåˆ™è¿”å› replacementï¼Œå¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼š${variable:+replacement} :?ï¼šå¦‚æœå˜é‡æœªå®šä¹‰æˆ–ä¸ºç©ºï¼Œåˆ™è¾“å‡º error æ¶ˆæ¯å¹¶é€€å‡ºè„šæœ¬ã€‚ è¯­æ³•ï¼š${variable:?error} å…·ä½“ä¸€äº›æƒ…å†µå¦‚ä¸‹è¡¨æ ¼æ‰€ç¤ºï¼š\nå˜é‡è®¾ç½®æ–¹å¼ str æ²¡æœ‰è®¾ç½® str ä¸ºç©ºå­—ä¸² str å·²è®¾ç½®éä¸ºç©ºå­—ä¸² var=${str-expr} var=expr var= var=$str var=${str:-expr} var=expr var=expr var=$str var=${str+expr} var= var=expr var=expr var=${str:+expr} var= var= var=expr var=${str=expr} str=expr var=expr str ä¸å˜ var= str ä¸å˜ var=$str var=${str:=expr} str=expr var=expr str=expr var=expr str ä¸å˜ var=$str var=${str?expr} expr è¾“å‡ºè‡³ stderr var= var=$str var=${str:?expr} expr è¾“å‡ºè‡³ stderr expr è¾“å‡ºè‡³ stderr var=$str ${variable:offset}å’Œ${variable:offset:length}ç”¨æ¥ä»å˜é‡ä¸­æå–å­å­—ç¬¦ä¸²ã€‚ bashé…ç½® sourceæˆ–.åæ¥é…ç½®æ–‡ä»¶ä¼šç«‹å³ä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ã€‚\n","permalink":"https://fordelkon.github.io/posts/cmd_intro_1/","summary":"\u003cp\u003eç†Ÿç»ƒä½¿ç”¨å‘½ä»¤è¡Œæ˜¯ä¸€ç§å¸¸å¸¸è¢«å¿½è§†ï¼Œæˆ–è¢«è®¤ä¸ºéš¾ä»¥æŒæ¡çš„æŠ€èƒ½ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒä¼šæé«˜ä½ ä½œä¸ºå·¥ç¨‹å¸ˆçš„çµæ´»æ€§ä»¥åŠç”Ÿäº§åŠ›ã€‚æœ¬æ–‡æ—¨åœ¨äº†è§£å‘½ä»¤è¡Œçš„Shellè¯­è¨€çš„ä¸€äº›åŸºç¡€æ¦‚å¿µå’Œæœ‰å…³ä½¿ç”¨å‘½ä»¤è¡Œçš„Shellçš„ä¸€äº›å¿«æ·æ“ä½œï¼Œé¢å¤–å¸¦ä¸€äº›Linuxç³»ç»Ÿä¸­ç³»ç»Ÿæ–‡ä»¶è¯´æ˜\u0026hellip;\u003c/p\u003e","title":"ä½¿ç”¨å‘½ä»¤è¡Œçš„è‰ºæœ¯1"},{"content":"è¿™ç¯‡åšå®¢ä¸»è¦è‡ªåº•å‘ä¸Šåœ°ä»‹ç»Gitå‘½ä»¤è¡Œï¼Œæœ‰æ—¶ç”šè‡³ä¼šä½¿ç”¨ä¸€äº›pythonä»£ç æ¥å¯¹ä¸€äº›Gitçš„åŠŸèƒ½è¿›è¡Œæ›´åŠ è¯¦ç»†çš„åˆ†æã€‚æˆ‘ä¸€ç›´è®¤ä¸ºåŸºç¡€ä¸€æ—¦æ‰“å¥½ï¼Œé‚£ä¹ˆä¸€äº›æ›´é«˜çº§çš„ç”¨æ³•ä¹Ÿå¯ä»¥å¾ªåºæ¸è¿›åœ°äº†è§£ï¼Œè€Œä¸”æ˜¯æ›´åŠ é€å½»çš„äº†è§£ã€‚ä¸æ˜¯åƒåšä¸»ä¸€å¼€å§‹é‚£æ ·ä»¥ä¸ºåªè¦æ­»è®°ç¡¬èƒŒgit addï¼Œgit commit,git pullï¼Œgit cloneç­‰å¸¸è§å‘½ä»¤çš„ä¸€äº›ç”¨æ³•å°±å¯ä»¥äº†ğŸ˜­ï¼ˆå®é™…ä¸Šç½‘ä¸Šå¤§å¤šæ•°æ•™ç¨‹å°±æ˜¯è¿™æ ·æ•™çš„\u0026hellip;ï¼‰ï¼Œåœ¨è¿™ä¸Šé¢èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œæ‰€ä»¥ä»å¤´å¼€å§‹æ‰“åœ°åŸºå†™ä½œæ­¤æ–‡ç•™ä»¥è­¦ç¤ºâš ï¸ã€‚\nGitä»“åº“ï¼ˆGit Repositoryï¼‰ è¦å­¦ä¹ Gitï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æˆ‘ä»¬è¿è¡ŒGitå‘½ä»¤æ˜¯å¯¹ä»€ä¹ˆå¯¹è±¡è¿›è¡Œæ“ä½œçš„ï¼Œåœ¨Gitçš„ç›¸å…³æœ¯è¯­ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å«åšGitä»“åº“ï¼ˆGit Repositoryï¼‰ï¼ŒGitä»“åº“å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œæˆ‘ä»¬é€šè¿‡.gitæ–‡ä»¶å¤¹ï¼ˆéšè—æ–‡ä»¶å¤¹ï¼‰å¯¹Gitä»“åº“ä¸­çš„å·¥ä½œåŒºä¸­çš„æ–‡ä»¶ï¼ˆééšè—æ–‡ä»¶å¤¹ï¼‰å†…å®¹çš„æ”¹å˜è¿›è¡Œè®°å½•ï¼Œå½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶çš„æ”¹å˜éƒ½ä¼šè¢«è®°å½•ï¼Œè¢«.gitingoreæ–‡ä»¶æ‰€æ ‡è¯†çš„æ–‡ä»¶è¢«æ”¹å˜å.gitæ–‡ä»¶å¤¹ä¸ä¼šå¯¹å…¶è¿›è¡Œè®°å½•ã€‚æ ¹æ®æˆ‘ä¸Šé¢æ‰€è¯´ï¼ŒGitæ“ä½œæœ€éšæ™¦çš„åœ°æ–¹å°±åœ¨äºå¯¹äº.gitæ–‡ä»¶å¤¹ä¸­å†…å®¹çš„ä¿®æ”¹æ¥ä¿è¯å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å†…å®¹ä¿®æ”¹çš„è®°å½•ã€‚\næ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸‹ç®€ç•¥çš„å…¬å¼ï¼š\n$$\\mathrm{Git}\\ \\mathrm{Repository} = \\mathrm{.git}\\ \\mathrm{folder} + \\mathrm{worktree}\\ \\mathrm{folder}\\tag{1}$$ æ›´åŠ è¯¦å°½çš„æ¥è¯´ä»¥pythonæ¥æ„å»ºGitä»“åº“ç±»ï¼š\nclass GitRepository (object): \u0026#34;\u0026#34;\u0026#34;A git repository\u0026#34;\u0026#34;\u0026#34; worktree = None gitdir = None def __init__(self, path): self.worktree = path self.gitdir = os.path.join(path, \u0026#34;.git\u0026#34;) .gitæ–‡ä»¶å¤¹å†…éƒ¨ç»“æ„æ¢ç©¶ å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†Gitæ“ä½œæœ€éšæ™¦çš„åœ°æ–¹å°±åœ¨äºå¯¹äº.gitæ–‡ä»¶å¤¹ä¸­å†…å®¹çš„ä¿®æ”¹æ¥ä¿è¯å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å†…å®¹ä¿®æ”¹çš„è®°å½•ï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å¯¹æ­¤è¿›è¡Œè„±è´«æ”»åšäº†ã€‚ç”±äº.gitæ˜¯éšè—æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¯¹.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒæœ‰ä¸€å®šçš„äº†è§£ï¼Œgit initåˆå§‹åŒ–åçš„.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒå¦‚å›¾1æ‰€ç¤ºï¼Œæ­¤æ—¶Gitä»“åº“å†…é™¤äº†.gitæ–‡ä»¶å¤¹ä¹‹å¤–ä¸€ç‰‡è’èŠœã€‚\nå›¾1ï¼šè¿è¡Œgit initä¹‹å.gitæ–‡ä»¶å¤¹çš„æ–‡ä»¶åˆ†å¸ƒç»“æ„ ç„¶åæˆ‘ä»¬å†æœ¬åœ°Gitä»“åº“ä¸­æ·»åŠ å¯è§æ–‡ä»¶ï¼Œæ·»åŠ åçš„ç»“æœå¦‚å›¾2æ‰€ç¤ºã€‚\nå›¾2ï¼šGitä»“åº“æ·»åŠ æ–‡ä»¶åçš„æ–‡ä»¶åˆ†å¸ƒ å°†ä¸Šè¿°æ‰€æœ‰æ–‡ä»¶è¿è¡Œgit addä¹‹ååœ¨è¿›è¡Œgit commitè§‚å¯Ÿ.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ç›¸è¾ƒäºæœ€åˆçš„.gitæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨git addå’Œgit commitä¹‹åæ–‡ä»¶å¤¹ä¸­å¤šå‡ºäº†indexæ–‡ä»¶ï¼Œlogæ–‡ä»¶å¤¹ï¼Œobjectsæ–‡ä»¶å¤¹ä¸­çš„8ä¸ªæ–‡ä»¶ä»¥åŠrefs/headsä¸‹çš„mainæ–‡ä»¶ï¼Œå…¶ä»–çš„ä¸€äº›å˜åŒ–æˆ‘ä»¬ä¸åšè€ƒè™‘ã€‚æœ‰æœå¯¼å› æˆ‘ä»¬å¯ä»¥çŸ¥é“.gitæ–‡ä»¶å¤¹å†…éƒ¨çš„è¿™äº›å˜åŒ–ä¸­æœ‰å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹æ–‡ä»¶ä¿®æ”¹çš„è®°å½•ã€‚\nå›¾3ï¼šè¿è¡Œgit addå’Œgit commitä¹‹å.gitæ–‡ä»¶å¤¹çš„æ–‡ä»¶åˆ†å¸ƒç»“æ„ Gitå¯¹è±¡ï¼ˆGit Objectï¼‰ ä¸Šé¢çš„å˜åŒ–ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè¦çŸ¥é“Gitä¸­çš„å‡ ä¹ä¸€åˆ‡éƒ½è¢«å­˜å‚¨ä¸ºGitå¯¹è±¡ï¼ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡Gitå¯¹è±¡è¿›è¡Œæ“ä½œæ¥å®Œæˆä¸Šé¢çš„å˜åŒ–ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬æ¥ä¸ºGitå¯¹è±¡ä¸‹ä¸€ä¸ªæ¯”è¾ƒå®˜æ–¹çš„å®šä¹‰ï¼šGitå¯¹è±¡å°±æ˜¯åœ¨ Git ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå®ƒä»¬çš„è·¯å¾„ç”±å®ƒä»¬çš„å†…å®¹å†³å®šã€‚\nGitå¯¹è±¡èŒƒæ€§å¯ä»¥å€Ÿç”±pythonæ¥å®ç°ï¼š\nclass GitObject (object): def __init__(self, data=None): if data != None: self.deserialize(data) else: self.init() def serialize(self): \u0026#34;\u0026#34;\u0026#34;å°†å¯¹è±¡è½¬å˜ä¸ºzipæ–‡ä»¶è§£å‹ç¼©åçš„byteæ ¼å¼\u0026#34;\u0026#34;\u0026#34; raise Exception(\u0026#34;Unimplemented!\u0026#34;) def deserialize(self, data): \u0026#34;\u0026#34;\u0026#34;dataé€šå¸¸ä¸ºzipæ–‡ä»¶è§£å‹ç¼©åçš„byteæ ¼å¼ï¼Œæ ¹æ®ç±»å‹è§£ç \u0026#34;\u0026#34;\u0026#34; raise Exception(\u0026#34;Unimplemented!\u0026#34;) def init(self): pass # Just do nothing. This is a reasonable default! Gitå¯¹è±¡åˆç»†åˆ†ä¸ºä»¥ä¸‹å››ç§ç±»å‹ï¼šGitBlobï¼ˆBinary Large Objectï¼‰å¯¹è±¡ï¼Œ GitCommitå¯¹è±¡ï¼Œ GitTreeå¯¹è±¡ï¼Œ GitTagå¯¹è±¡ï¼Œä»¥ä¸‹åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚\nGitBlobå¯¹è±¡ æˆ‘ä»¬å…ˆæœ€ç›´è§‚çš„çœ‹çœ‹Gitä¸­å¯¹äºBlobå†…å®¹çš„å±•ç¤ºï¼Œå¦‚å›¾4æ‰€ç¤ºï¼š\nå›¾4ï¼šè¿è¡Œgit cat-fileä¹‹åå¯¹a.txtæ‰€å¯¹åº”çš„ç±»å‹å’Œç±»å‹å†…å®¹çš„å±•ç¤º Blobs æ˜¯ç”¨æˆ·æ•°æ®ï¼šä½ æ”¾å…¥ Git ä¸­çš„æ¯ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚a.txtã€b.txtã€src/c.txtã€src/d.txtä¸­çš„å†…å®¹ï¼‰çš„å­—èŠ‚å½¢å¼éƒ½è¢«å­˜å‚¨ä¸ºä¸€ä¸ª blobã€‚è¿™æ ·åšä½¿å®ƒä»¬å¾ˆå®¹æ˜“æ“ä½œï¼Œå› ä¸º blob æ²¡æœ‰ç‰¹å®šçš„è¯­æ³•æˆ–çº¦æŸï¼Œé™¤äº†åŸºæœ¬çš„å¯¹è±¡å­˜å‚¨æœºåˆ¶ä¹‹å¤–ï¼Œå®ƒä»¬åªæ˜¯æœªæŒ‡å®šçš„æ•°æ®ã€‚\nGitBlobå¯¹è±¡çš„pythonå®ç°å¦‚ä¸‹ï¼š\nclass GitBlob(GitObject): fmt=b\u0026#39;blob\u0026#39; def serialize(self): return self.blobdata def deserialize(self, data): self.blobdata = data GitTreeå¯¹è±¡ åŒä¸Šï¼Œæˆ‘ä»¬å…ˆæœ€ç›´è§‚çš„çœ‹çœ‹Gitä¸­å¯¹äºæ ‘å†…å®¹çš„å±•ç¤ºï¼Œå¦‚å›¾5æ‰€ç¤ºï¼š\nå›¾5ï¼šè¿è¡Œgit cat-fileä¹‹åå¯¹æœ€é¡¶å±‚çš„æ ‘æ‰€å¯¹åº”çš„ç±»å‹å’Œç±»å‹å†…å®¹çš„å±•ç¤º éæ­£å¼åœ°è¯´ï¼Œæ ‘ï¼ˆtreeï¼‰æè¿°äº†Gitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œå®ƒå°† blobsï¼ˆæ–‡ä»¶å¯¹è±¡ï¼‰ä¸è·¯å¾„å…³è”èµ·æ¥ã€‚æ ‘æ˜¯ä¸€ä¸ªç”±ä¸‰ä¸ªå…ƒç´ ç»„æˆçš„å…ƒç»„æ•°ç»„ï¼Œè¿™äº›å…ƒç´ åŒ…æ‹¬æ–‡ä»¶æ¨¡å¼ã€ç›¸å¯¹äºå·¥ä½œæ ‘çš„è·¯å¾„ï¼Œä»¥åŠä¸€ä¸ª SHA-1 å€¼ã€‚ä¸€ä¸ªå…¸å‹çš„æ ‘çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\nMode SHA-1 Path 100644 06f844865cfc4b68116d2cbf00833b294aae63ec .DS_Store 100644 e12523960bf9941182c801077be75dce699ff37c a.txt 100644 753e270e92068316ec7fa2b6a40e780a4e1d14d7 b.txt 040000 30d66379dddee7068ab4fd3a17cc1ef9555278ac src æ¨¡å¼ï¼ˆModeï¼‰å°±æ˜¯æ–‡ä»¶çš„æ¨¡å¼ï¼Œè·¯å¾„ï¼ˆPathï¼‰æ˜¯æ–‡ä»¶çš„ä½ç½®ã€‚SHA-1 æ˜¯æŒ‡å‘ä¸€ä¸ª blob æˆ–å¦ä¸€ä¸ªæ ‘å¯¹è±¡ã€‚å¦‚æœæ˜¯ blobï¼Œè·¯å¾„è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼›å¦‚æœæ˜¯æ ‘å¯¹è±¡ï¼Œè·¯å¾„è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªç›®å½•ã€‚\nå¸¸è§çš„æ–‡ä»¶æ¨¡å¼æœ‰ä»¥ä¸‹å‡ ç§ï¼š\n100644: æ™®é€šæ–‡ä»¶ï¼Œå…·æœ‰æ ‡å‡†çš„è¯»å†™æƒé™ï¼ˆæ™®é€šçš„æ–‡æœ¬æ–‡ä»¶æˆ–ä»£ç æ–‡ä»¶ï¼‰ã€‚ 100755: å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå…·æœ‰æ‰§è¡Œæƒé™ï¼ˆå¦‚è„šæœ¬æˆ–å¯æ‰§è¡Œç¨‹åºï¼‰ã€‚ 040000: ç›®å½•ï¼ˆdirectoryï¼‰ã€‚ 120000: ç¬¦å·é“¾æ¥ï¼ˆsymbolic linkï¼‰ã€‚ 160000: Git å­æ¨¡å—ï¼ˆsubmoduleï¼‰ã€‚ è€Œå®é™…ä¸Šå½“æˆ‘ä»¬è§£ææ ‘çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯å¯¹.git/objectsä¸­æ ‘çš„SHA-1è·¯å¾„æ‰€ä»£è¡¨çš„æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©åæçº¯åˆ°çš„æ ‘å¯¹è±¡å†…å®¹çš„å­—èŠ‚ç¼–ç ï¼Œå®ƒä»¬çš„æ ¼å¼é€šå¸¸å¦‚ä¸‹ï¼š\n[mode] space [path] 0x00 [sha-1] ï¼ˆbyteæ ¼å¼ï¼‰\nç”±äºæ ‘å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸æ­¢ä¸€ä¸ªï¼Œæœ‰æ—¶ç”šè‡³ä¼šæœ‰åœ¨æ–‡ä»¶å¤¹ä¸­è¿›è¡Œæ–‡ä»¶å¤¹åµŒå¥—ã€‚å› æ­¤æˆ‘ä»¬è¦è®¾è®¡å‡ºå¶å­å¯¹åº”å•ä¸ªæ–‡ä»¶ï¼Œæ ‘å¯¹åº”ç”±ä¸åŒæ–‡ä»¶æ‰€ç»„æˆçš„æ–‡ä»¶å¤¹ã€‚\næˆ‘ä»¬å¯ä»¥å°†å¶å­å¯¹è±¡å’Œæ ‘å¯¹è±¡æŒ‰ä»¥ä¸‹pythonä»£ç æ¥è¡¨ç¤ºï¼š\nclass GitTreeLeaf (object): def __init__(self, mode, path, sha): self.mode = mode # æ¨¡å¼ self.path = path # æ–‡ä»¶è·¯å¾„ self.sha = sha # æ–‡ä»¶è·¯å¾„ç´¢å¼•åˆ°çš„æ–‡ä»¶å†…å®¹æ ‡å‡†åŒ–åæ‰€å¯¹åº”çš„sha-1å€¼ class GitTree(GitObject): fmt=b\u0026#39;tree\u0026#39; def deserialize(self, data): # tree_parseæ˜¯è§£ææ‰€å¾—åˆ°çš„æ ‘å¯¹è±¡çš„å­—èŠ‚ç¼–ç æ•°æ® self.items = tree_parse(data) def serialize(self): # tree_serializeå°†è§£æåçš„ç»“æœæ±‚é€†å¾—åˆ°æ ‘å¯¹è±¡çš„å­—èŠ‚ç¼–ç æ•°æ® return tree_serialize(self) def init(self): self.items = list() ç”±äºä¸€ä¸ªæ ‘ä¸­æœ‰æ—¶ä¸å•å•åŒ…å«å¶å­æ›´æœ‰å¯èƒ½åŒ…å«å­æ ‘ï¼Œå…·ä½“æƒ…å½¢è§ä¸Šé¢ä¸€æ£µæ ‘çš„å…¸å‹æƒ…å†µï¼Œtree_parseå’Œtree_serializeå‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š\ndef tree_parse(raw): pos = 0 max = len(raw) ret = list() while pos \u0026lt; max: pos, data = tree_parse_one(raw, pos) ret.append(data) return ret def tree_parse_one(raw, start=0): # [mode] space [path] 0x00 [sha-1] ï¼ˆbyteæ ¼å¼ï¼‰ # æŸ¥æ‰¾å­—èŠ‚å½¢å¼ç©ºæ ¼ä»¥ç¡®å®šmode x = raw.find(b\u0026#39; \u0026#39;, start) assert x-start == 5 or x-start==6 # è¯»å–mode mode = raw[start:x] if len(mode) == 5: # æ ‡å‡†åˆ°6å­—èŠ‚ mode = b\u0026#34;0\u0026#34; + mode # æŸ¥æ‰¾å­—èŠ‚å½¢å¼ç©ºç»ˆæ­¢ç¬¦ä»¥ç¡®å®špath y = raw.find(b\u0026#39;\\x00\u0026#39;, x) # è¯»å–path path = raw[x+1:y] # è¯»å–shaâ€¦ # raw[y+1:y+21] æå–çš„æ˜¯ 20 å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆSHA-1 å“ˆå¸Œå€¼ï¼‰ã€‚ raw_sha = int.from_bytes(raw[y+1:y+21], \u0026#34;big\u0026#34;) # int.from_bytes(raw[y+1:y+21], \u0026#34;big\u0026#34;)å°†æå–çš„ 20 å­—èŠ‚äºŒè¿›åˆ¶æ•°æ®è½¬ # æ¢ä¸ºä¸€ä¸ªæ•´æ•°ï¼Œç„¶åä½¿ç”¨ format(raw_sha, \u0026#34;040x\u0026#34;) å°†è¿™ä¸ªæ•´æ•°è½¬æ¢ä¸º 40 # ä½çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸² ã€‚Gitä¸­é€šå¸¸ä½¿ç”¨çš„shaå€¼æ—¶è¿™ç§å½¢å¼ã€‚æ¯”å¦‚.DS_Storeå¯¹åº” # çš„06f844865cfc4b68116d2cbf00833b294aae63ec sha = format(raw_sha, \u0026#34;040x\u0026#34;) return y+21, GitTreeLeaf(mode, path.decode(\u0026#34;utf8\u0026#34;), sha) def tree_serialize(obj): obj.items.sort(key=tree_leaf_sort_key) ret = b\u0026#39;\u0026#39; for i in obj.items: ret += i.mode ret += b\u0026#39; \u0026#39; ret += i.path.encode(\u0026#34;utf8\u0026#34;) ret += b\u0026#39;\\x00\u0026#39; sha = int(i.sha, 16) ret += sha.to_bytes(20, byteorder=\u0026#34;big\u0026#34;) return ret def tree_leaf_sort_key(leaf): if leaf.mode.startswith(b\u0026#34;10\u0026#34;): return leaf.path # æ–‡ä»¶ else: return leaf.path + \u0026#34;/\u0026#34; # æ–‡ä»¶å¤¹ GitCommitå¯¹è±¡ åŒä¸Šï¼Œæˆ‘ä»¬å…ˆæœ€ç›´è§‚çš„çœ‹çœ‹Gitä¸­å¯¹äºæ ‘å†…å®¹çš„å±•ç¤ºï¼Œå¦‚å›¾6æ‰€ç¤ºï¼š\nå›¾6ï¼šè¿è¡Œgit cat-fileä¹‹åå¯¹æœ€é¡¶å±‚çš„æäº¤æ‰€å¯¹åº”çš„ç±»å‹å’Œç±»å‹å†…å®¹çš„å±•ç¤º ä¸€ä¸ªæäº¤ï¼ˆCommitï¼‰çš„å…¸å‹å¦‚ä¸‹æ‰€ç¤ºï¼š\ntree 50306289de5ae719af85eaad3430d785517a11e7 parent 735a65cef921f8e30ae55fdf19b695eb15ea8d45 author fordelkon \u0026lt;27xxx88816@qq.com\u0026gt; 1741406298 +0800 committer fordelkon \u0026lt;27xxx88816@qq.com\u0026gt; 1741406298 +0800 life is short, I use Python ä»ä¸Šé¢çš„å…¸å‹æ¥çœ‹ï¼Œä¸€ä¸ªæäº¤ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼š\næ ‘å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å·¥ä½œæ ‘çš„å†…å®¹ã€æ–‡ä»¶å’Œç›®å½•ï¼› é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªçˆ¶æäº¤ï¼› ä¸€ä¸ªä½œè€…èº«ä»½ï¼ˆå§“åå’Œé‚®ç®±ï¼‰ä»¥åŠä¸€ä¸ªæ—¶é—´æˆ³ï¼› ä¸€ä¸ªæäº¤è€…èº«ä»½ï¼ˆå§“åå’Œé‚®ç®±ï¼‰ä»¥åŠä¸€ä¸ªæ—¶é—´æˆ³ï¼› ä¸€ä¸ªæäº¤ä¿¡æ¯ã€‚ ä»æäº¤çš„ç»„æˆæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç™½å·²ç»åˆ›å»ºå¥½çš„æäº¤æ˜¯ä¸å¯å˜çš„ã€‚å¦‚æœæˆ‘ä»¬æ›´æ”¹äº†ä½œè€…ã€çˆ¶æäº¤æˆ–ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šæœ€ç»ˆä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ã€ä¸åŒçš„æäº¤å¯¹è±¡ä¸æ”¹å˜åçš„ç»“æœç»‘å®šã€‚æ‰€ä»¥æ¯ä¸€ä¸ªæäº¤éƒ½ä¸å®ƒåœ¨æ•´ä¸ªä»“åº“ä¸­çš„ä½ç½®åŠå…¶ä¸æœ€åˆæäº¤çš„å…³ç³»ç´§å¯†ç›¸è¿ã€‚æ¢å¥è¯è¯´ï¼Œä¸€ä¸ªç»™å®šçš„æäº¤ ID ï¼ˆsha-1ï¼‰ä¸ä»…æ ‡è¯†äº†æŸäº›æ–‡ä»¶çš„å†…å®¹ï¼Œè¿˜å°†æäº¤ä¸å®ƒçš„æ•´ä¸ªå†å²åŠæ•´ä¸ªä»“åº“ç»‘å®šåœ¨ä¸€èµ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰äº†æäº¤ï¼Œæˆ‘ä»¬çš„Gitçš„å†å²è®°å½•åŠŸèƒ½å°±æœ‰äº†ä¿è¯ï¼ ä¸€ä¸ªæäº¤å¯¹è±¡çš„pythonä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\nclass GitCommit(GitObject): fmt=b\u0026#39;commit\u0026#39; def deserialize(self, data): # kvlm_parseæ˜¯è§£ææ‰€å¾—åˆ°çš„æäº¤å¯¹è±¡çš„å­—èŠ‚ç¼–ç æ•°æ® self.kvlm = kvlm_parse(data) def serialize(self): # kvlm_serializeå°†è§£æåçš„ç»“æœæ±‚é€†å¾—åˆ°æäº¤å¯¹è±¡çš„å­—èŠ‚ç¼–ç æ•°æ® return kvlm_serialize(self.kvlm) def init(self): self.kvlm = dict() ç”±æäº¤çš„å…¸å‹æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æäº¤å¯¹è±¡çš„å­—èŠ‚ç¼–ç æ•°æ®è½¬æ¢æˆé”®å€¼å¯¹çš„å­—å…¸æ ¼å¼ï¼Œç”±äºæœ‰ç©ºæ ¼å’Œå›è½¦ã€‚æ›´å½¢è±¡çš„è¡¨ç¤ºå¦‚ä¸‹:\n[key1] space [value1] \\n \u0026hellip; [keyn] space [valuen] \\n [commit]\nå› æ­¤ï¼Œkvlm_parseå’Œkvlm_serializeçš„pythonä»£ç å¦‚ä¸‹æ‰€ç¤º\ndef kvlm_parse(raw, start=0, dct=None): # å¦‚æœ dct ä¸ºç©ºï¼Œåˆå§‹åŒ–ä¸€ä¸ªç©ºå­—å…¸ if not dct: dct = dict() # ä¸èƒ½åœ¨å‡½æ•°å‚æ•°ä¸­ç›´æ¥å£°æ˜ dct=dict()ï¼Œå¦åˆ™æ‰€æœ‰å‡½æ•°è°ƒç”¨ä¼šå…±ç”¨åŒä¸€ä¸ªå­—å…¸ï¼Œ # å¯¼è‡´æ¯æ¬¡è°ƒç”¨æ—¶å­—å…¸ä¸æ–­å¢é•¿ã€‚ # è¿™ä¸ªå‡½æ•°æ˜¯é€’å½’çš„ï¼šå®ƒè¯»å–ä¸€ä¸ªé”®/å€¼å¯¹ï¼Œç„¶åè°ƒç”¨è‡ªèº«æ¥å¤„ç†ä¸‹ä¸€ä¸ªä½ç½®ã€‚ # å› æ­¤æˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“å½“å‰çš„ä½ç½®ï¼šæ˜¯åœ¨ä¸€ä¸ªå…³é”®å­—ï¼Œè¿˜æ˜¯å·²ç»åˆ°äº†æ¶ˆæ¯éƒ¨åˆ†ã€‚ # æŸ¥æ‰¾ä¸‹ä¸€ä¸ªç©ºæ ¼å’Œæ¢è¡Œç¬¦çš„ä½ç½® spc = raw.find(b\u0026#39; \u0026#39;, start) nl = raw.find(b\u0026#39;\\n\u0026#39;, start) # å¦‚æœç©ºæ ¼å‡ºç°åœ¨æ¢è¡Œç¬¦ä¹‹å‰ï¼Œè¯´æ˜æˆ‘ä»¬æœ‰ä¸€ä¸ªå…³é”®å­—ã€‚å¦åˆ™ï¼Œå®ƒæ˜¯æœ€ç»ˆçš„æ¶ˆæ¯éƒ¨åˆ†ï¼Œ # æˆ‘ä»¬ä¼šè¯»å–ç›´åˆ°æ–‡ä»¶çš„æœ«å°¾ã€‚ # åŸºæœ¬æƒ…å†µ # ========= # å¦‚æœæ¢è¡Œç¬¦å…ˆå‡ºç°ï¼ˆæˆ–è€…æ ¹æœ¬æ²¡æœ‰ç©ºæ ¼ï¼Œè¿™ç§æƒ…å†µä¸‹ find è¿”å› -1ï¼‰ï¼Œ # æˆ‘ä»¬å‡è®¾é‡åˆ°äº†ä¸€ä¸ªç©ºè¡Œã€‚ç©ºè¡Œæ„å‘³ç€å‰©ä½™çš„æ•°æ®æ˜¯æ¶ˆæ¯éƒ¨åˆ†ã€‚ # æˆ‘ä»¬å°†å®ƒå­˜å‚¨åœ¨å­—å…¸ä¸­ï¼Œé”®ä¸º Noneï¼Œç„¶åè¿”å›ã€‚ if (spc \u0026lt; 0) or (nl \u0026lt; spc): assert nl == start dct[None] = raw[start+1:] # å­˜å‚¨æ¶ˆæ¯éƒ¨åˆ† return dct # é€’å½’æƒ…å†µ # ============== # è¯»å–ä¸€ä¸ªé”®å€¼å¯¹å¹¶é€’å½’å¤„ç†ä¸‹ä¸€ä¸ªã€‚ key = raw[start:spc] # æŸ¥æ‰¾å€¼çš„ç»“å°¾ã€‚ä»¥ç©ºæ ¼å¼€å¤´çš„è¡Œè¡¨ç¤ºå€¼çš„å»¶ç»­è¡Œï¼Œ # å› æ­¤æˆ‘ä»¬éœ€è¦å¾ªç¯ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªä¸æ˜¯ä»¥ç©ºæ ¼å¼€å¤´çš„æ¢è¡Œç¬¦ã€‚ end = start while True: end = raw.find(b\u0026#39;\\n\u0026#39;, end+1) if raw[end+1] != ord(\u0026#39; \u0026#39;): break # æ‰¾åˆ°ä¸€ä¸ªä¸ä»¥ç©ºæ ¼å¼€å¤´çš„æ¢è¡Œç¬¦ # è·å–å€¼ï¼ŒåŒæ—¶åˆ é™¤å»¶ç»­è¡Œçš„å‰å¯¼ç©ºæ ¼ value = raw[spc+1:end].replace(b\u0026#39;\\n \u0026#39;, b\u0026#39;\\n\u0026#39;) # ä¸è¦è¦†ç›–ç°æœ‰çš„æ•°æ®å†…å®¹ if key in dct: # å¦‚æœå­—å…¸ä¸­å·²æœ‰è¯¥é”®ï¼Œä¸”å€¼ä¸ºåˆ—è¡¨ï¼Œåˆ™ç›´æ¥æ·»åŠ æ–°å€¼ if type(dct[key]) == list: dct[key].append(value) else: # å¦‚æœå·²æœ‰çš„å€¼ä¸æ˜¯åˆ—è¡¨ï¼Œåˆ›å»ºä¸€ä¸ªåˆ—è¡¨æ¥å­˜å‚¨å¤šä¸ªå€¼ dct[key] = [ dct[key], value ] else: # å¦‚æœå­—å…¸ä¸­æ²¡æœ‰è¯¥é”®ï¼Œåˆ™ç›´æ¥å­˜å‚¨é”®å€¼å¯¹ dct[key]=value # é€’å½’å¤„ç†å‰©ä½™çš„éƒ¨åˆ† return kvlm_parse(raw, start=end+1, dct=dct) def kvlm_serialize(kvlm): ret = b\u0026#39;\u0026#39; # åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„å­—èŠ‚ä¸²ç”¨äºå­˜å‚¨åºåˆ—åŒ–ç»“æœ # è¾“å‡ºå­—æ®µ for k in kvlm.keys(): # è·³è¿‡æ¶ˆæ¯ä½“æœ¬èº«ï¼ˆæ¶ˆæ¯å­˜å‚¨åœ¨å­—å…¸çš„ None é”®ä¸­ï¼‰ if k == None: continue val = kvlm[k] # å°†å•ä¸ªå€¼è§„èŒƒåŒ–ä¸ºåˆ—è¡¨ï¼Œä»¥ä¾¿ç»Ÿä¸€å¤„ç† if type(val) != list: val = [ val ] # éå†å€¼åˆ—è¡¨ï¼Œå¤„ç†æ¯ä¸ªå€¼ for v in val: # æ‹¼æ¥é”®å’Œå€¼ï¼Œå¹¶ç¡®ä¿æ¢è¡Œç¬¦åé¢æœ‰ä¸€ä¸ªç©ºæ ¼ï¼ˆç”¨äºè¡¨ç¤ºå€¼çš„å»¶ç»­è¡Œï¼‰ ret += k + b\u0026#39; \u0026#39; + (v.replace(b\u0026#39;\\n\u0026#39;, b\u0026#39;\\n \u0026#39;)) + b\u0026#39;\\n\u0026#39; # æœ€åæ‹¼æ¥æ¶ˆæ¯ä½“ï¼Œæ¶ˆæ¯ä½“ä¹‹å‰éœ€è¦ä¸€ä¸ªç©ºè¡Œåˆ†éš” ret += b\u0026#39;\\n\u0026#39; + kvlm[None] return ret # è¿”å›åºåˆ—åŒ–åçš„å­—èŠ‚ä¸² GitTagå¯¹è±¡ æ ‡ç­¾å®é™…ä¸Šå°±æ˜¯å¼•ç”¨ï¼ˆrefsï¼‰ã€‚å®ƒä»¬ä½äº .git/refs/tags/ ç›®å½•ä¸‹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ ‡ç­¾æœ‰ä¸¤ç§ç±»å‹ï¼šè½»é‡æ ‡ç­¾å’Œæ ‡ç­¾å¯¹è±¡ã€‚\nè½»é‡æ ‡ç­¾ï¼ˆâ€œLightweightâ€ tagsï¼‰ ä»…ä»…æ˜¯æŒ‡å‘æäº¤ã€æ ‘å¯¹è±¡æˆ– blob å¯¹è±¡çš„æ™®é€šå¼•ç”¨ã€‚\næ ‡ç­¾å¯¹è±¡ï¼ˆTag objectsï¼‰ æ˜¯æŒ‡å‘æ ‡ç­¾ç±»å‹å¯¹è±¡çš„æ™®é€šå¼•ç”¨ã€‚ä¸è½»é‡æ ‡ç­¾ä¸åŒï¼Œæ ‡ç­¾å¯¹è±¡åŒ…å«ä½œè€…ã€æ—¥æœŸã€å¯é€‰çš„ PGP ç­¾åä»¥åŠå¯é€‰çš„æ³¨é‡Šã€‚å®ƒä»¬çš„æ ¼å¼ä¸æäº¤å¯¹è±¡ç›¸åŒã€‚\nå› æ­¤ï¼ŒGitTagçš„pythonä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š\nclass GitTag(GitCommit): fmt = b\u0026#39;tag\u0026#39; æˆ‘ä»¬å·²ç»äº†è§£äº†ä¸Šé¢å››ç§Gitå¯¹è±¡ï¼Œç”±Gitå¯¹è±¡çš„å†…å®¹å†³å®šè·¯å¾„çš„æ€§è´¨ï¼Œå¯ä»¥ä¿è¯å¯¹äºééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å†…å®¹ä¿®æ”¹çš„è®°å½•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒGitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ä¸€æ—¦è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆç›¸åº”çš„Gitå¯¹è±¡çš„è·¯å¾„ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ï¼Œå°†ä¿®æ”¹åçš„ä¸åŒçš„Gitå¯¹è±¡çš„æ–‡ä»¶æ ‡å‡†åŒ–åå‹ç¼©æŒ‰ç…§æ”¹å˜çš„è·¯å¾„å­˜å‚¨åœ¨.git/objectsæ–‡ä»¶å¤¹ä¸‹ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å¯¹è¯¥æ”¹å˜çš„è®°å½•ã€‚é‚£ä¹ˆæ–‡ä»¶çš„å†…å®¹å’Œæ–‡ä»¶çš„è·¯å¾„æœ‰ç€æ˜ç¡®çš„æ˜ å°„å…³ç³»å—ï¼ŸGitç»™å‡ºçš„ç­”æ¡ˆæ˜¯å¯¹æ ‡å‡†åŒ–åçš„æ–‡ä»¶å†…å®¹è¿›è¡ŒÂ SHA-1å“ˆå¸Œåå¾—åˆ°æ–‡ä»¶çš„è·¯å¾„ã€‚å¦‚ä½•è¿›è¡Œæ ‡å‡†åŒ–ä¹Ÿæ˜¯æˆ‘ä»¬å€¼å¾—æ³¨æ„çš„ï¼ŒGitä¸­å®ç°çš„æ–¹æ¡ˆæ˜¯å­—èŠ‚å½¢å¼ç±»å‹å¤´+å­—èŠ‚å½¢å¼ç©ºæ ¼+å­—èŠ‚å½¢å¼å¤§å°+å­—èŠ‚å½¢å¼ç©ºåˆ†ç¦»ç¬¦+å¯¹è±¡å†…å®¹çš„å­—èŠ‚ç¼–ç ã€‚ å…·ä½“æ–¹æ¡ˆå¦‚ä¸‹æ‰€ç¤ºï¼š\n[fmt] space [size] 0x00 [data] (byteæ ¼å¼)\næ ¹æ®è¿™ä¸€æ ‡å‡†åŒ–çš„å½¢å¼æˆ‘ä»¬å¯ä»¥å¯¹å¯¹è±¡è¿›è¡Œè¯»å’Œå†™æ“ä½œï¼Œæ‰€æœ‰å¯¹è±¡çš„æ ¸å¿ƒè½½ä½“æ˜¯å¯¹è±¡å†…å®¹çš„å­—èŠ‚ç¼–ç ã€‚å…·ä½“pythonä»£ç å¦‚ä¸‹ï¼š\ndef object_read(repo, sha): \u0026#34;\u0026#34;\u0026#34;Read object sha from Git repository repo. Return a GitObject whose exact type depends on the object.\u0026#34;\u0026#34;\u0026#34; # ç”±sha1å€¼å¾—åˆ°å¯¹åº”è·¯å¾„ path = repo_file(repo, \u0026#34;objects\u0026#34;, sha[0:2], sha[2:]) if not os.path.isfile(path): return None with open (path, \u0026#34;rb\u0026#34;) as f: raw = zlib.decompress(f.read()) # è¯»å–å¯¹è±¡ç±»å‹ x = raw.find(b\u0026#39; \u0026#39;) # 0x20 å­—èŠ‚å½¢å¼ç©ºæ ¼ fmt = raw[0:x] # å­—èŠ‚å½¢å¼ç±»å‹å¤´ # è¯»å–æœ‰æ•ˆçš„å¯¹è±¡å¤§å° y = raw.find(b\u0026#39;\\x00\u0026#39;, x) # 0x00 å­—èŠ‚å½¢å¼ç©ºåˆ†ç¦»ç¬¦ size = int(raw[x:y].decode(\u0026#34;ascii\u0026#34;)) if size != len(raw)-y-1: raise Exception(f\u0026#34;Malformed object {sha}: bad length\u0026#34;) # æ ¹æ®å¯¹è±¡ç±»å‹é€‰æ‹©ç”Ÿæˆå™¨ match fmt: case b\u0026#39;commit\u0026#39; : c=GitCommit case b\u0026#39;tree\u0026#39; : c=GitTree case b\u0026#39;tag\u0026#39; : c=GitTag case b\u0026#39;blob\u0026#39; : c=GitBlob case _: raise Exception(f\u0026#34;Unknown type {fmt.decode(\u0026#34;ascii\u0026#34;)} for object {sha}\u0026#34;) # è°ƒç”¨ç”Ÿæˆå™¨è¿”å›å¯¹è±¡ return c(raw[y+1:]) # raw[y+1:]å¯¹è±¡å†…å®¹çš„å­—èŠ‚ç¼–ç  def object_write(obj, repo=None): # å¯¹è±¡å†…å®¹çš„å­—èŠ‚ç¼–ç  data = obj.serialize() # æ·»åŠ ä¸€äº›å‰ç¼€æˆä¸ºæ ‡å‡†æ ¼å¼ result = obj.fmt + b\u0026#39; \u0026#39; + str(len(data)).encode() + b\u0026#39;\\x00\u0026#39; + data # è®¡ç®—sha1 sha = hashlib.sha1(result).hexdigest() if repo: # ç”±sha1å€¼å¾—åˆ°å¯¹åº”è·¯å¾„ path=repo_file(repo, \u0026#34;objects\u0026#34;, sha[0:2], sha[2:], mkdir=True) if not os.path.exists(path): with open(path, \u0026#39;wb\u0026#39;) as f: # Compress and write f.write(zlib.compress(result)) return sha å¥½äº†ï¼Œå‰æˆå·²ç»å‡†å¤‡äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥å‡­å€ŸGitä»“åº“å’ŒGitå¯¹è±¡æ¥å®ç°æœ€æœ€æœ€é‡è¦çš„Gitä¸¤è¿å‡»å—ï¼ˆgit addå’Œgit commitï¼‰ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯\u0026hellip;\u0026hellip;å¦å®šçš„ã€‚æ˜¯çš„ï¼Œæˆ‘ä»¬å·²ç»æ‹¥æœ‰äº†è¿™ä¹ˆå¤šçš„å¯¹è±¡ï¼Œä¹Ÿæœ‰äº†è¯»å–å’Œå†™å…¥å¯¹è±¡çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸€æ—¦æˆ‘ä»¬æ”¹å˜æ–‡ä»¶ï¼ˆä¸å¦¨å°±æ”¹å˜a.txtæ–‡ä»¶çš„å†…å®¹ï¼‰ï¼Œç”±å‰é¢æˆ‘ä»¬è¯´çš„ä¸»è¦çš„ä¸‰ç§å¯¹è±¡æ¥çœ‹ï¼ŒGitBlobå…ƒæ•°æ®ä¼šæ”¹å˜ï¼Œéšä¹‹è€Œæ¥çš„GitTreeå…ƒæ•°æ®ä¼šæ”¹å˜ï¼Œè¿›è€ŒGitCommitå…ƒæ•°æ®ä¹Ÿä¼šæ”¹å˜ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯ä¸€æŒ¥è€Œå°±çš„ï¼Œæ‰€ä»¥Gitç§æ‰ä¼šåˆ†ä¸ºgit addå’Œgit commitä¸¤æ­¥èµ°ã€‚åœ¨git addçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å°†ä¿®æ”¹åçš„æ–‡ä»¶å±æ€§å˜åŒ–æäº¤åˆ°æš‚å­˜åŒºï¼ˆStaging areaï¼‰ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å›¾3ä¸­çš„.git/indexæ–‡ä»¶ä¸­ã€‚ç„¶åä½¿ç”¨git commitå°†æš‚å­˜åŒºä¸­çš„æ‰€æœ‰è®°å½•çš„æ–‡ä»¶ç»Ÿåˆç”Ÿæˆæ–°çš„GitTreeï¼Œè¿›è€Œç”Ÿæˆæ–°çš„GitCommitã€‚å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªè¡¨ç¤ºæš‚å­˜åŒºçš„ç±»å‹ã€‚\næš‚å­˜åŒºï¼ˆStaging areaï¼‰ æš‚å­˜åŒºåœ¨.gitæ–‡ä»¶å¤¹ä¸­çš„å±•ç°å½¢å¼å°±æ˜¯.git/indexæ–‡ä»¶ï¼Œåœ¨ä¸€æ¬¡æäº¤ä¹‹åï¼Œ.git/indexæ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯è¯¥æäº¤çš„ä¸€ç§å‰¯æœ¬ï¼šå®ƒä¿å­˜äº†ä¸å¯¹åº”çš„æ ‘ç›¸åŒçš„è·¯å¾„/Blobï¼ˆå¯¹è±¡ï¼‰çš„å…³è”å…³ç³»ã€‚ä½†å®ƒè¿˜ä¿å­˜äº†Gitä»“åº“ä¸­å…³äºæ–‡ä»¶çš„é¢å¤–ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒä»¬çš„åˆ›å»º/ä¿®æ”¹æ—¶é—´ï¼Œå› æ­¤ git status é€šå¸¸ä¸éœ€è¦å®é™…æ¯”è¾ƒæ–‡ä»¶ï¼šå®ƒåªéœ€è¦æ£€æŸ¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´æ˜¯å¦ä¸ç´¢å¼•æ–‡ä»¶ä¸­å­˜å‚¨çš„æ—¶é—´ç›¸åŒï¼Œåªæœ‰å½“å®ƒä»¬ä¸åŒæ—¶ï¼Œæ‰ä¼šæ‰§è¡Œå®é™…çš„æ¯”è¾ƒã€‚ç±»æ¯”æ ‘å¯¹è±¡çš„è¡¨ç¤ºï¼Œ.git/indexæ–‡ä»¶ä¸­åŒ…å«è®¸å¤šå…ƒç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯å¯¹å•ä¸ªå…ƒç´ è¿›è¡Œè¡¨ç¤ºï¼Œä¹‹åæ˜¯å¯¹æ•´ä½“.git/indexæ–‡ä»¶è¿›è¡Œè¡¨ç¤ºã€‚\nå•ä¸ªå…ƒç´ å’Œæ•´ä½“.git/indexæ–‡ä»¶çš„pythonè¡¨ç¤ºå¦‚ä¸‹ï¼š\nclass GitIndexEntry (object): def __init__(self, ctime=None, mtime=None, dev=None, ino=None, mode_type=None, mode_perms=None, uid=None, gid=None, fsize=None, sha=None, flag_assume_valid=None, flag_stage=None, name=None): # æ–‡ä»¶å…ƒæ•°æ®æœ€åæ›´æ”¹çš„æ—¶é—´ã€‚æ ¼å¼æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ # (ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³, çº³ç§’) self.ctime = ctime # æ–‡ä»¶æ•°æ®æœ€åæ›´æ”¹çš„æ—¶é—´ã€‚æ ¼å¼æ˜¯ä¸€ä¸ªäºŒå…ƒç»„ # (ä»¥ç§’ä¸ºå•ä½çš„æ—¶é—´æˆ³, çº³ç§’) self.mtime = mtime # åŒ…å«è¯¥æ–‡ä»¶çš„è®¾å¤‡ID self.dev = dev # æ–‡ä»¶çš„inodeç¼–å· self.ino = ino # å¯¹è±¡ç±»å‹ï¼Œå¯ä»¥æ˜¯ b1000 (æ™®é€šæ–‡ä»¶), b1010 (ç¬¦å·é“¾æ¥), # b1110 (gitlink) self.mode_type = mode_type # å¯¹è±¡çš„æƒé™ï¼Œè¡¨ç¤ºä¸ºä¸€ä¸ªæ•´æ•° self.mode_perms = mode_perms # æ–‡ä»¶æ‰€æœ‰è€…çš„ç”¨æˆ·ID self.uid = uid # æ–‡ä»¶æ‰€æœ‰è€…çš„ç»„ID self.gid = gid # å¯¹è±¡çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ self.fsize = fsize # å¯¹è±¡çš„SHAå“ˆå¸Œå€¼ self.sha = sha # æ ‡å¿—ï¼šå‡è®¾è¯¥å¯¹è±¡æœ‰æ•ˆ self.flag_assume_valid = flag_assume_valid # æ–‡ä»¶çš„é˜¶æ®µæ ‡å¿— self.flag_stage = flag_stage # å¯¹è±¡çš„åç§°ï¼ˆåŒ…æ‹¬å®Œæ•´è·¯å¾„ï¼‰ self.name = name class GitIndex (object): version = None entries = [] # ext = None # sha = None def __init__(self, version=2, entries=None): if not entries: entries = list() self.version = version self.entries = entries .git/indexæ–‡ä»¶æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯èƒ½æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒçš„æ ¼å¼ç›¸å¯¹ç®€å•ã€‚æ–‡ä»¶å¼€å§‹éƒ¨åˆ†æ˜¯ä¸€ä¸ªå¤´éƒ¨ä¿¡æ¯ï¼ŒåŒ…å«äº† DIRC é­”æ³•å­—èŠ‚ã€ç‰ˆæœ¬å·ä»¥åŠè¯¥ç´¢å¼•æ–‡ä»¶ä¸­çš„æ¡ç›®æ€»æ•°ã€‚æ›´å½¢è±¡çš„æ ¼å¼å¦‚ä¸‹ï¼š\n[DIRC] [version] [count] [entries]\næ‰€ä»¥æˆ‘ä»¬å¯ä»¥å®šä¹‰index_readå’Œindex_writeå‡½æ•°å¦‚ä¸‹ï¼š\ndef index_read(repo): # è·å–ä»“åº“ç´¢å¼•æ–‡ä»¶çš„è·¯å¾„ index_file = repo_file(repo, \u0026#34;index\u0026#34;) # å¦‚æœç´¢å¼•æ–‡ä»¶ä¸å­˜åœ¨ï¼ˆä¾‹å¦‚æ–°ä»“åº“ï¼‰ï¼Œåˆ™è¿”å›ä¸€ä¸ªç©ºçš„ GitIndex å®ä¾‹ if not os.path.exists(index_file): return GitIndex() # æ‰“å¼€ç´¢å¼•æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶æ–¹å¼è¯»å– with open(index_file, \u0026#39;rb\u0026#39;) as f: raw = f.read() # ç´¢å¼•æ–‡ä»¶çš„å¤´éƒ¨åŒ…å« 12 ä¸ªå­—èŠ‚ header = raw[:12] signature = header[:4] # æ£€æŸ¥ç´¢å¼•æ–‡ä»¶çš„é­”æ³•å­—èŠ‚ï¼Œå¿…é¡»ä¸º \u0026#34;DIRC\u0026#34;ï¼Œä»£è¡¨ \u0026#34;DirCache\u0026#34; assert signature == b\u0026#34;DIRC\u0026#34; # ä»å¤´éƒ¨è§£æç‰ˆæœ¬å·ï¼ˆ4-8å­—èŠ‚ï¼‰ï¼Œæ­¤å¤„åªæ”¯æŒç‰ˆæœ¬ 2 version = int.from_bytes(header[4:8], \u0026#34;big\u0026#34;) assert version == 2, \u0026#34;wyag åªæ”¯æŒç´¢å¼•æ–‡ä»¶ç‰ˆæœ¬ 2\u0026#34; # ä»å¤´éƒ¨è§£æç´¢å¼•æ–‡ä»¶ä¸­çš„æ¡ç›®æ•°é‡ï¼ˆ8-12å­—èŠ‚ï¼‰ count = int.from_bytes(header[8:12], \u0026#34;big\u0026#34;) # ç”¨äºå­˜å‚¨è¯»å–åˆ°çš„ç´¢å¼•æ¡ç›® entries = list() # ç´¢å¼•æ–‡ä»¶å†…å®¹éƒ¨åˆ†ä»ç¬¬ 12 ä¸ªå­—èŠ‚å¼€å§‹ content = raw[12:] idx = 0 # å¾ªç¯è§£ææ¯ä¸ªæ¡ç›®ï¼Œæ ¹æ®æ–‡ä»¶å¤´éƒ¨ç»™å‡ºçš„æ¡ç›®æ•°è¿›è¡Œå¾ªç¯ for i in range(0, count): # è§£æåˆ›å»ºæ—¶é—´ï¼ˆç§’æ•°å’Œçº³ç§’æ•°ï¼‰ ctime_s = int.from_bytes(content[idx: idx+4], \u0026#34;big\u0026#34;) ctime_ns = int.from_bytes(content[idx+4: idx+8], \u0026#34;big\u0026#34;) # è§£æä¿®æ”¹æ—¶é—´ï¼ˆç§’æ•°å’Œçº³ç§’æ•°ï¼‰ mtime_s = int.from_bytes(content[idx+8: idx+12], \u0026#34;big\u0026#34;) mtime_ns = int.from_bytes(content[idx+12: idx+16], \u0026#34;big\u0026#34;) # è§£æè®¾å¤‡ ID dev = int.from_bytes(content[idx+16: idx+20], \u0026#34;big\u0026#34;) # è§£æ inode ç¼–å· ino = int.from_bytes(content[idx+20: idx+24], \u0026#34;big\u0026#34;) # å¿½ç•¥çš„å­—æ®µ unused = int.from_bytes(content[idx+24: idx+26], \u0026#34;big\u0026#34;) assert 0 == unused # è§£ææ–‡ä»¶æ¨¡å¼ï¼ˆåŒ…æ‹¬ç±»å‹å’Œæƒé™ï¼‰ mode = int.from_bytes(content[idx+26: idx+28], \u0026#34;big\u0026#34;) mode_type = mode \u0026gt;\u0026gt; 12 assert mode_type in [0b1000, 0b1010, 0b1110] # æ–‡ä»¶ç±»å‹å¿…é¡»æ˜¯å¸¸è§„æ–‡ä»¶ã€ç¬¦å·é“¾æ¥æˆ– gitlink mode_perms = mode \u0026amp; 0b0000000111111111 # è§£æç”¨æˆ· ID å’Œç»„ ID uid = int.from_bytes(content[idx+28: idx+32], \u0026#34;big\u0026#34;) gid = int.from_bytes(content[idx+32: idx+36], \u0026#34;big\u0026#34;) # è§£ææ–‡ä»¶å¤§å° fsize = int.from_bytes(content[idx+36: idx+40], \u0026#34;big\u0026#34;) # è§£æ SHAï¼ˆå¯¹è±¡ IDï¼‰ï¼Œå¹¶æ ¼å¼åŒ–ä¸º 40 å­—ç¬¦çš„å°å†™åå…­è¿›åˆ¶å­—ç¬¦ä¸² sha = format(int.from_bytes(content[idx+40: idx+60], \u0026#34;big\u0026#34;), \u0026#34;040x\u0026#34;) # è§£ææ ‡å¿—ä½ flags = int.from_bytes(content[idx+60: idx+62], \u0026#34;big\u0026#34;) # è§£æå‡å®šæœ‰æ•ˆæ ‡å¿—ä½ flag_assume_valid = (flags \u0026amp; 0b1000000000000000) != 0 # è§£ææ‰©å±•æ ‡å¿—ä½ï¼ˆè¢«å¿½ç•¥ï¼‰ flag_extended = (flags \u0026amp; 0b0100000000000000) != 0 assert not flag_extended # è§£æé˜¶æ®µæ ‡å¿—ä½ flag_stage = flags \u0026amp; 0b0011000000000000 # è§£ææ–‡ä»¶åé•¿åº¦ï¼ˆ12 ä½ï¼‰ name_length = flags \u0026amp; 0b0000111111111111 # è¯»å–äº† 62 ä¸ªå­—èŠ‚ï¼Œç»§ç»­å¤„ç†æ–‡ä»¶å idx += 62 # å¦‚æœæ–‡ä»¶åé•¿åº¦å°äº 0xFFFï¼Œåˆ™æ–‡ä»¶åä¹‹åæœ‰ä¸€ä¸ªç©ºå­—èŠ‚ç»ˆæ­¢ç¬¦ if name_length \u0026lt; 0xFFF: assert content[idx + name_length] == 0x00 raw_name = content[idx:idx+name_length] idx += name_length + 1 else: # å¤„ç†æ–‡ä»¶åé•¿åº¦å¤§äºç­‰äº 0xFFF çš„æƒ…å†µï¼Œéœ€è¦æŸ¥æ‰¾ç©ºå­—èŠ‚ç»ˆæ­¢ç¬¦ print(f\u0026#34;æ³¨æ„: æ–‡ä»¶åé•¿åº¦ä¸º 0x{name_length:X} å­—èŠ‚é•¿ã€‚\u0026#34;) null_idx = content.find(b\u0026#39;\\x00\u0026#39;, idx + 0xFFF) raw_name = content[idx: null_idx] idx = null_idx + 1 # å°†æ–‡ä»¶åè§£æä¸º UTF-8 å­—ç¬¦ä¸² name = raw_name.decode(\u0026#34;utf8\u0026#34;) # ç´¢å¼•æ–‡ä»¶ä¸­çš„æ•°æ®ä»¥ 8 å­—èŠ‚å¯¹é½ï¼Œå› æ­¤éœ€è¦æ ¹æ®æŒ‡é’ˆå¯¹é½è°ƒæ•´ idx idx = 8 * ceil(idx / 8) # å°†è§£æå‡ºçš„ç´¢å¼•æ¡ç›®æ·»åŠ åˆ°åˆ—è¡¨ä¸­ entries.append(GitIndexEntry(ctime=(ctime_s, ctime_ns), mtime=(mtime_s, mtime_ns), dev=dev, ino=ino, mode_type=mode_type, mode_perms=mode_perms, uid=uid, gid=gid, fsize=fsize, sha=sha, flag_assume_valid=flag_assume_valid, flag_stage=flag_stage, name=name)) # è¿”å›åŒ…å«æ‰€æœ‰ç´¢å¼•æ¡ç›®çš„ GitIndex å®ä¾‹ return GitIndex(version=version, entries=entries) def index_write(repo, index): with open(repo_file(repo, \u0026#34;index\u0026#34;), \u0026#34;wb\u0026#34;) as f: # å†™å…¥å¤´éƒ¨ä¿¡æ¯ # å†™å…¥é­”æœ¯å­—èŠ‚ \u0026#34;DIRC\u0026#34; ä»¥æ ‡è¯†è¯¥æ–‡ä»¶ä¸º Git ç´¢å¼•æ–‡ä»¶ã€‚ f.write(b\u0026#34;DIRC\u0026#34;) # å†™å…¥ç‰ˆæœ¬å·ï¼ˆå›ºå®šä¸º 2ï¼‰ã€‚ f.write(index.version.to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥ç´¢å¼•æ¡ç›®æ•°é‡ã€‚ f.write(len(index.entries).to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥æ¡ç›®æ•°æ® idx = 0 for e in index.entries: # å†™å…¥åˆ›å»ºæ—¶é—´ï¼ˆç§’ï¼‰å’Œåˆ›å»ºæ—¶é—´çš„çº³ç§’éƒ¨åˆ†ã€‚ f.write(e.ctime[0].to_bytes(4, \u0026#34;big\u0026#34;)) f.write(e.ctime[1].to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥ä¿®æ”¹æ—¶é—´ï¼ˆç§’ï¼‰å’Œä¿®æ”¹æ—¶é—´çš„çº³ç§’éƒ¨åˆ†ã€‚ f.write(e.mtime[0].to_bytes(4, \u0026#34;big\u0026#34;)) f.write(e.mtime[1].to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥è®¾å¤‡å·å’Œ inode å·ã€‚ f.write(e.dev.to_bytes(4, \u0026#34;big\u0026#34;)) f.write(e.ino.to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥æ–‡ä»¶æƒé™æ¨¡å¼ï¼ˆç±»å‹å’Œæƒé™åˆå¹¶ï¼‰ã€‚ mode = (e.mode_type \u0026lt;\u0026lt; 12) | e.mode_perms f.write(mode.to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥ç”¨æˆ· ID å’Œç»„ IDã€‚ f.write(e.uid.to_bytes(4, \u0026#34;big\u0026#34;)) f.write(e.gid.to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥æ–‡ä»¶å¤§å°ã€‚ f.write(e.fsize.to_bytes(4, \u0026#34;big\u0026#34;)) # å†™å…¥ SHA-1 å¯¹è±¡ IDã€‚ f.write(int(e.sha, 16).to_bytes(20, \u0026#34;big\u0026#34;)) # å¤„ç†æ ‡å¿—ä½ `flag_assume_valid`ã€‚ flag_assume_valid = 0x1 \u0026lt;\u0026lt; 15 if e.flag_assume_valid else 0 # å°†æ–‡ä»¶åç¼–ç ä¸º UTF-8ï¼Œå¹¶è®¡ç®—é•¿åº¦ã€‚ name_bytes = e.name.encode(\u0026#34;utf8\u0026#34;) bytes_len = len(name_bytes) if bytes_len \u0026gt;= 0xFFF: name_length = 0xFFF # é•¿åº¦è¿‡é•¿æ—¶ï¼Œæ ‡è®°ä¸º 0xFFFã€‚ else: name_length = bytes_len # å°† `flag_assume_valid`ã€`flag_stage` å’Œåç§°é•¿åº¦åˆå¹¶åˆ° 2 ä¸ªå­—èŠ‚ä¸­ã€‚ f.write((flag_assume_valid | e.flag_stage | name_length).to_bytes(2, \u0026#34;big\u0026#34;)) # å†™å…¥æ–‡ä»¶åï¼Œå¹¶é™„åŠ ä¸€ä¸ª 0x00 ä½œä¸ºç»“å°¾ã€‚ f.write(name_bytes) f.write((0).to_bytes(1, \u0026#34;big\u0026#34;)) # è®¡ç®—å½“å‰æ¡ç›®çš„å­—èŠ‚æ•°ã€‚ idx += 62 + len(name_bytes) + 1 # è‹¥æ¡ç›®ä¸æ˜¯ 8 å­—èŠ‚å¯¹é½ï¼Œåˆ™è¿›è¡Œå¡«å……ã€‚ if idx % 8 != 0: pad = 8 - (idx % 8) f.write((0).to_bytes(pad, \u0026#34;big\u0026#34;)) idx += pad æŒ‰ç…§æˆ‘ä»¬å‰é¢æ‰€è¯´çš„ï¼Œgit addä¼šæ ¹æ®æ‰€ä¿®æ”¹çš„æ–‡ä»¶è·¯å¾„å¯¹.git/indexæ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚å…·ä½“å®ç°æ–¹å¼æ˜¯ä».git/indexæ–‡ä»¶ä¸­ç§»é™¤æŒ‡å®šè·¯å¾„çš„æ¡ç›®ï¼ˆä¸ç‰©ç†åˆ é™¤æ–‡ä»¶ï¼‰ï¼Œç„¶åå¯¹æ¯ä¸ªè·¯å¾„ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œè®¡ç®—æ–‡ä»¶çš„å“ˆå¸Œå€¼å¹¶è·å–æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œç„¶åå°†æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯æ·»åŠ åˆ°.git/indexæ–‡ä»¶ä¸­ï¼ŒåŒ…æ‹¬ ctimeã€mtimeã€æ–‡ä»¶æƒé™ç­‰ï¼Œæœ€åå°†æ–°çš„ç´¢å¼•æ¡ç›®å†™å›ç´¢å¼•æ–‡ä»¶ã€‚å…·ä½“çš„addå‡½æ•°å®ç°å¦‚ä¸‹ï¼š\ndef add(repo, paths, delete=True, skip_missing=False): # é¦–å…ˆè°ƒç”¨ rm å‡½æ•°ä»ç´¢å¼•ä¸­ç§»é™¤è¿™äº›è·¯å¾„çš„æ¡ç›®ï¼Œé¿å…é‡å¤ï¼ˆä¸ç‰©ç†åˆ é™¤æ–‡ä»¶ï¼‰ã€‚ rm(repo, paths, delete=False, skip_missing=True) # è·å–å·¥ä½œæ ‘çš„æ ¹ç›®å½•è·¯å¾„ï¼ˆæœ«å°¾åŠ ä¸Šè·¯å¾„åˆ†éš”ç¬¦ï¼‰ worktree = repo.worktree + os.sep # å°†è·¯å¾„è½¬æ¢ä¸º (ç»å¯¹è·¯å¾„ï¼Œç›¸å¯¹è·¯å¾„) çš„å¯¹ï¼Œå¹¶ç¡®ä¿å®ƒä»¬åœ¨å·¥ä½œæ ‘å†…ä¸”ä¸ºæ–‡ä»¶ clean_paths = set() for path in paths: abspath = os.path.abspath(path) # è·å–ç»å¯¹è·¯å¾„ if not (abspath.startswith(worktree) and os.path.isfile(abspath)): # ç¡®ä¿è·¯å¾„åœ¨å·¥ä½œæ ‘å†…ä¸”ä¸ºæ–‡ä»¶ raise Exception(f\u0026#34;Not a file, or outside the worktree: {paths}\u0026#34;) # å¦‚æœè·¯å¾„æ— æ•ˆæˆ–ä¸åœ¨å·¥ä½œæ ‘å†…ï¼ŒæŠ›å‡ºå¼‚å¸¸ relpath = os.path.relpath(abspath, repo.worktree) # è·å–ç›¸å¯¹è·¯å¾„ clean_paths.add((abspath, relpath)) # æ·»åŠ åˆ° clean_paths é›†åˆä¸­ # æŸ¥æ‰¾å¹¶è¯»å–ç´¢å¼•ã€‚ç”±äº `rm` å·²ç»ä¿®æ”¹äº†ç´¢å¼•ï¼Œè¿™é‡Œå†æ¬¡è¯»å–ã€‚ # @FIXMEï¼šå¯ä»¥é€šè¿‡ä¼ é€’å‘½ä»¤æ¥ç§»åŠ¨ç´¢å¼•ï¼Œè€Œä¸æ˜¯åå¤è¯»å†™ç´¢å¼•ã€‚ index = index_read(repo) # éå†æ¯ä¸ªè·¯å¾„å¯¹ï¼Œè¯»å–æ–‡ä»¶ï¼Œç”Ÿæˆå“ˆå¸Œå¹¶æ›´æ–°ç´¢å¼•æ¡ç›® for (abspath, relpath) in clean_paths: with open(abspath, \u0026#34;rb\u0026#34;) as fd: sha = object_hash(fd, b\u0026#34;blob\u0026#34;, repo) # è®¡ç®—æ–‡ä»¶çš„ SHA å“ˆå¸Œå€¼ stat = os.stat(abspath) # è·å–æ–‡ä»¶çŠ¶æ€ # è·å–æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´å’Œä¿®æ”¹æ—¶é—´ï¼ˆç§’å’Œçº³ç§’ï¼‰ ctime_s = int(stat.st_ctime) ctime_ns = stat.st_ctime_ns % 10**9 mtime_s = int(stat.st_mtime) mtime_ns = stat.st_mtime_ns % 10**9 # åˆ›å»º Git ç´¢å¼•æ¡ç›®å¯¹è±¡ entry = GitIndexEntry(ctime=(ctime_s, ctime_ns), mtime=(mtime_s, mtime_ns), dev=stat.st_dev, ino=stat.st_ino, mode_type=0b1000, mode_perms=0o644, uid=stat.st_uid, gid=stat.st_gid, fsize=stat.st_size, sha=sha, flag_assume_valid=False, flag_stage=False, name=relpath) # å°†æ–°æ¡ç›®æ·»åŠ åˆ°ç´¢å¼•æ¡ç›®åˆ—è¡¨ index.entries.append(entry) # å°†æ›´æ–°åçš„ç´¢å¼•å†™å›æ–‡ä»¶ index_write(repo, index) def rm(repo, paths, delete=True, skip_missing=False): # æŸ¥æ‰¾å¹¶è¯»å–ç´¢å¼•æ–‡ä»¶ index = index_read(repo) # è·å–å·¥ä½œæ ‘çš„æ ¹ç›®å½•è·¯å¾„ï¼ˆæœ«å°¾åŠ ä¸Šè·¯å¾„åˆ†éš”ç¬¦ï¼‰ worktree = repo.worktree + os.sep # å°†è¾“å…¥è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼Œå¹¶ç¡®ä¿å®ƒä»¬ä½äºå·¥ä½œæ ‘å†… abspaths = set() for path in paths: abspath = os.path.abspath(path) # è·å–ç»å¯¹è·¯å¾„ if abspath.startswith(worktree): # ç¡®ä¿è·¯å¾„åœ¨å·¥ä½œæ ‘ä¸­ abspaths.add(abspath) else: raise Exception(f\u0026#34;Cannot remove paths outside of worktree: {paths}\u0026#34;) # å¦‚æœè·¯å¾„ä¸åœ¨å·¥ä½œæ ‘å†…ï¼ŒæŠ›å‡ºå¼‚å¸¸ # å°†è¦ä¿ç•™çš„ç´¢å¼•æ¡ç›®åˆ—è¡¨ï¼Œç”¨äºæ›´æ–°ç´¢å¼•æ–‡ä»¶ kept_entries = list() # å°†è¦åˆ é™¤çš„è·¯å¾„åˆ—è¡¨ï¼Œç”¨äºç‰©ç†åˆ é™¤æ–‡ä»¶ remove = list() # éå†ç´¢å¼•æ¡ç›®ï¼Œåˆ é™¤åŒ¹é…çš„è·¯å¾„ï¼Œä¿ç•™å…¶ä½™æ¡ç›® for e in index.entries: full_path = os.path.join(repo.worktree, e.name) # è·å–ç´¢å¼•æ¡ç›®çš„å®Œæ•´è·¯å¾„ if full_path in abspaths: # å¦‚æœè·¯å¾„åœ¨å¾…åˆ é™¤åˆ—è¡¨ä¸­ remove.append(full_path) # åŠ å…¥å¾…åˆ é™¤åˆ—è¡¨ abspaths.remove(full_path) # ä»å¾…åˆ é™¤è·¯å¾„ä¸­ç§»é™¤ else: kept_entries.append(e) # ä¿ç•™è¯¥æ¡ç›® # å¦‚æœæœ‰æœªåœ¨ç´¢å¼•ä¸­æ‰¾åˆ°çš„è·¯å¾„ï¼Œä¸” skip_missing=Falseï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ if len(abspaths) \u0026gt; 0 and not skip_missing: raise Exception(f\u0026#34;Cannot remove paths not in the index: {abspaths}\u0026#34;) # ç‰©ç†åˆ é™¤æ–‡ä»¶ç³»ç»Ÿä¸­çš„è·¯å¾„ if delete: for path in remove: os.unlink(path) # åˆ é™¤æ–‡ä»¶ # æ›´æ–°ç´¢å¼•æ¡ç›®ï¼Œå¹¶å°†å…¶å†™å›ç´¢å¼•æ–‡ä»¶ index.entries = kept_entries index_write(repo, index) ç„¶åå†ä½¿ç”¨git addä¹‹åçš„.git/indexæ–‡ä»¶ç”Ÿæˆæ ‘å¯¹è±¡ï¼Œæœ€åå†å€Ÿç”±æ ‘å¯¹è±¡ç”Ÿæˆæäº¤å¯¹è±¡ï¼ï¼ï¼å…·ä½“pythonä»£ç å®ç°å¦‚ä¸‹ï¼š\ndef tree_from_index(repo, index): # åˆå§‹åŒ–ä¸€ä¸ªå­—å…¸ï¼Œç”¨äºå­˜å‚¨ç›®å½•åŠå…¶å†…å®¹ï¼Œæ ¹ç›®å½• \u0026#34;\u0026#34; å­˜å‚¨ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚ contents = dict() contents[\u0026#34;\u0026#34;] = list() # éå†ç´¢å¼•ä¸­çš„æ¯ä¸ªæ¡ç›®ï¼Œæ„å»ºç›®å½•ç»“æ„ã€‚ for entry in index.entries: dirname = os.path.dirname(entry.name) # è·å–å½“å‰æ¡ç›®çš„ç›®å½•å # éå†ç›®å½•è·¯å¾„ï¼Œç›´åˆ°æ ¹ç›®å½•ï¼Œç¡®ä¿æ¯ä¸ªç›®å½•éƒ½è¢«åˆ›å»º key = dirname while key != \u0026#34;\u0026#34;: if key not in contents: # å¦‚æœè¯¥ç›®å½•å°šæœªåœ¨ contents ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªç©ºåˆ—è¡¨ contents[key] = list() key = os.path.dirname(key) # å°†æ¡ç›®æ·»åŠ åˆ°å¯¹åº”ç›®å½•çš„å†…å®¹åˆ—è¡¨ä¸­ contents[dirname].append(entry) # è·å–æ‰€æœ‰ç›®å½•çš„è·¯å¾„å¹¶æŒ‰è·¯å¾„é•¿åº¦ä»é•¿åˆ°çŸ­æ’åº sorted_paths = sorted(contents.keys(), key=len, reverse=True) # åˆå§‹åŒ–æ ‘çš„ SHA-1 å“ˆå¸Œï¼ˆæ ¹æ ‘çš„å“ˆå¸Œå€¼å°†ä¼šä¿å­˜åœ¨è¿™é‡Œï¼‰ sha = None # éå†æ’åºåçš„è·¯å¾„ï¼ˆç›®å½•ï¼‰ï¼Œæ„å»ºæ ‘å¯¹è±¡ for path in sorted_paths: tree = GitTree() # åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºæ ‘å¯¹è±¡ # éå†è¯¥ç›®å½•ä¸‹çš„æ¡ç›®ï¼Œç”Ÿæˆæ ‘å¶å¹¶æ·»åŠ åˆ°æ ‘ä¸­ for entry in contents[path]: if isinstance(entry, GitIndexEntry): # æ™®é€šçš„æ–‡ä»¶æ¡ç›® # è½¬æ¢æ–‡ä»¶çš„æƒé™æ¨¡å¼ï¼ŒGit ä½¿ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œæ ‘å¯¹è±¡éœ€è¦çš„æ˜¯å…«è¿›åˆ¶ ASCII å­—ç¬¦ä¸² leaf_mode = f\u0026#34;{entry.mode_type:02o}{entry.mode_perms:04o}\u0026#34;.encode(\u0026#34;ascii\u0026#34;) leaf = GitTreeLeaf(mode=leaf_mode, path=os.path.basename(entry.name), sha=entry.sha) else: # å­ç›®å½•æ¡ç›®ï¼ˆæ ‘ï¼‰ leaf = GitTreeLeaf(mode=b\u0026#34;040000\u0026#34;, path=entry[0], sha=entry[1]) tree.items.append(leaf) # å°†å¶å­æ·»åŠ åˆ°æ ‘å¯¹è±¡ä¸­ # å°†ç”Ÿæˆçš„æ ‘å¯¹è±¡å†™å…¥å¯¹è±¡å­˜å‚¨ï¼Œå¹¶è·å–å…¶ SHA-1 å“ˆå¸Œ sha = object_write(tree, repo) # å°†æ ‘å¯¹è±¡çš„å“ˆå¸Œå€¼æ·»åŠ åˆ°å…¶çˆ¶ç›®å½•çš„å†…å®¹åˆ—è¡¨ä¸­ï¼Œä½œä¸ºä¸€å¯¹ (æ–‡ä»¶å, SHA) parent = os.path.dirname(path) # è·å–çˆ¶ç›®å½•è·¯å¾„ base = os.path.basename(path) # è·å–å½“å‰ç›®å½•çš„åç§°ï¼ˆä¾‹å¦‚ \u0026#34;main.go\u0026#34;ï¼‰ contents[parent].append((base, sha)) # å°†çˆ¶ç›®å½•ä¸æ–°ç”Ÿæˆçš„æ ‘çš„å“ˆå¸Œå€¼å…³è” return sha # è¿”å›æ ¹æ ‘çš„ SHA-1 å“ˆå¸Œ def commit_create(repo, tree, parent, author, timestamp, message): commit = GitCommit() # åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤å¯¹è±¡ # è®¾ç½®æäº¤å¯¹è±¡çš„æ ‘å­—æ®µä¸ºå½“å‰æäº¤çš„æ ‘å¯¹è±¡çš„ SHA-1 å€¼ commit.kvlm[b\u0026#34;tree\u0026#34;] = tree.encode(\u0026#34;ascii\u0026#34;) # å¦‚æœæœ‰çˆ¶æäº¤ï¼Œè®¾ç½®çˆ¶æäº¤å­—æ®µ if parent: commit.kvlm[b\u0026#34;parent\u0026#34;] = parent.encode(\u0026#34;ascii\u0026#34;) # æ¸…ç†æäº¤ä¿¡æ¯ï¼Œå¹¶åœ¨æœ«å°¾åŠ ä¸Šæ¢è¡Œç¬¦ message = message.strip() + \u0026#34;\\n\u0026#34; # æ ¼å¼åŒ–æ—¶åŒºåç§»ï¼ˆä¾‹å¦‚ \u0026#34;+0200\u0026#34; æˆ– \u0026#34;-0700\u0026#34;ï¼‰ offset = int(timestamp.astimezone().utcoffset().total_seconds()) # è·å–æ—¶åŒºåç§»ï¼ˆç§’ï¼‰ hours = offset // 3600 # è®¡ç®—å°æ—¶ minutes = (offset % 3600) // 60 # è®¡ç®—åˆ†é’Ÿ tz = \u0026#34;{}{:02}{:02}\u0026#34;.format(\u0026#34;+\u0026#34; if offset \u0026gt; 0 else \u0026#34;-\u0026#34;, hours, minutes) # æ ¼å¼åŒ–æ—¶åŒºå­—ç¬¦ä¸² # å°†ä½œè€…ä¿¡æ¯æ ¼å¼åŒ–ä¸º \u0026#34;Author Name \u0026lt;email\u0026gt; timestamp timezone\u0026#34; author = author + timestamp.strftime(\u0026#34; %s \u0026#34;) + tz # è®¾ç½®æäº¤å¯¹è±¡çš„ä½œè€…å’Œæäº¤è€…å­—æ®µä¸ºç›¸åŒçš„å€¼ commit.kvlm[b\u0026#34;author\u0026#34;] = author.encode(\u0026#34;utf8\u0026#34;) commit.kvlm[b\u0026#34;committer\u0026#34;] = author.encode(\u0026#34;utf8\u0026#34;) # è®¾ç½®æäº¤ä¿¡æ¯å­—æ®µ commit.kvlm[None] = message.encode(\u0026#34;utf8\u0026#34;) # å°†æäº¤å¯¹è±¡å†™å…¥å¯¹è±¡å­˜å‚¨ï¼Œå¹¶è¿”å›å…¶ SHA-1 å“ˆå¸Œ return object_write(commit, repo) GitäºŒè¿å‡»å¯è§†åŒ– å·²ç»äº†è§£äº†ä¸Šé¢çš„åº•å±‚åŸç†åï¼Œå¯¹Gitä¸¤è¿å‡»çš„çš„å¯è§†åŒ–ä¹Ÿå°±ååˆ†ç®€å•äº†ï¼Œè¯¦è§ä¸‹å›¾ï¼Œå‚è€ƒè¿™æ‰æ˜¯çœŸæ­£çš„Gitâ€”â€”Gitå†…éƒ¨åŸç†æ­ç§˜ï¼ï¼š ç°åœ¨ï¼ŒğŸ˜®â€ğŸ’¨ï¼Œæ‰€æœ‰GitåŸºç¡€çš„å†…å®¹çš„åº•å±‚åŸç†ä»¥åŠå…¶ä»£ç å½¢å¼å·®ä¸å¤šå°±è®²è§£å®Œäº†ã€‚è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé«˜çº§çš„Gitå†…å®¹æˆ‘ä»¬ç•™å¾…åæ–‡ã€‚\nGitå¸¸ç”¨å‘½ä»¤è¿›é˜¶ æˆ‘ä»¬å·²ç»å¯è§†åŒ–äº†Gitä¸¤è¿å‡»ä¸­ç»†èŠ‚ï¼Œä¸‹é¢æˆ‘ä»¬å¯ä»¥ä»é«˜å±‚æ¬¡çš„è§†è§’ï¼ˆGitCommitï¼‰æ¥å¯¹Gitä¸­çš„é«˜é˜¶å¸¸ç”¨å‘½ä»¤è¿›è¡Œå¯è§†åŒ–ï¼Œå¯è§†åŒ–ç»“æœç”±Learn Git Branchæä¾›ã€‚æˆ‘ä»¬ç»è¿‡ä¸€ç³»åˆ—çš„git addå’Œgit commitä»¥åŠgit checkoutä¹‹åå¾—åˆ°çš„åˆå§‹çš„GitCommitçš„åˆ†å¸ƒæƒ…å†µå¦‚å›¾7æ‰€ç¤ºã€‚\nå›¾7ï¼šåˆå§‹GitCommitåˆ†å¸ƒæƒ…å†µ æ¥ä¸‹æ¥å…ˆä»‹ç»çš„4ä¸ªå‘½ä»¤çš„è”ç³»å¦‚å›¾8æ‰€ç¤ºï¼š\nå›¾8ï¼šgit resetã€git checkoutã€git addå’Œ git commitçš„è”ç³» git addå’Œgit commit å‘½ä»¤æˆ‘ä»¬å·²ç»è¯¦ç»†ä»‹ç»è¿‡äº†ï¼Œä¸‹é¢å†ç®€è¦å¯¹å¯¹è¿™4ä¸ªå‘½ä»¤è¿›è¡Œå™è¿°ã€‚\ngit addÂ filesÂ æŠŠå½“å‰æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒºåŸŸã€‚ git commit -m messageÂ ç»™æš‚å­˜åŒºåŸŸç”Ÿæˆå¿«ç…§å¹¶æäº¤ï¼Œè€Œgit commit -a -m messageè‡ªåŠ¨å°†æ‰€æœ‰è¢«è·Ÿè¸ªçš„æ–‡ä»¶çš„æ›´æ”¹æš‚å­˜å¹¶æäº¤ï¼Œçœç•¥äº†git addçš„æ­¥éª¤ã€‚ git reset filesÂ ç”¨æ¥æ’¤é”€æœ€åä¸€æ¬¡git addÂ filesï¼Œä½ ä¹Ÿå¯ä»¥ç”¨git resetÂ æ’¤é”€æ‰€æœ‰æš‚å­˜åŒºåŸŸæ–‡ä»¶ã€‚ git checkout filesÂ æŠŠæ–‡ä»¶ä»æš‚å­˜åŒºåŸŸå¤åˆ¶åˆ°å·¥ä½œç›®å½•ï¼Œç”¨æ¥ä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹ï¼Œè€Œgit checkout HEAD filesÂ ç”¨æ¥å°†å·¥ä½œç›®å½•ä¸­æŒ‡å®šæ–‡ä»¶æ¢å¤åˆ°å½“å‰åˆ†æ”¯æœ€æ–°ä¸€æ¬¡æäº¤æ—¶çš„çŠ¶æ€ï¼ˆå³ HEAD æŒ‡é’ˆæŒ‡å‘çš„æäº¤ï¼‰ã€‚è¿™ç›¸å½“äºä¸¢å¼ƒå¯¹è¿™äº›æ–‡ä»¶çš„æ‰€æœ‰æœªæäº¤ä¿®æ”¹ï¼Œæ¢å¤åˆ°ä¸Šä¸€æ¬¡æäº¤çš„ç‰ˆæœ¬ã€‚ git checkout åˆ†æ”¯å‚æ•° checkoutå‘½ä»¤ç”¨äºä»å†å²æäº¤ï¼ˆæˆ–è€…æš‚å­˜åŒºåŸŸï¼‰ä¸­æ‹·è´æ–‡ä»¶åˆ°å·¥ä½œç›®å½•ï¼Œä¹Ÿå¯ç”¨äºåˆ‡æ¢åˆ†æ”¯ã€‚å½“ä¸æŒ‡å®šæ–‡ä»¶åï¼Œè€Œæ˜¯ç»™å‡ºä¸€ä¸ªï¼ˆæœ¬åœ°ï¼‰åˆ†æ”¯æ—¶ï¼Œé‚£ä¹ˆHEADæ ‡è¯†ä¼šç§»åŠ¨åˆ°é‚£ä¸ªåˆ†æ”¯ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬â€œåˆ‡æ¢â€åˆ°é‚£ä¸ªåˆ†æ”¯äº†ï¼‰ï¼Œç„¶åæš‚å­˜åŒºåŸŸå’Œå·¥ä½œç›®å½•ä¸­çš„å†…å®¹ä¼šå’ŒHEADå¯¹åº”çš„æäº¤èŠ‚ç‚¹ä¸€è‡´ã€‚æ–°æäº¤èŠ‚ç‚¹ï¼ˆä¸‹å›¾ä¸­çš„C1ï¼‰ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«å¤åˆ¶ï¼ˆåˆ°æš‚å­˜åŒºåŸŸå’Œå·¥ä½œç›®å½•ä¸­ï¼‰ï¼›åªå­˜åœ¨äºè€çš„æäº¤èŠ‚ç‚¹ï¼ˆC5ï¼‰ä¸­çš„æ–‡ä»¶ä¼šè¢«åˆ é™¤ï¼›ä¸å±äºä¸Šè¿°ä¸¤è€…çš„æ–‡ä»¶ä¼šè¢«å¿½ç•¥ï¼Œä¸å—å½±å“ã€‚(åˆ†æ”¯åœ¨.gitæ–‡ä»¶å¤¹ä¸­å¯¹åº”.git/refs/heads/ä¸­çš„æ–‡ä»¶ï¼ŒHEADå¯¹åº”.gitæ–‡ä»¶å¤¹ä¸­çš„HEADæ–‡ä»¶ï¼Œgit checkout stableå°†HEADæ–‡ä»¶å†…å®¹ç”±ref: refs/heads/mainæ”¹å˜æˆref: refs/heads/stableåŒæ—¶æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–)\nå›¾9ï¼šgit checkout stableå°†åˆ†æ”¯ä»mainè½¬æ¢åˆ°stable è¢«åˆ†ç¦»çš„HEADæ ‡è¯† å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šæ–‡ä»¶åï¼Œä¹Ÿæ²¡æœ‰æŒ‡å®šåˆ†æ”¯åï¼Œè€Œæ˜¯ä¸€ä¸ªæ ‡ç­¾ã€è¿œç¨‹åˆ†æ”¯ã€SHA-1å€¼æˆ–è€…æ˜¯åƒmain~3ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå°±å¾—åˆ°ä¸€ä¸ªåŒ¿ååˆ†æ”¯ï¼Œç§°ä½œdetached HEADï¼ˆè¢«åˆ†ç¦»çš„HEADæ ‡è¯†ï¼‰ï¼Œæš‚å­˜åŒºåŸŸå’Œå·¥ä½œç›®å½•ä¸­çš„å†…å®¹ä¼šå’ŒHEADå¯¹åº”çš„æäº¤èŠ‚ç‚¹ä¸€è‡´ã€‚\nå›¾10ï¼šgit checkout main~3å°†HEADåˆ†ç¦»å‡ºæ¥ HEADå¤„äºåˆ†ç¦»çŠ¶æ€æ—¶ï¼Œæäº¤æ“ä½œå¯ä»¥æ­£å¸¸è¿›è¡Œå¦‚å›¾11æ‰€ç¤ºï¼Œä½†æ˜¯ä¸ä¼šæ›´æ–°ä»»ä½•å·²å‘½åçš„åˆ†æ”¯ã€‚(ä½ å¯ä»¥è®¤ä¸ºè¿™æ˜¯åœ¨æ›´æ–°ä¸€ä¸ªåŒ¿ååˆ†æ”¯ã€‚)ä¸€æ—¦æ­¤åä½ åˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯ï¼Œæ¯”å¦‚è¯´mainï¼Œé‚£ä¹ˆè¿™ä¸ªæäº¤èŠ‚ç‚¹ï¼ˆå¯èƒ½ï¼‰å†ä¹Ÿä¸ä¼šè¢«å¼•ç”¨åˆ°ï¼Œç„¶åå°±ä¼šè¢«ä¸¢å¼ƒæ‰äº†ï¼Œå¦‚å›¾12æ‰€ç¤ºã€‚\nå›¾11ï¼šHEADæ ‡è¯†å¤„äºåˆ†ç¦»çŠ¶æ€æ—¶çš„æäº¤æ“ä½œ å›¾12ï¼šgit checkout mainè¿è¡Œåä¹‹å‰æäº¤èŠ‚ç‚¹çš„æƒ…å†µ ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œå¯ä»¥ç”¨å‘½ä»¤git checkout -bÂ nameæ¥åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå¦‚å›¾13æ‰€ç¤ºã€‚\nå›¾13ï¼šgit checkout -b newè¿è¡Œåå¯ä»¥ä¿å­˜æäº¤çŠ¶æ€ git reset resetå‘½ä»¤æŠŠå½“å‰åˆ†æ”¯æŒ‡å‘å¦ä¸€ä¸ªä½ç½®ï¼Œå¹¶ä¸”æœ‰é€‰æ‹©çš„å˜åŠ¨å·¥ä½œç›®å½•å’Œç´¢å¼•ã€‚ä¹Ÿç”¨æ¥åœ¨ä»å†å²ä»“åº“ä¸­å¤åˆ¶æ–‡ä»¶åˆ°ç´¢å¼•ï¼Œè€Œä¸åŠ¨å·¥ä½œç›®å½•ã€‚\nå¦‚æœä¸ç»™é€‰é¡¹ï¼Œç§»åŠ¨HEADåˆ°æŒ‡å®šçš„æäº¤ï¼Œå¹¶ä¸”å°†æ›´æ”¹ä»æš‚å­˜åŒºç§»é™¤ï¼Œä½†ä¿ç•™åœ¨å·¥ä½œç›®å½•ä¸­ï¼ˆéœ€è¦git addå’Œgit commitï¼‰ã€‚å¦‚æœç”¨--hardé€‰é¡¹ï¼Œç§»åŠ¨HEADåˆ°æŒ‡å®šçš„æäº¤ï¼Œå¹¶ä¸”é‡ç½®æš‚å­˜åŒºå’Œå·¥ä½œç›®å½•ï¼Œå¦‚æœç”¨--softé€‰é¡¹ï¼Œä»…ä»…ç§»åŠ¨HEADåˆ°æŒ‡å®šçš„æäº¤ï¼Œä½†ä¿ç•™å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ›´æ”¹ï¼ˆä»…éœ€è¦git commitï¼‰ã€‚\nå›¾14ï¼šç°å°†HEADæŒ‡å‘mainåˆ†æ”¯å†è¿è¡Œgit reset main~3åçš„æƒ…å†µ å¦‚æœæ²¡æœ‰ç»™å‡ºæäº¤ç‚¹çš„ç‰ˆæœ¬å·ï¼Œé‚£ä¹ˆé»˜è®¤ç”¨HEADã€‚è¿™æ ·ï¼Œåˆ†æ”¯æŒ‡å‘ä¸å˜ï¼Œä½†æ˜¯ç´¢å¼•ä¼šå›æ»šåˆ°æœ€åä¸€æ¬¡æäº¤ï¼Œå¦‚æœç”¨--hardé€‰é¡¹ï¼Œå·¥ä½œç›®å½•ä¹ŸåŒæ ·ã€‚\ngit merge merge å‘½ä»¤æŠŠä¸åŒåˆ†æ”¯åˆå¹¶èµ·æ¥ã€‚åˆå¹¶å‰ï¼Œç´¢å¼•å¿…é¡»å’Œå½“å‰æäº¤ç›¸åŒã€‚å¦‚æœå¦ä¸€ä¸ªåˆ†æ”¯æ˜¯å½“å‰æäº¤çš„ç¥–çˆ¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåˆå¹¶å‘½ä»¤å°†ä»€ä¹ˆä¹Ÿä¸åšã€‚ å¦ä¸€ç§æƒ…å†µæ˜¯å¦‚æœå½“å‰æäº¤æ˜¯å¦ä¸€ä¸ªåˆ†æ”¯çš„ç¥–çˆ¶èŠ‚ç‚¹ï¼Œå°±å¯¼è‡´fast-forwardåˆå¹¶ã€‚æŒ‡å‘åªæ˜¯ç®€å•çš„ç§»åŠ¨ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„æäº¤ã€‚\nå›¾14ï¼šè¿è¡Œgit merge mainå‰çš„æƒ…å†µ å›¾15ï¼šè¿è¡Œgit merge mainåçš„æƒ…å†µï¼Œå¿«é€Ÿå‰è¿› å¦åˆ™å°±æ˜¯ä¸€æ¬¡çœŸæ­£çš„åˆå¹¶ã€‚é»˜è®¤æŠŠå½“å‰æäº¤(C5Â å¦‚ä¸‹æ‰€ç¤º)å’Œå¦ä¸€ä¸ªæäº¤(C7)ä»¥åŠä»–ä»¬çš„å…±åŒç¥–çˆ¶èŠ‚ç‚¹(C2)è¿›è¡Œä¸€æ¬¡ä¸‰æ–¹åˆå¹¶ã€‚ç»“æœæ˜¯å…ˆä¿å­˜å½“å‰ç›®å½•å’Œç´¢å¼•ï¼Œç„¶åå’Œçˆ¶èŠ‚ç‚¹C7ä¸€èµ·åšä¸€æ¬¡æ–°æäº¤ã€‚\nå›¾16ï¼šè¿è¡Œgit merge mainå‰çš„æƒ…å†µ å›¾17ï¼šè¿è¡Œgit merge mainåçš„æƒ…å†µï¼Œæ­£å®—èåˆ git cherry-pick git cherry-pickå‘½ä»¤\u0026quot;å¤åˆ¶\u0026quot;ä¸€ä¸ªæäº¤èŠ‚ç‚¹å¹¶åœ¨å½“å‰åˆ†æ”¯åšä¸€æ¬¡å®Œå…¨ä¸€æ ·çš„æ–°æäº¤ï¼Œæš‚å­˜åŒºå’Œå·¥ä½œç›®å½•éƒ½å‘ç”Ÿæ”¹å˜ã€‚\nå›¾18ï¼šè¿è¡Œgit cherry-pick C4ä¹‹å‰çš„æƒ…å†µ å›¾19ï¼šè¿è¡Œgit cherry-pick C4ä¹‹åçš„æƒ…å†µï¼Œå¤åˆ¶C4åœ¨å½“å‰mainåˆ†æ”¯ä¸‹åšä¸€æ¬¡å®Œå…¨ç›¸åŒçš„æäº¤ ### `git rebase` è¡åˆæ˜¯åˆå¹¶å‘½ä»¤çš„å¦ä¸€ç§é€‰æ‹©ã€‚åˆå¹¶æŠŠä¸¤ä¸ªçˆ¶åˆ†æ”¯åˆå¹¶è¿›è¡Œä¸€æ¬¡æäº¤ï¼Œæäº¤å†å²ä¸æ˜¯çº¿æ€§çš„ã€‚è¡åˆåœ¨å½“å‰åˆ†æ”¯ä¸Šé‡æ¼”å¦ä¸€ä¸ªåˆ†æ”¯çš„å†å²ï¼Œæäº¤å†å²æ˜¯çº¿æ€§çš„ã€‚ æœ¬è´¨ä¸Šï¼Œè¿™æ˜¯çº¿æ€§åŒ–çš„è‡ªåŠ¨çš„Â cherry-pickã€‚\nå›¾20ï¼šè¿è¡Œgit rebase bugFixä¹‹å‰çš„æƒ…å†µ å›¾21ï¼šè¿è¡Œgit rebase bugFixä¹‹åçš„æƒ…å†µ Gitæœ¬åœ°ä»“åº“è¿æ¥å¹¶ä¸Šä¼ è¿œç¨‹ä»“åº“ ä½¿ç”¨sshå¯†é’¥å°†æœ¬åœ°gitå’Œè¿œç¨‹GitHubé…å¯¹ å‚è€ƒhttps://zhuanlan.zhihu.com/p/138305054\næœ¬åœ°ä¸Šä¼ è¿œç¨‹6æ­¥èµ°æˆ˜ç•¥ git initï¼šå°†æ–‡ä»¶å¤¹è®¾ç½®ä¸ºæœ¬åœ°ä»“åº“ï¼Œåªæœ‰è¿™æ ·æ‰å¯ä»¥æŠŠæœ¬åœ°çš„æ–‡ä»¶ä¼ å…¥githubä»“åº“ã€‚ git remote add originÂ git@github.com:yourusername/yourprojectname.gitï¼šå°†æœ¬åœ°ä»“åº“ä¸githubä»“åº“è¿›è¡Œå…³è”ã€‚ git pull origin main(or master)ï¼šå°†GitHubä¸Šä»“åº“çš„å†…å®¹pullåˆ°æœ¬åœ°ä»“åº“ï¼Œä¸¤è€…ä¿æŒä¸€è‡´ã€‚ git addï¼šéœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ æ·»åŠ æ–‡ä»¶åˆ°æœ¬åœ°åº“ã€‚ï¼ˆå†æ¬¡ä¸Šä¼ å°±æ˜¯3æ­¥èµ°æˆ˜ç•¥ï¼‰ git commit -m â€œinformationâ€ï¼šæäº¤æ–‡ä»¶åˆ°æœ¬åœ°åº“ã€‚ï¼ˆå†æ¬¡ä¸Šä¼ å°±æ˜¯3æ­¥èµ°æˆ˜ç•¥ï¼‰ git push origin main(or master)ï¼šä¸Šä¼ æ–‡ä»¶ã€‚ï¼ˆå†æ¬¡ä¸Šä¼ å°±æ˜¯3æ­¥èµ°æˆ˜ç•¥ï¼‰ å‚è€ƒç½‘ç«™ Write yourself a Git! è¿™æ‰æ˜¯çœŸæ­£çš„Gitâ€”â€”Gitå†…éƒ¨åŸç†æ­ç§˜ï¼ Learn Git Branch ","permalink":"https://fordelkon.github.io/posts/git_intro/","summary":"\u003cp\u003eè¿™ç¯‡åšå®¢ä¸»è¦è‡ªåº•å‘ä¸Šåœ°ä»‹ç»Gitå‘½ä»¤è¡Œï¼Œæœ‰æ—¶ç”šè‡³ä¼šä½¿ç”¨ä¸€äº›\u003ccode\u003epython\u003c/code\u003eä»£ç æ¥å¯¹ä¸€äº›Gitçš„åŠŸèƒ½è¿›è¡Œæ›´åŠ è¯¦ç»†çš„åˆ†æã€‚æˆ‘ä¸€ç›´è®¤ä¸ºåŸºç¡€ä¸€æ—¦æ‰“å¥½ï¼Œé‚£ä¹ˆä¸€äº›æ›´é«˜çº§çš„ç”¨æ³•ä¹Ÿå¯ä»¥å¾ªåºæ¸è¿›åœ°äº†è§£ï¼Œè€Œä¸”æ˜¯æ›´åŠ é€å½»çš„äº†è§£ã€‚ä¸æ˜¯åƒåšä¸»ä¸€å¼€å§‹é‚£æ ·ä»¥ä¸ºåªè¦æ­»è®°ç¡¬èƒŒ\u003ccode\u003egit add\u003c/code\u003eï¼Œ\u003ccode\u003egit commit\u003c/code\u003e,\u003ccode\u003egit pull\u003c/code\u003eï¼Œ\u003ccode\u003egit clone\u003c/code\u003eç­‰å¸¸è§å‘½ä»¤çš„ä¸€äº›ç”¨æ³•å°±å¯ä»¥äº†ğŸ˜­ï¼ˆå®é™…ä¸Šç½‘ä¸Šå¤§å¤šæ•°æ•™ç¨‹å°±æ˜¯è¿™æ ·æ•™çš„\u0026hellip;ï¼‰ï¼Œåœ¨è¿™ä¸Šé¢èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œæ‰€ä»¥ä»å¤´å¼€å§‹æ‰“åœ°åŸºå†™ä½œæ­¤æ–‡ç•™ä»¥è­¦ç¤ºâš ï¸ã€‚\u003c/p\u003e\n\u003c!-- more --\u003e\n\u003ch2 id=\"gitä»“åº“git-repository\"\u003eGitä»“åº“ï¼ˆGit Repositoryï¼‰\u003c/h2\u003e\n\u003cp\u003eè¦å­¦ä¹ Gitï¼Œé¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æˆ‘ä»¬è¿è¡ŒGitå‘½ä»¤æ˜¯å¯¹ä»€ä¹ˆå¯¹è±¡è¿›è¡Œæ“ä½œçš„ï¼Œåœ¨Gitçš„ç›¸å…³æœ¯è¯­ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡å«åšGitä»“åº“ï¼ˆGit Repositoryï¼‰ï¼ŒGitä»“åº“å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œæˆ‘ä»¬é€šè¿‡.gitæ–‡ä»¶å¤¹ï¼ˆéšè—æ–‡ä»¶å¤¹ï¼‰å¯¹Gitä»“åº“ä¸­çš„å·¥ä½œåŒºä¸­çš„æ–‡ä»¶ï¼ˆééšè—æ–‡ä»¶å¤¹ï¼‰å†…å®¹çš„æ”¹å˜è¿›è¡Œè®°å½•ï¼Œå½“ç„¶å¹¶ä¸æ˜¯æ‰€æœ‰ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶çš„æ”¹å˜éƒ½ä¼šè¢«è®°å½•ï¼Œè¢«.gitingoreæ–‡ä»¶æ‰€æ ‡è¯†çš„æ–‡ä»¶è¢«æ”¹å˜å.gitæ–‡ä»¶å¤¹ä¸ä¼šå¯¹å…¶è¿›è¡Œè®°å½•ã€‚æ ¹æ®æˆ‘ä¸Šé¢æ‰€è¯´ï¼Œ\u003cfont color=\"#c00000\"\u003eGitæ“ä½œæœ€éšæ™¦çš„åœ°æ–¹å°±åœ¨äºå¯¹äº.gitæ–‡ä»¶å¤¹ä¸­å†…å®¹çš„ä¿®æ”¹æ¥ä¿è¯å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å†…å®¹ä¿®æ”¹çš„è®°å½•\u003c/font\u003eã€‚\u003c/p\u003e\n\u003cp\u003eæ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸‹ç®€ç•¥çš„å…¬å¼ï¼š\u003c/p\u003e\n\u003cdiv\u003e\n$$\\mathrm{Git}\\ \\mathrm{Repository} = \\mathrm{.git}\\ \\mathrm{folder} + \\mathrm{worktree}\\ \\mathrm{folder}\\tag{1}$$\n\u003c/div\u003e\n\u003cp\u003eæ›´åŠ è¯¦å°½çš„æ¥è¯´ä»¥\u003ccode\u003epython\u003c/code\u003eæ¥æ„å»ºGitä»“åº“ç±»ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGitRepository\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;A git repository\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eworktree\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003egitdir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eworktree\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egitdir\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eos\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;.git\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"gitæ–‡ä»¶å¤¹å†…éƒ¨ç»“æ„æ¢ç©¶\"\u003e.gitæ–‡ä»¶å¤¹å†…éƒ¨ç»“æ„æ¢ç©¶\u003c/h2\u003e\n\u003cp\u003eå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†\u003cfont color=\"#ff0000\"\u003eGitæ“ä½œæœ€éšæ™¦çš„åœ°æ–¹å°±åœ¨äºå¯¹äº.gitæ–‡ä»¶å¤¹ä¸­å†…å®¹çš„ä¿®æ”¹æ¥ä¿è¯å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹ä¸­æ–‡ä»¶å†…å®¹ä¿®æ”¹çš„è®°å½•\u003c/font\u003eï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦å¯¹æ­¤è¿›è¡Œè„±è´«æ”»åšäº†ã€‚ç”±äº.gitæ˜¯éšè—æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…ˆå¯¹.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒæœ‰ä¸€å®šçš„äº†è§£ï¼Œ\u003ccode\u003egit init\u003c/code\u003eåˆå§‹åŒ–åçš„.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒå¦‚å›¾1æ‰€ç¤ºï¼Œæ­¤æ—¶Gitä»“åº“å†…é™¤äº†.gitæ–‡ä»¶å¤¹ä¹‹å¤–ä¸€ç‰‡è’èŠœã€‚\u003c/p\u003e\n\u003ccenter\u003e\n  \u003cimg src=\"./img/gitinit.png\" alt=\"å›¾ç‰‡1\" width=\"400\"\u003e\n\u003c/center\u003e\n\u003ccenter\u003e\n\u003cstrong\u003eå›¾1ï¼šè¿è¡Œgit initä¹‹å.gitæ–‡ä»¶å¤¹çš„æ–‡ä»¶åˆ†å¸ƒç»“æ„\u003c/strong\u003e\n\u003c/center\u003e\n\u003cp\u003eç„¶åæˆ‘ä»¬å†æœ¬åœ°Gitä»“åº“ä¸­æ·»åŠ å¯è§æ–‡ä»¶ï¼Œæ·»åŠ åçš„ç»“æœå¦‚å›¾2æ‰€ç¤ºã€‚\u003c/p\u003e\n\u003ccenter\u003e\n  \u003cimg src=\"./img/add.png\" alt=\"å›¾ç‰‡1\" width=\"400\"\u003e\n\u003c/center\u003e\n\u003ccenter\u003e\n\u003cstrong\u003eå›¾2ï¼šGitä»“åº“æ·»åŠ æ–‡ä»¶åçš„æ–‡ä»¶åˆ†å¸ƒ\u003c/strong\u003e\n\u003c/center\u003e\n\u003cp\u003eå°†ä¸Šè¿°æ‰€æœ‰æ–‡ä»¶è¿è¡Œ\u003ccode\u003egit add\u003c/code\u003eä¹‹ååœ¨è¿›è¡Œ\u003ccode\u003egit commit\u003c/code\u003eè§‚å¯Ÿ.gitæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶åˆ†å¸ƒï¼Œå¦‚å›¾3æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ç›¸è¾ƒäºæœ€åˆçš„.gitæ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨\u003ccode\u003egit add\u003c/code\u003eå’Œ\u003ccode\u003egit commit\u003c/code\u003eä¹‹åæ–‡ä»¶å¤¹ä¸­å¤šå‡ºäº†\u003ccode\u003eindex\u003c/code\u003eæ–‡ä»¶ï¼Œ\u003ccode\u003elog\u003c/code\u003eæ–‡ä»¶å¤¹ï¼Œ\u003ccode\u003eobjects\u003c/code\u003eæ–‡ä»¶å¤¹ä¸­çš„8ä¸ªæ–‡ä»¶ä»¥åŠ\u003ccode\u003erefs/heads\u003c/code\u003eä¸‹çš„\u003ccode\u003emain\u003c/code\u003eæ–‡ä»¶ï¼Œå…¶ä»–çš„ä¸€äº›å˜åŒ–æˆ‘ä»¬ä¸åšè€ƒè™‘ã€‚\u003cfont color=\"#ff0000\"\u003eæœ‰æœå¯¼å› æˆ‘ä»¬å¯ä»¥çŸ¥é“.gitæ–‡ä»¶å¤¹å†…éƒ¨çš„è¿™äº›å˜åŒ–ä¸­æœ‰å¯¹äºGitä»“åº“ééšè—æ–‡ä»¶å¤¹æ–‡ä»¶ä¿®æ”¹çš„è®°å½•ã€‚\u003c/font\u003e\u003c/p\u003e\n\u003ccenter\u003e\n  \u003cimg src=\"./img/gitaddcommit.png\" alt=\"å›¾ç‰‡1\" width=\"400\"\u003e\n\u003c/center\u003e\n\u003ccenter\u003e\n\u003cstrong\u003eå›¾3ï¼šè¿è¡Œgit addå’Œgit commitä¹‹å.gitæ–‡ä»¶å¤¹çš„æ–‡ä»¶åˆ†å¸ƒç»“æ„\u003c/strong\u003e\n\u003c/center\u003e\n\u003ch2 id=\"gitå¯¹è±¡git-object\"\u003eGitå¯¹è±¡ï¼ˆGit Objectï¼‰\u003c/h2\u003e\n\u003cp\u003eä¸Šé¢çš„å˜åŒ–ç©¶ç«Ÿæ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿè¦çŸ¥é“Gitä¸­çš„å‡ ä¹ä¸€åˆ‡éƒ½è¢«å­˜å‚¨ä¸ºGitå¯¹è±¡ï¼ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡Gitå¯¹è±¡è¿›è¡Œæ“ä½œæ¥å®Œæˆä¸Šé¢çš„å˜åŒ–ã€‚è¯´äº†è¿™ä¹ˆå¤šï¼Œè®©æˆ‘ä»¬æ¥ä¸ºGitå¯¹è±¡ä¸‹ä¸€ä¸ªæ¯”è¾ƒå®˜æ–¹çš„å®šä¹‰ï¼š\u003cfont color=\"#ff0000\"\u003eGitå¯¹è±¡å°±æ˜¯åœ¨ Git ä»“åº“ä¸­çš„æ–‡ä»¶ï¼Œå®ƒä»¬çš„è·¯å¾„ç”±å®ƒä»¬çš„å†…å®¹å†³å®šã€‚\u003c/font\u003e\u003c/p\u003e\n\u003cp\u003eGitå¯¹è±¡èŒƒæ€§å¯ä»¥å€Ÿç”±\u003ccode\u003epython\u003c/code\u003eæ¥å®ç°ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-python\" data-lang=\"python\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eGitObject\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eobject\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"fm\"\u003e__init__\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003eNone\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eelse\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003eserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;å°†å¯¹è±¡è½¬å˜ä¸ºzipæ–‡ä»¶è§£å‹ç¼©åçš„byteæ ¼å¼\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"ne\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Unimplemented!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003edeserialize\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s2\"\u003e\u0026#34;\u0026#34;\u0026#34;dataé€šå¸¸ä¸ºzipæ–‡ä»¶è§£å‹ç¼©åçš„byteæ ¼å¼ï¼Œæ ¹æ®ç±»å‹è§£ç \u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eraise\u003c/span\u003e \u003cspan class=\"ne\"\u003eException\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;Unimplemented!\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"bp\"\u003eself\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003epass\u003c/span\u003e \u003cspan class=\"c1\"\u003e# Just do nothing. This is a reasonable default!\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eGitå¯¹è±¡åˆç»†åˆ†ä¸ºä»¥ä¸‹å››ç§ç±»å‹ï¼šGitBlobï¼ˆBinary Large Objectï¼‰å¯¹è±¡ï¼Œ GitCommitå¯¹è±¡ï¼Œ GitTreeå¯¹è±¡ï¼Œ GitTagå¯¹è±¡ï¼Œä»¥ä¸‹åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚\u003c/p\u003e","title":"Gitè¯¦è§£"},{"content":"åœ¨æ·±åº¦å­¦ä¹ ä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å…·æœ‰è‰¯å¥½æ•°å­¦æ€§è´¨çš„æ¦‚ç‡åˆ†å¸ƒå¯¹å·²æœ‰æ•°æ®åˆ†å¸ƒè¿›è¡Œå»ºæ¨¡ï¼Œä»¥ä¾¿å¾—åˆ°ä¼˜ç¾çš„æŸå¤±å‡½æ•°å½¢å¼æ–¹ä¾¿æ¨¡å‹è¿›è¡Œåå‘ä¼ æ’­ï¼ŒåŒæ—¶èµ‹äºˆæ¨¡å‹å®é™…çš„æ¦‚ç‡å«ä¹‰ã€‚åœ¨è¯¥ç« èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»æ·±åº¦å­¦ä¹ ä¸­å¸¸ç”¨çš„æ¦‚ç‡åˆ†å¸ƒä»¥åŠä¸åŒæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»åº¦é‡æ–¹æ³•ã€‚å‡è®¾æˆ‘ä»¬å·²æœ‰æ•°æ®é›†$ \\mathcal{D}=\\lbrace(\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N} $æˆ–$ \\mathcal{D}=\\lbrace\\mathbf{x}_{i}\\rbrace_{i=1}^{N} $ï¼Œä¸»è¦åŒºåˆ†äºæœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æƒ…å†µï¼Œ$ z $æˆ–$ \\mathbf{z}$ ä¸»è¦è¡¨ç¤ºæ·±åº¦å­¦ä¹ æ¨¡å‹æœªç»å¤„ç†çš„è¾“å‡ºã€‚\nå¸¸ç”¨æ¦‚ç‡åˆ†å¸ƒ è¿ç»­éšæœºå˜é‡åˆ†å¸ƒ æ­£æ€åˆ†å¸ƒï¼ˆå•å˜é‡ï¼‰ $$ y\\sim\\mathcal{N}(z, \\sigma^2)\\tag{1-1} $$ $$ p(y\\mid z) = \\frac{1}{\\sqrt{ 2\\pi \\sigma^2 }}\\exp\\Big[ -\\frac{(y-z)^2}{2\\sigma^2}\\Big]\\tag{1-2} $$ å•å˜é‡æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°æ›²çº¿å¦‚å›¾æ‰€ç¤ºï¼š\nä¸Šè¿°æ¡ä»¶æ¦‚ç‡ç»è¿‡$ \\log $åŒ–å–è´Ÿä¹‹ååŒ–ç®€å…¶å¯¹åº”çš„æŸå¤±å‡½æ•°\n$$ \\begin{align} \\arg\\min -\\log p(y\\mid z) \u0026= \\arg\\min \\Big[\\frac{1}{2}\\log [ 2\\pi \\sigma^2] + \\frac{(y - z)^2}{2\\sigma^2}\\Big] \\\\ \u0026= \\arg\\min [(y - z)^2] \\quad (\\sigma\\: is \\: constant) \\end{align}\\tag{1-3} $$ æ­£æ€åˆ†å¸ƒï¼ˆå¤šå˜é‡ï¼‰ $$ \\mathbf{y}\\sim \\mathcal{N}(\\mathbf{z}, \\Sigma)\\tag{2-1} $$ $$ p(\\mathbf{y}\\mid \\mathbf{z}) = \\frac{1}{(2\\pi)^{K/2}|\\Sigma|^{1/2}}\\exp\\Big[ -\\frac{(\\mathbf{y}-\\mathbf{z})^{\\mathrm{T}}\\Sigma^{-1}(\\mathbf{y}-\\mathbf{z})}{2}\\Big]\\tag{2-2} $$ äºŒç»´æ­£æ€åˆ†å¸ƒæ¦‚ç‡å¯†åº¦ç­‰é«˜çº¿å¦‚å›¾æ‰€ç¤º\nåŒç†ï¼Œä¸Šè¿°æ¡ä»¶æ¦‚ç‡ç»è¿‡$ \\log $åŒ–å–è´Ÿä¹‹ååŒ–ç®€å¾—åˆ°å…¶å¯¹åº”çš„æŸå¤±å‡½æ•°\n$$ \\begin{align} \\arg\\min -\\log p(\\mathbf{y}\\mid \\mathbf{z}) \u0026= \\arg\\min \\left[\\frac{K}{2}\\log[2\\pi] + \\frac{1}{2}\\log |\\Sigma| + \\frac{1}{2}(\\mathbf{y} - \\mathbf{z})^\\mathrm{T}\\Sigma^{-1}(\\mathbf{y} - \\mathbf{z})\\right] \\\\ \u0026= \\arg\\min \\left[\\frac{K}{2}\\log[2\\pi \\sigma^2] + \\frac{1}{2\\sigma^2}\\lvert \\lvert \\mathbf{y} - \\mathbf{z} \\rvert \\rvert^2 \\right]\\quad (\\Sigma = \\sigma^2\\mathbf{I}) \\\\ \u0026= \\arg\\min \\left[\\lvert \\lvert \\mathbf{y} - \\mathbf{z} \\rvert \\rvert^2 \\right]\\quad (\\sigma\\:is\\: constant) \\end{align}\\tag{2-3} $$ æ··åˆé«˜æ–¯åˆ†å¸ƒ $$ y\\sim \\mathrm{GMM}(\\mathbf{z},\\boldsymbol{\\sigma}^2)\\quad\\mathbf{z}=[z_{1}, \\dots, z_{K}]^{\\mathrm{T}}\\tag{3-1} $$ $$ p(y\\mid\\mathbf{z}) = \\sum_{k=1}^{K}\\pi_{k}\\mathcal{N}(y\\mid z_{k}, \\sigma_{k}^2)\\tag{3-2} $$ ä¸Šè¿°å…¬å¼ä¸­$ \\pi_{k} $æ˜¯ç¬¬$ k $ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æƒé‡ï¼Œæ»¡è¶³$ \\sum_{k=1}^{K}\\pi_{k}=1 $ï¼Œ$ \\mathcal{N}(y\\mid z_{k}, \\sigma_{k}^2) $æ˜¯ç¬¬$ k $ä¸ªé«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦ã€‚\næ··åˆé«˜æ–¯åˆ†å¸ƒçš„æ¦‚ç‡åˆ†å¸ƒå¯†åº¦å¦‚å›¾æ‰€ç¤ºã€‚\nä¸Šè¿°æ¡ä»¶æ¦‚ç‡ç»è¿‡$ \\log $åŒ–ä¹‹åå–è´Ÿå¾—åˆ°çš„æŸå¤±å‡½æ•°ä¸º\n$$ \\begin{align} \\arg\\min -\\log p(y\\mid \\mathbf{z}) \u0026= \\arg\\min -\\log \\left[\\sum_{k=1}^K\\pi_{k}\\frac{1}{\\sqrt{ 2\\pi \\sigma_{k}^2 }}\\exp\\left[-\\frac{(y - z_{k})^2}{2\\sigma_{k}^2}\\right]\\right]\\quad \\mathrm{log\\text{-}sum\\text{-}exp\\:construct} \\\\ \u0026= \\arg\\min -\\log \\sum_{k=1}^K\\exp[a_{k}]\\quad \\left( a_{k} = \\log \\pi_{k} - \\frac{1}{2}\\log[2\\pi \\sigma_{k}^2] - \\frac{(y - z_{k})^2}{2\\sigma_{k^2}} \\right) \\\\ \u0026= \\arg\\min -m -\\log \\sum_{k=1}^K\\exp[a_{k} - m]\\quad \\left(m = \\max_k a_{k}\\right) \\end{align}\\tag{3-3} $$ $ \\mathrm{Laplace} $åˆ†å¸ƒ $$ y\\sim \\mathrm{Laplace}(z, b)\\tag{4-1} $$ $$ p(y\\mid z) = \\frac{1}{2b}\\exp\\Big[ -\\frac{|y - z|}{b}\\Big]\\tag{4-2} $$ $ \\mathrm{Laplace} $åˆ†å¸ƒæ¦‚ç‡å¯†åº¦åˆ†åº¦å¦‚å›¾æ‰€ç¤ºï¼Œ$ \\mu $æ˜¯ä½ç½®å‚æ•°æ§åˆ¶åˆ†å¸ƒä¸­å¿ƒï¼Œ$ b $æ˜¯å°ºåº¦å‚æ•°æ§åˆ¶åˆ†å¸ƒçš„å®½åº¦ã€‚\nä¸Šè¿°æ¡ä»¶æ¦‚ç‡åˆ†å¸ƒç»è¿‡$ \\log $åŒ–ä¹‹åå–è´Ÿå¯¹æ•°å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º\n$$ \\begin{align} \\arg\\min -\\log p(y\\mid z) \u0026= \\arg\\min\\log(2b) + \\frac{\\lvert y - z \\rvert}{b} \\end{align}\\tag{4-3} $$ $ \\mathrm{t}åˆ†å¸ƒ $ $$ y\\sim \\mathrm{t}(\\nu, \\mathbf{z})\\quad \\mathbf{z}=[z_{1}, z_{2}]^{\\mathrm{T}}\\tag{5-1} $$ $$ p(y \\mid \\mathbf{z}) = \\frac{\\Gamma\\left(\\frac{\\nu+1}{2}\\right)}{\\sqrt{\\nu \\pi}\\, \\sigma \\, \\Gamma\\left(\\frac{\\nu}{2}\\right)} \\left[ 1 + \\frac{1}{\\nu} \\left(\\frac{y-z_{1}}{\\exp[z_{2}]}\\right)^2 \\right]^{-\\frac{\\nu+1}{2}}\\tag{5-2} $$ $ \\mathrm{t} $åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å¦‚å›¾æ‰€ç¤ºï¼Œå…¶ä¸­$ \\mu $ä¾æ—§è¡¨ç¤ºä½ç½®å‚æ•°ï¼Œ$ \\sigma\u0026gt;0 $è¡¨ç¤ºå°ºåº¦å‚æ•°ï¼Œ$ \\nu\u0026gt;0 $è¡¨ç¤ºè‡ªç”±åº¦\n`$ \\mathrm{t} $`åˆ†å¸ƒå’Œæ­£æ€åˆ†å¸ƒï¼ˆå•å˜é‡ï¼‰çš„æ¦‚ç‡å¯†åº¦å‡½æ•°åœ¨ä¸åŒè‡ªç”±åº¦å¯¹æ¯”å¦‚ä¸‹ ä¸Šè¿°æ¡ä»¶åˆ†å¸ƒ`$ \\log $`åŒ–ä¹‹åå–è´Ÿå€¼å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º $$ \\begin{align} \\arg\\min -\\log p(y\\mid \\mathbf{z}) \u0026= \\arg\\min z_{2} + \\frac{\\nu + 1}{2}\\log \\left(1 + \\frac{1}{\\nu}\\frac{\\left(y - z_{1}\\right)^2}{\\exp[2z_{2}]}\\right) + C \\quad \\left(C = -\\log\\Gamma\\left(\\tfrac{\\nu+1}{2}\\right)+\\log\\Gamma\\left(\\tfrac{\\nu}{2}\\right)+\\frac{1}{2}\\log(\\nu\\pi)\\right) \\\\ \u0026= \\arg\\min z_{2} + \\frac{\\nu + 1}{2}\\log \\left(1 + \\frac{1}{\\nu}\\frac{\\left(y - z_{1}\\right)^2}{\\exp[2z_{2}]}\\right) \\end{align}\\tag{5-3} $$ æŒ‡æ•°åˆ†å¸ƒ $$ y\\sim \\mathrm{Exponential}\\left( \\frac{1}{\\exp[z]} \\right) \\tag{6-1} $$ $$ p(y\\mid z) = \\begin{cases} \\frac{1}{\\exp[z]} \\exp\\left[ -\\frac{y}{\\exp[z]} \\right], \u0026 y \\geq 0 \\\\ 0, \u0026 y \u003c 0 \\end{cases}\\tag{6-2} $$ æŒ‡æ•°åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å¦‚å›¾æ‰€ç¤º\nä¸Šè¿°æ¡ä»¶åˆ†å¸ƒ`$ \\log $`åŒ–ä¹‹åå–è´Ÿå€¼å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º $$ \\begin{align} \\arg\\min -\\log p(y\\mid z) \u0026= \\arg\\min z + y\\exp[-z] \\quad (y \\geq 0) \\end{align}\\tag{6-3} $$ $ \\mathrm{gamma}åˆ†å¸ƒ $ $$ y\\sim \\mathrm{Gamma}(\\mathbf{z})\\quad \\mathbf{z}=[z_{1}, z_{2}]^{\\mathrm{T}}\\tag{7-1} $$ $$ p(y\\mid \\mathbf{z}) = \\begin{cases} \\frac{1}{\\Gamma(\\exp(z_{1}))\\exp[z_{2}]^{\\exp[z_{1}]}}y^{\\exp[z_{1}] - 1}\\exp\\left[ -\\frac{y}{\\exp[z_{2}]} \\right]\u0026y \\geq 0\\\\ 0, \u0026y \u003c 0 \\end{cases} $$ $ \\mathrm{gamma} $åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å¦‚å›¾æ‰€ç¤ºï¼Œå…¶ä¸­$ k\u0026gt;0 $è¡¨ç¤ºå½¢çŠ¶å‚æ•°ï¼Œ$ \\theta\u0026gt;0 $è¡¨ç¤ºå°ºåº¦å‚æ•°ã€‚\nä¸Šè¿°æ¡ä»¶åˆ†å¸ƒ`$ \\log $`åŒ–ä¹‹åå–è´Ÿå€¼å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º $$ \\begin{align} \\arg\\min -\\log p(y\\mid \\mathbf{z}) \u0026= \\arg\\min \\log \\Gamma(\\exp[z_{1}]) + \\exp[z_{1}]z_{2} - (\\exp[z_{1}] - 1)\\log y + y\\exp[-z_{2}] \\quad (y \\geq 0) \\end{align}\\tag{7-3} $$ $ \\mathrm{beta}åˆ†å¸ƒ $ $$ y\\sim \\mathrm{Beta}(\\mathbf{z})\\quad \\mathbf{z}=[z_{1}, z_{2}]^{\\mathrm{T}}\\tag{8-1} $$ $$ p(y\\mid \\mathbf{z}) = \\frac{1}{\\mathrm{B}(\\exp[z_{1}], \\exp[z_{2}])}y^{\\exp[z_{1}] - 1}(1-y)^{\\exp[z_{2}] - 1}\\tag{8-2} $$ $ \\mathrm{beta} $åˆ†å¸ƒçš„æ¦‚ç‡å¯†åº¦å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­$ \\alpha\u0026gt;0, \\beta\u0026gt;0 $éƒ½è¡¨ç¤ºå½¢çŠ¶å‚æ•°\nä¸Šè¿°æ¡ä»¶åˆ†å¸ƒ$ \\log $åŒ–ä¹‹åå–è´Ÿå€¼å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º\n$$ \\begin{aligned} \\arg\\min -\\log p(y\\mid \\mathbf{z}) \u0026= \\arg\\min\\underbrace{\\log \\Gamma(\\exp[z_{1}]) + \\log \\Gamma(\\exp[z_{2}]) - \\log \\Gamma(\\exp[z_{1}] + \\exp[z_{2}])}_{\\log \\mathrm{B(\\exp[z_{1}], \\exp[z_{2}])}} - (\\exp[z_{1}] - 1)\\log y - (\\exp[z_{2}] - 1)\\log(1 - y) \\\\ \u0026= \\arg\\min\\log \\mathrm{B}(\\exp[z_{1}], \\exp[z_{2}]) - (\\exp[z_{1}] - 1)\\log y - (\\exp[z_{2}] - 1)\\log(1 - y) \\quad (y \\geq 0) \\end{aligned}\\tag{8-3} $$ ç¦»æ•£éšæœºå˜é‡åˆ†å¸ƒ $ \\mathrm{Possion} $åˆ†å¸ƒ $$ y\\sim \\mathrm{Possion}(\\exp[z])\\tag{9-1} $$ $$ p(y|z) = \\frac{\\exp[z]^{y}\\exp[-\\exp[z]]}{y!}\\tag{9-2} $$ ä¸Šè¿°æ¡ä»¶åˆ†å¸ƒ$ \\log $åŒ–ä¹‹åå–è´Ÿå€¼å¾—åˆ°å¯¹åº”çš„æŸå¤±å‡½æ•°ä¸º\n$$ \\begin{align} \\arg\\min -\\log p(y\\mid z) \u0026= \\arg\\min\\exp[z] - z\\exp[z] + C \\quad (C = \\log[y!])\\\\ \u0026= \\arg\\min\\exp[z] - z\\exp[z] \\end{align}\\tag{9-3} $$ $ \\mathrm{Bernoulli} $åˆ†å¸ƒ $$ y\\sim \\mathrm{Bernoulli}(\\mathrm{sigmoid}(z))\\tag{10-1} $$ $$ p(y\\mid z) = \\mathrm{sigmoid}(z)^{y}(1 - \\mathrm{sigmoid}(z))^{1-y}\\tag{10-2} $$ åˆ†ç±»åˆ†å¸ƒ $$ p(y\\mid\\mathbf{z})=\\mathrm{softmax}_{y}(\\mathbf{z})=\\frac{\\exp[z_{y}]}{\\sum_{y'=1}^{K}\\exp[z_{y'}]}\\tag{11-1} $$ ä¸åŒæ¦‚ç‡ä¹‹é—´çš„è·ç¦» $ \\mathrm{Kullback-Leibler} $æ•£åº¦ï¼ˆ$ \\mathrm{KL} $æ•£åº¦ï¼‰ $ \\mathrm{KL} $æ•£åº¦æ˜¯ä¸€ç§è¡¡é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒå·®å¼‚çš„æŒ‡æ ‡ã€‚æ¦‚ç‡åˆ†å¸ƒ$ p(y) $å’Œæ¦‚ç‡åˆ†å¸ƒ$ q(y) $ä¹‹é—´çš„è·ç¦»å¯ä»¥ç”¨$ \\mathrm{KL} $æ•£åº¦æ¥è¿›è¡Œè¯„ä¼°\n$$ \\mathrm{D}_{\\mathrm{KL}}[p(y)||q(y))] = \\int_{-\\infty}^{\\infty}p(y)\\log[p(y)]dy - \\int_{-\\infty}^{\\infty}p(y)\\log[q(y)]dy $$ ä¸¤ä¸ªå¤šç»´æ­£æ€åˆ†å¸ƒä¹‹é—´çš„$ \\mathrm{KL} $æ•£åº¦ï¼Œå…¶ä¸­$ D $è¡¨ç¤ºå¤šç»´æ­£æ€åˆ†å¸ƒçš„ç»´åº¦æ•°é‡\n$$ \\mathrm{D}_{\\mathrm{KL}}[\\mathcal{N}(\\boldsymbol{\\mu}_{1}, \\boldsymbol{\\Sigma}_{1})||\\mathcal{N}(\\boldsymbol{\\mu}_{2}, \\boldsymbol{\\Sigma}_{2})] = \\frac{1}{2}\\left( \\log\\left[ \\frac{|\\boldsymbol{\\Sigma}_{2}|}{|\\boldsymbol{\\Sigma}_{1}|}\\right] - D + \\mathrm{tr}[\\boldsymbol{\\Sigma}_{2}^{-1}\\boldsymbol{\\Sigma}_{1}] + (\\boldsymbol{\\mu}_{2} - \\boldsymbol{\\mu}_{1})^{\\mathrm{T}}\\boldsymbol{\\Sigma}_{2}^{-1}(\\boldsymbol{\\mu}_{2} - \\boldsymbol{\\mu}_{1})\\right) $$ $ \\mathrm{Jensen-Shannon} $æ•£åº¦ï¼ˆ$ \\mathrm{JS} $æ•£åº¦ï¼‰ $ \\mathrm{KL} $æ•£åº¦æ˜¯åå¯¹ç§°çš„($ \\mathrm{D}_{\\mathrm{KL}}[p(y)||q(y)]\\neq \\mathrm{D}_{\\mathrm{KL}}[q(y)||p(y)] $)ï¼Œä½†æ˜¯è·ç¦»é€šå¸¸æ˜¯å¯¹ç§°çš„ï¼Œå› æ­¤é€šè¿‡$ \\mathrm{KL} $æ•£åº¦æ¥æ„é€ ä¸€ä¸ªå¯¹ç§°åŒ–çš„è·ç¦»åº¦é‡$ \\mathrm{JS} $æ•£åº¦\n$$ \\mathrm{D}_{\\mathrm{JS}}[p(y)||q(y)] = \\frac{1}{2}\\mathrm{D}_{\\mathrm{KL}}\\left[ p(y)||\\frac{p(y) + q(y)}{2} \\right] + \\frac{1}{2}\\mathrm{D}_{\\mathrm{KL}}\\left[ q(y)||\\frac{p(y) + q(y)}{2} \\right] $$ å®ƒçš„ç‰©ç†æ„ä¹‰æ˜¯$ p(y) $å’Œ$ q(y) $å¯¹ä¸¤ä¸ªåˆ†å¸ƒå¹³å‡å€¼çš„å¹³å‡æ•£åº¦ã€‚\n$ \\mathrm{FrÃ©chet} $ è·ç¦» ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒ$ p(y) $å’Œ$ q(y) $çš„$ \\mathrm{FrÃ©chet} $ è·ç¦»çš„æ•°å­¦å½¢å¼å¦‚ä¸‹æ‰€ç¤º\n$$ \\mathrm{D}_{\\mathrm{Fr}}[p(x)||q(y)] = \\sqrt{ \\min_{\\pi(x,y)}\\left[\\int \\int \\pi(x, y)|x - y|^2dxdy \\right] } $$ å…¶ä¸­$ \\pi(x, y) $è¡¨ç¤ºè¾¹ç¼˜åˆ†å¸ƒ$ p(x) $å’Œ$ q(y) $ç›¸å®¹çš„è”åˆåˆ†å¸ƒé›†åˆã€‚$ \\mathrm{FrÃ©chet} $ è·ç¦»ä¹Ÿå¯ä»¥è¢«è¡¨è¿°ä¸ºç´¯ç§¯åˆ†å¸ƒæ›²çº¿ä¹‹é—´çš„æœ€å¤§è·ç¦»çš„åº¦é‡ã€‚\nä¸¤ä¸ªå¤šç»´æ­£æ€åˆ†å¸ƒä¹‹é—´çš„$ \\mathrm{FrÃ©chet} $ è·ç¦»\n$$ \\mathrm{D}_{\\mathrm{Fr}/W_{2}}[\\mathcal{N}(\\boldsymbol{\\mu}_{1}, \\boldsymbol{\\Sigma}_{1})||\\mathcal{N}(\\boldsymbol{\\mu}_{2}, \\boldsymbol{\\Sigma}_{2})] = |\\boldsymbol{\\mu}_{1} - \\boldsymbol{\\mu}_{2}|^2 + \\mathrm{tr}[\\boldsymbol{\\Sigma}_{1} + \\boldsymbol{\\Sigma}_{2} - 2(\\boldsymbol{\\Sigma}_{2}\\boldsymbol{\\Sigma}_{1})^{1/2}] $$ ","permalink":"https://fordelkon.github.io/teaching/probdis/","summary":"\u003cp\u003eåœ¨æ·±åº¦å­¦ä¹ ä¸­æˆ‘ä»¬é€šå¸¸ä½¿ç”¨å…·æœ‰è‰¯å¥½æ•°å­¦æ€§è´¨çš„æ¦‚ç‡åˆ†å¸ƒå¯¹å·²æœ‰æ•°æ®åˆ†å¸ƒè¿›è¡Œå»ºæ¨¡ï¼Œä»¥ä¾¿å¾—åˆ°ä¼˜ç¾çš„æŸå¤±å‡½æ•°å½¢å¼æ–¹ä¾¿æ¨¡å‹è¿›è¡Œåå‘ä¼ æ’­ï¼ŒåŒæ—¶èµ‹äºˆæ¨¡å‹å®é™…çš„æ¦‚ç‡å«ä¹‰ã€‚åœ¨è¯¥ç« èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»æ·±åº¦å­¦ä¹ ä¸­å¸¸ç”¨çš„æ¦‚ç‡åˆ†å¸ƒä»¥åŠä¸åŒæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»åº¦é‡æ–¹æ³•ã€‚å‡è®¾æˆ‘ä»¬å·²æœ‰æ•°æ®é›†\u003ccode\u003e$ \\mathcal{D}=\\lbrace(\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N} $\u003c/code\u003eæˆ–\u003ccode\u003e$ \\mathcal{D}=\\lbrace\\mathbf{x}_{i}\\rbrace_{i=1}^{N} $\u003c/code\u003eï¼Œä¸»è¦åŒºåˆ†äºæœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æƒ…å†µï¼Œ\u003ccode\u003e$ z $\u003c/code\u003eæˆ–\u003ccode\u003e$ \\mathbf{z}$ \u003c/code\u003eä¸»è¦è¡¨ç¤ºæ·±åº¦å­¦ä¹ æ¨¡å‹æœªç»å¤„ç†çš„è¾“å‡ºã€‚\u003c/p\u003e","title":"æ·±åº¦å­¦ä¹ ä¸­å¸¸ç”¨çš„æ¦‚ç‡åˆ†å¸ƒæ€»ç»“"},{"content":"ä¸Šé¢æˆ‘ä»¬å®ç°äº†CMakeçš„ä¸€å¥—ç®€è¦æ­å»ºæµç¨‹ï¼ŒåŸºæœ¬ä¸Šç®€å•çš„ç¼–è¯‘é…ç½®å°±é ä¸Šé¢çš„å‡ ä¸ªCMakeå‘½ä»¤å°±å¯ä»¥å®Œæˆäº†ã€‚ä½†ä¸€äº›å¤§å‹é¡¹ç›®çš„cmakeçš„é…ç½®å…‰é ä¸Šé¢çš„å‡ ä¸ªCMakeå‘½ä»¤æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œç®€å•æ¥è¯´å¦‚ä½•å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œå—¯è¿™å°±å±äºCMakeè¿›é˜¶çš„å†…å®¹äº†\u0026hellip;\nCMakeLists.txtè¯­æ³• æœ¬åœ°å˜é‡ã€ç¼“å­˜å˜é‡ã€ç¯å¢ƒå˜é‡ï¼ˆå˜é‡ï¼‰ å˜é‡é€šå¸¸é€šè¿‡set()æ¥è¿›è¡Œå£°æ˜ï¼Œset()å‘½ä»¤è¯­æ³•å¦‚ä¸‹ï¼š\n# å£°æ˜æœ¬åœ°å˜é‡ set(\u0026lt;variable\u0026gt; \u0026lt;values\u0026gt;) å‚æ•°ï¼š \u0026lt;variable\u0026gt; ï¼šè¦è®¾ç½®çš„æœ¬åœ°å˜é‡åç§°ã€‚ \u0026lt;values\u0026gt; ï¼šå˜é‡çš„å€¼ï¼ˆå•ä¸ªæˆ–å¤šä¸ªï¼‰ï¼Œå¤šä¸ªå€¼æ—¶å®ƒä»¬ä½¿ç”¨`;`æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ # å£°æ˜ç¼“å­˜å˜é‡ set(\u0026lt;variable\u0026gt; \u0026lt;value\u0026gt; CACHE \u0026lt;STRING|BOOL|PATH|FILEPATH\u0026gt; \u0026lt;description\u0026gt;) å‚æ•°ï¼š \u0026lt;variable\u0026gt; ï¼šè¦è®¾ç½®çš„ç¼“å­˜å˜é‡åç§°ã€‚ \u0026lt;value\u0026gt; ï¼šç¼“å­˜å˜é‡çš„å€¼ï¼ˆå€¼çš„å…·ä½“å«ä¹‰ç”±åè¾¹çš„é€‰æ‹©å‚æ•°å†³å®šï¼‰ã€‚ \u0026lt;STRING|BOOL|PATH|FILEPATH\u0026gt; ï¼š - STRING ï¼šæ™®é€šå­—ç¬¦ä¸²å˜é‡ã€‚ - BOOL ï¼šå¸ƒå°”ç±»å‹å˜é‡ï¼Œå–å€¼å¯ä»¥æ˜¯ ONã€OFFã€‚ - PATH ï¼šè·¯å¾„å˜é‡ï¼Œç”¨äºå­˜å‚¨ç›®å½•è·¯å¾„ã€‚ - FILEPATH ï¼šæ–‡ä»¶è·¯å¾„å˜é‡ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ \u0026lt;description\u0026gt; ï¼šè¯¥ç¼“å­˜å˜é‡çš„å­—ç¬¦ä¸²æè¿°ã€‚ # å£°æ˜ç¯å¢ƒå˜é‡ set(ENV{variable} value) # æœ€å¥½ä¸è¦ä¹±è®¾ç½® è¯¥æµ‹è¯•å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/advanced_process/cmake_varã€‚æµ‹è¯•çš„CMakeLists.txtå†…å®¹å¦‚ä¸‹ï¼š\n# æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # è®¾ç½®é¡¹ç›®åç§° project(CMAKE_VARIABLES) # æœ¬åœ°å˜é‡ set(LOCAL_VAR \u0026#34;value\u0026#34;) set(LOCAL_LIST \u0026#34;value1\u0026#34; \u0026#34;value2\u0026#34;) message(\u0026#34;LOCAL_VAR is ${LOCAL_VAR}, LOCAL_LIST is ${LOCAL_LIST}\u0026#34;) # ç¼“å­˜å˜é‡ set(CACHE_VAR_BOOL ON CACHE BOOL \u0026#34;this is a bool cache variable\u0026#34;) set(CACHE_VAR_STRING \u0026#34;cache value\u0026#34; CACHE STRING \u0026#34;this is a string variable\u0026#34;) message(\u0026#34;CACHE_VAR_BOOL is ${CACHE_VAR_BOOL}, CACHE_VAR_STRING is ${CACHE_VAR_STRING}\u0026#34;) # ç¯å¢ƒå˜é‡ message(\u0026#34;My PC shell is $ENV{SHELL}\u0026#34;) åœ¨CMakeLists.txtæ‰€åœ¨çš„ç›®å½•ä¸‹è¿è¡Œcmake -B buildå¾—åˆ°\n-- The C compiler identification is AppleClang 16.0.0.16000026 -- The CXX compiler identification is AppleClang 16.0.0.16000026 -- Detecting C compiler ABI info -- Detecting C compiler ABI info - done -- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc - skipped -- Detecting C compile features -- Detecting C compile features - done -- Detecting CXX compiler ABI info -- Detecting CXX compiler ABI info - done -- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++ - skipped -- Detecting CXX compile features -- Detecting CXX compile features - done LOCAL_VAR is value, LOCAL_LIST is value1;value2 CACHE_VAR_BOOL is ON, CACHE_VAR_STRING is cache value My PC shell is /bin/zsh -- Configuring done (0.4s) -- Generating done (0.0s) -- Build files have been written to: /Users/delkon/Desktop/UniversityWork/Year4/CMake_Art/advanced_process/cmake_var/build ä¿®æ”¹LOCAL_VARä¸ºchanges valueï¼ŒCACHE_VAR_BOOLä¸ºOFFï¼Œå†æ¬¡è¿è¡Œcmake -B buildå¾—åˆ°\nLOCAL_VAR is changes value, LOCAL_LIST is value1;value2 CACHE_VAR_BOOL is ON, CACHE_VAR_STRING is cache value My PC shell is /bin/zsh -- Configuring done (0.0s) -- Generating done (0.0s) -- Build files have been written to: /Users/delkon/Desktop/UniversityWork/Year4/CMake_Art/advanced_process/cmake_var/build å¯ä»¥çœ‹åˆ°LOCAL_VARè¢«æ”¹å˜äº†ï¼Œä½†æ˜¯CACHE_VAR_BOOLç”±äºåœ¨./build/CMakeCache.txtè¢«ç¼“å­˜æ‰€ä»¥æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚\nCMakeè¿è¡Œå…¶ä»–çš„ç¨‹åº find_package() find_package()æ˜¯ CMake ä¸­ç”¨äºæŸ¥æ‰¾å¤–éƒ¨åº“æˆ–åŒ…çš„å‘½ä»¤ï¼Œæœ‰ä¸¤ç§æŸ¥æ‰¾å¤–éƒ¨åº“æˆ–åŒ…çš„æ¨¡å¼ï¼š\nConfig æ¨¡å¼ï¼šé€šè¿‡åŒ…è‡ªå¸¦çš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ \u0026lt;package_name\u0026gt;Config.cmake æˆ– \u0026lt;package_name\u0026gt;-config.cmakeï¼‰æŸ¥æ‰¾åº“ã€‚ç°ä»£ CMake é¡¹ç›®é€šå¸¸æä¾›è¿™äº›é…ç½®æ–‡ä»¶ã€‚ Module æ¨¡å¼ï¼šé€šè¿‡ CMake è‡ªå¸¦çš„æŸ¥æ‰¾æ¨¡å—ï¼ˆå¦‚ Find\u0026lt;package_name\u0026gt;.cmakeï¼‰æ¥æŸ¥æ‰¾åº“ã€‚æ—©æœŸçš„ CMake ä½¿ç”¨è¿™ç§æ–¹å¼æŸ¥æ‰¾åº“ã€‚ find_package(\u0026lt;package_name\u0026gt; [version] [REQUIRED] [QUIET] [COMPONENTS components] [OPTIONAL_COMPONENTS components]) å‚æ•°ï¼š \u0026lt;package_name\u0026gt; ï¼šè¦æŸ¥æ‰¾åŒ…çš„åç§°ã€‚ [version] ï¼šæŒ‡å®šåŒ…çš„æœ€ä½ç‰ˆæœ¬å·ï¼ˆå¯é€‰ï¼‰ã€‚å¦‚æœä¸æŒ‡å®šç‰ˆæœ¬å·ï¼Œå°†æŸ¥æ‰¾ä»»æ„ç‰ˆæœ¬çš„åŒ…ã€‚ [REQUIRED] ï¼šå¦‚æœåŒ…æœªæ‰¾åˆ°ï¼Œåˆ™ç«‹å³åœæ­¢å¹¶ç»™å‡ºé”™è¯¯ã€‚å¦‚æœä¸åŠ  REQUIREDï¼Œåˆ™ä¼šç»§ç»­æ‰§è¡Œè„šæœ¬ï¼Œå³ä½¿æ‰¾ä¸åˆ°è¯¥åŒ…ã€‚ [QUIET] ï¼šæŠ‘åˆ¶è¾“å‡ºï¼Œå³ä½¿æ‰¾ä¸åˆ°åŒ…ä¹Ÿä¸æ˜¾ç¤ºæ¶ˆæ¯ã€‚ [COMPONENTS components] ï¼šæŒ‡å®šåŒ…çš„ç‰¹å®šç»„ä»¶ï¼Œåªæœ‰è¿™äº›ç»„ä»¶ä¼šè¢«æŸ¥æ‰¾ã€‚ç”¨äºåŒ…å«å¤šä¸ªæ¨¡å—çš„åŒ…ã€‚ [OPTIONAL_COMPONENTS components] ï¼šæŒ‡å®šä¸€äº›å¯é€‰çš„ç»„ä»¶ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™äº›ç»„ä»¶ï¼Œä¸ä¼šå½±å“ä¸»è¦æ„å»ºè¿‡ç¨‹ã€‚ -------------------------------------------------------------------------------- æŸ¥æ‰¾ç»“æœï¼š - \u0026lt;package_name\u0026gt;_FOUNDï¼šæ˜¯å¦æ‰¾åˆ°åŒ…ã€‚ - \u0026lt;package_name\u0026gt;_INCLUDE_DIRSï¼šåŒ…çš„å¤´æ–‡ä»¶è·¯å¾„ã€‚ - \u0026lt;package_name\u0026gt;_LIBRARIESï¼šåŒ…çš„åº“æ–‡ä»¶è·¯å¾„ã€‚ - \u0026lt;package_name\u0026gt;_VERSIONï¼šæ‰¾åˆ°çš„åŒ…çš„ç‰ˆæœ¬å·ã€‚ - \u0026lt;package_name\u0026gt;_EXECUTABLE ï¼šå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ã€‚ æœ‰æ—¶è‡ªå·±çš„ç¬”è®°æœ¬ä¸Šæœ‰å¥½å‡ ä¸ªå‘½åç›¸åŒä½†ç‰ˆæœ¬ä¸åŒçš„åŒ…ï¼Œfind_package()æ‰¾åˆ°çš„åŒ…å’Œè‡ªå·±é¢„æœŸçš„è·¯å¾„ä¸å¤ªä¸€æ ·ï¼Œè¿™æ˜¯æˆ‘ä»¬å¯ä»¥æ˜¾å¼åœ°æŒ‡å®š\u0026lt;package_name\u0026gt;_EXECUTABLEå†…å®¹ï¼Œè¿™æ ·å°±å¯ä»¥ç´¢å¼•åˆ°æˆ‘ä»¬æƒ³è¦çš„åŒ…å•¦ã€‚\nè¯¥æµ‹è¯•å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/advanced_process/third_packageã€‚ç›¸å…³çš„æµ‹è¯•CMakeLists.txtæ–‡ä»¶å¦‚ä¸‹ï¼š\n# æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # è®¾ç½®é¡¹ç›®åç§° project(THIRD_PACKAGE) set(FLAG OFF) # or ON if(FLAG) find_package(Python REQUIRED COMPONENTS Interpreter Development) if(Python_FOUND) message(\u0026#34;Package include directory is ${Python_INCLUDE_DIRS}\u0026#34;) message(\u0026#34;Package library is ${Python_LIBRARIES}\u0026#34;) message(\u0026#34;Package version is ${Python_VERSION}\u0026#34;) message(\u0026#34;Package executable file path is ${Python_EXECUTABLE}\u0026#34;) endif() else() set(Python_EXECUTABLE \u0026#34;$ENV{CONDA_PYTHON_EXE}\u0026#34;) find_package(Python REQUIRED COMPONENTS Interpreter Development) if(Python_FOUND) message(\u0026#34;Package include directory is ${Python_INCLUDE_DIRS}\u0026#34;) message(\u0026#34;Package library is ${Python_LIBRARIES}\u0026#34;) message(\u0026#34;Package version is ${Python_VERSION}\u0026#34;) message(\u0026#34;Package executable file path is ${Python_EXECUTABLE}\u0026#34;) endif() endif() å½“FLAGä¸ºONæ—¶ï¼Œå¾—åˆ°\n....................................å‰é¢çœç•¥...................................... -- Found Python: /opt/homebrew/Frameworks/Python.framework/Versions/3.13/bin/python3.13 (found version \u0026#34;3.13.0\u0026#34;) found components: Interpreter Development Development.Module Development.Embed Package include directory is /opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/include/python3.13 Package library is /opt/homebrew/opt/python@3.13/Frameworks/Python.framework/Versions/3.13/lib/libpython3.13.dylib Package version is 3.13.0 Package executable file path is /opt/homebrew/Frameworks/Python.framework/Versions/3.13/bin/python3.13 ....................................åé¢çœç•¥...................................... è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„åŒ…çš„è·¯å¾„ï¼Œé€šè¿‡è®¾å®šFLAGä¸ºOFFï¼Œæ˜¾å¼åœ°æŒ‡å®š\u0026lt;package_name\u0026gt;_EXECUTABLEä¸ºæˆ‘ä»¬æ‰€è¦çš„åŒ…çš„å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å®¹ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n....................................å‰é¢çœç•¥...................................... -- Found Python: /Users/delkon/miniconda3/bin/python (found version \u0026#34;3.10.13\u0026#34;) found components: Interpreter Development Development.Module Development.Embed Package include directory is /Users/delkon/miniconda3/include/python3.10 Package library is /Users/delkon/miniconda3/lib/libpython3.10.dylib Package version is 3.10.13 Package executable file path is /Users/delkon/miniconda3/bin/python ....................................åé¢çœç•¥...................................... è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®çš„ã€‚\né…ç½®æ—¶è¿è¡Œï¼šexecute_process() execute_process( COMMAND \u0026lt;cmd\u0026gt; [args...] [WORKING_DIRECTORY \u0026lt;dir\u0026gt;] [TIMEOUT \u0026lt;seconds\u0026gt;] [RESULT_VARIABLE \u0026lt;var\u0026gt;] [OUTPUT_VARIABLE \u0026lt;var\u0026gt;] [ERROR_VARIABLE \u0026lt;var\u0026gt;] [INPUT_FILE \u0026lt;file\u0026gt;] [OUTPUT_FILE \u0026lt;file\u0026gt;] [ERROR_FILE \u0026lt;file\u0026gt;] [INPUT_FILE \u0026lt;file\u0026gt;] ) å‚æ•°ï¼š - COMMAND \u0026lt;cmd\u0026gt; [args...] ï¼šæŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚ - WORKING_DIRECTORY \u0026lt;dir\u0026gt; ï¼šè®¾ç½®å‘½ä»¤æ‰§è¡Œæ—¶çš„å·¥ä½œç›®å½•ã€‚ - TIMEOUT \u0026lt;seconds\u0026gt; ï¼šè®¾ç½®å‘½ä»¤æ‰§è¡Œçš„è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ã€‚ - RESULT_VARIABLE \u0026lt;var\u0026gt; ï¼šå‘½ä»¤æ‰§è¡Œåçš„è¿”å›å€¼ä¼šè¢«å­˜å‚¨åœ¨ \u0026lt;var\u0026gt; å˜é‡ä¸­ã€‚ - OUTPUT_VARIABLE \u0026lt;var\u0026gt; ï¼šå‘½ä»¤æ ‡å‡†è¾“å‡ºçš„å†…å®¹ä¼šè¢«å­˜å‚¨åœ¨ \u0026lt;var\u0026gt; å˜é‡ä¸­ã€‚ - ERROR_VARIABLE \u0026lt;var\u0026gt; ï¼šå‘½ä»¤æ ‡å‡†é”™è¯¯çš„å†…å®¹ä¼šè¢«å­˜å‚¨åœ¨ \u0026lt;var\u0026gt; å˜é‡ä¸­ã€‚ - INPUT_FILE \u0026lt;file\u0026gt;ï¼šå°†æ–‡ä»¶çš„å†…å®¹ä½œä¸ºè¾“å…¥ä¼ é€’ç»™å‘½ä»¤ã€‚ - OUTPUT_FILE \u0026lt;file\u0026gt;ï¼šå°†å‘½ä»¤çš„è¾“å‡ºä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ - ERROR_FILE \u0026lt;file\u0026gt;ï¼šå°†å‘½ä»¤çš„é”™è¯¯ä¿¡æ¯ä¿å­˜åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ execute_process()æ˜¯ CMake ä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œé€šå¸¸ç”¨äºåœ¨ CMake é…ç½®æœŸé—´è°ƒç”¨å¤–éƒ¨ç¨‹åºæˆ–è„šæœ¬ã€‚è¯¥æµ‹è¯•å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/advanced_process/run_cmdã€‚å…¶CMakeLists.txtæµ‹è¯•æ–‡ä»¶å¦‚ä¸‹ï¼š\n# æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # è®¾ç½®é¡¹ç›®åç§° project(THIRD_PACKAGE) execute_process( COMMAND ls WORKING_DIRECTORY ${CMAKE_SOURCE_DIR} OUTPUT_VARIABLE ls_output ) message(\u0026#34;Directory ${CMAKE_SOURCE_DIR} listing: ${ls_output}\u0026#34;) è¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n....................................å‰é¢çœç•¥...................................... Directory /Users/delkon/Desktop/UniversityWork/Year4/CMake_Art/advanced_process/run_cmd listing: CMakeLists.txt build ....................................åé¢çœç•¥...................................... æ„å»ºæ—¶è¿è¡Œadd_custom_command()ï¼ˆäº†è§£ä¸€ä¸‹ï¼Œä¸å¸¸ç”¨ï¼‰ åœ¨æ„å»ºæ—¶è¿è¡Œä¸€æ¡å‘½ä»¤æœ‰ç‚¹éš¾ã€‚ä¸»è¦æ˜¯ç›®æ ‡ç³»ç»Ÿï¼ˆtarget systemï¼‰ä½¿è¿™å˜çš„å¾ˆéš¾ï¼Œå› æ­¤è¿™æ¡å‘½ä»¤å¹¶ä¸å¸¸ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬äº†è§£è¯¥å‘½ä»¤ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚\nadd_custom_command( OUTPUT \u0026lt;out1\u0026gt; [\u0026lt;out2\u0026gt; ...] COMMAND \u0026lt;cmd\u0026gt; [args...] [MAIN_DEPENDENCY \u0026lt;main_dep\u0026gt;] [DEPENDS [\u0026lt;dep\u0026gt; ...]] [BYPRODUCTS \u0026lt;bypro1\u0026gt; [\u0026lt;bypro2\u0026gt; ...]] [IMPLICIT_DEPENDS \u0026lt;lang1\u0026gt; \u0026lt;src1\u0026gt; ...] [WORKING_DIRECTORY \u0026lt;dir\u0026gt;] [COMMENT \u0026lt;comment\u0026gt;] [VERBATIM] [APPEND] [USES_TERMINAL] ) å‚æ•°ï¼š - OUTPUT \u0026lt;out1\u0026gt; [\u0026lt;out2\u0026gt; ...] ï¼šæŒ‡å®šè‡ªå®šä¹‰å‘½ä»¤ç”Ÿæˆçš„æ–‡ä»¶æˆ–ç›®æ ‡ã€‚è¿™äº›æ–‡ä»¶å°†è¢« CMake è§†ä¸ºæ„å»ºè¿‡ç¨‹çš„è¾“å‡ºï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºå…¶ä»–ç›®æ ‡æˆ–å‘½ä»¤çš„è¾“å…¥ã€‚ - COMMAND \u0026lt;cmd\u0026gt; [args...] ï¼šæŒ‡å®šæ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒCMake å°†æ‰§è¡Œæ­¤å‘½ä»¤ã€‚ - [MAIN_DEPENDENCY \u0026lt;main_dep\u0026gt;] ï¼šå®šä¹‰è¯¥å‘½ä»¤çš„ä¸»è¦ä¾èµ–æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯è§¦å‘è‡ªå®šä¹‰å‘½ä»¤çš„æºæ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼ŒCMake å°†é‡æ–°æ‰§è¡Œå‘½ä»¤ã€‚ - [DEPENDS [\u0026lt;dep\u0026gt; ...]] ï¼šÂ åˆ—å‡ºè¯¥å‘½ä»¤ä¾èµ–çš„æ–‡ä»¶æˆ–ç›®æ ‡ã€‚å¦‚æœä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ï¼ŒCMake ä¼šé‡æ–°æ‰§è¡Œæ­¤å‘½ä»¤ã€‚å¯ä»¥ä¾èµ–äºæ–‡ä»¶ã€åº“æˆ–å…¶ä»–ç›®æ ‡ã€‚ - [BYPRODUCTS \u0026lt;bypro1\u0026gt; [\u0026lt;bypro2\u0026gt; ...]] ï¼šæŒ‡å®šè¯¥å‘½ä»¤æ‰§è¡Œåç”Ÿæˆçš„å‰¯äº§å“æ–‡ä»¶ï¼Œå¸®åŠ© CMake è·Ÿè¸ªè¿™äº›é¢å¤–äº§ç”Ÿçš„æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åœ¨å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ›å»ºï¼Œä½†ä¸ä¼šä½œä¸ºä¸»è¦è¾“å‡ºã€‚ - [IMPLICIT_DEPENDS \u0026lt;lang1\u0026gt; \u0026lt;src1\u0026gt; ...] ï¼šæŒ‡å®šå‘½ä»¤çš„éšå¼ä¾èµ–å…³ç³»ï¼Œé€šå¸¸æ˜¯æºæ–‡ä»¶çš„è¯­è¨€å’Œè·¯å¾„ï¼ŒCMake å¯ä»¥è‡ªåŠ¨è¿½è¸ªè¿™äº›æ–‡ä»¶çš„ä¾èµ–å…³ç³»ã€‚ - [WORKING_DIRECTORY \u0026lt;dir\u0026gt;] ï¼šæŒ‡å®šå‘½ä»¤æ‰§è¡Œæ—¶çš„å·¥ä½œç›®å½•ã€‚å‘½ä»¤åœ¨è¿™ä¸ªç›®å½•ä¸­è¿è¡Œï¼Œé€‚ç”¨äºéœ€è¦åœ¨ç‰¹å®šç›®å½•ä¸‹æ‰§è¡Œçš„å‘½ä»¤ã€‚ - [COMMENT \u0026lt;comment\u0026gt;] ï¼šåœ¨æ„å»ºæ—¶ï¼Œæ˜¾ç¤ºåœ¨å‘½ä»¤æ‰§è¡Œä¹‹å‰çš„æ³¨é‡Šã€‚å¯ä»¥ç”¨äºæç¤ºç”¨æˆ·æ­£åœ¨æ‰§è¡Œçš„æ“ä½œã€‚ - [VERBATIM] ï¼šç¡®ä¿å‘½ä»¤çš„å‚æ•°åœ¨ç”Ÿæˆçš„æ„å»ºæ–‡ä»¶ä¸­è¢«ç²¾ç¡®ä¼ é€’ï¼Œè€Œä¸ä¼šå› ä¸ºè½¬ä¹‰å­—ç¬¦æˆ–ç‰¹æ®Šç¬¦å·å‘ç”Ÿä¸å¿…è¦çš„ä¿®æ”¹ã€‚é€šå¸¸æ¨èä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚ - [APPEND] ï¼šå°†å‘½ä»¤è¿½åŠ åˆ°å·²æœ‰çš„è‡ªå®šä¹‰å‘½ä»¤ä¸­ï¼Œè€Œä¸æ˜¯è¦†ç›–å®ƒã€‚å¤šä¸ªè‡ªå®šä¹‰å‘½ä»¤å¯ä»¥ä¾æ¬¡æ‰§è¡Œã€‚ - [USES_TERMINAL] ï¼šæŒ‡å®šå‘½ä»¤éœ€è¦åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œã€‚å¯¹äºäº¤äº’å¼å‘½ä»¤ï¼ˆä¾‹å¦‚ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼‰ï¼Œè¿™ä¸ªé€‰é¡¹å¾ˆæœ‰ç”¨ã€‚ æ§åˆ¶æµ é…ç½®æ—¶è¯„ä¼°çš„æ§åˆ¶æµï¼šif()è¯­å¥ if(variable) # å¦‚æœvariableæ˜¯`ON`, `YES`, `TRUE`, `Y`æˆ–è€…ä»»æ„éé›¶å€¼ else() # å¦‚æœvariableæ˜¯`0`, `OFF`, `NO`, `FALSE`, `N`, `IGNORE`, `NOTFOUND`, `\u0026#34;\u0026#34;`æˆ–è€…ä»¥`-NOTFOUND`ç»“å°¾ endif() # å¦‚æœvariableæ²¡æœ‰æ‰©å±•ä¸ºä¸Šè¿°ä¹‹ä¸€ï¼ŒCMake å°†æ‰©å±•å®ƒï¼Œç„¶åå†æ¬¡å°è¯•ã€‚ è¿™é‡Œå¯ä»¥è®¾ç½®ä¸€äº›å…³é”®å­—ï¼š\nåˆ†ç»„ å…³é”®å­— åŠŸèƒ½ ä¸€å…ƒè¿ç®—ç¬¦ NOT å–åè¿ç®—ï¼Œæ¡ä»¶ä¸ºå‡æ—¶è¿”å›çœŸã€‚ ä¸€å…ƒè¿ç®—ç¬¦ DEFINED æ£€æŸ¥å˜é‡æ˜¯å¦å·²ç»å®šä¹‰ã€‚ ä¸€å…ƒè¿ç®—ç¬¦ DEFINED åˆ¤æ–­æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚ ä¸€å…ƒè¿ç®—ç¬¦ COMMAND åˆ¤æ–­å‘½ä»¤æ˜¯å¦å­˜åœ¨ã€‚ ä¸€å…ƒè¿ç®—ç¬¦ POLICY åˆ¤æ–­ CMake ç­–ç•¥æ˜¯å¦å®šä¹‰ã€‚ ä¸€å…ƒè¿ç®—ç¬¦ TARGET åˆ¤æ–­æŒ‡å®šçš„ç›®æ ‡æ˜¯å¦å­˜åœ¨ã€‚ äºŒå…ƒè¿ç®—ç¬¦ AND é€»è¾‘ä¸è¿ç®—ï¼Œæ‰€æœ‰æ¡ä»¶ä¸ºçœŸæ—¶ç»“æœæ‰ä¸ºçœŸã€‚ äºŒå…ƒè¿ç®—ç¬¦ OR é€»è¾‘æˆ–è¿ç®—ï¼Œåªè¦æœ‰ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸï¼Œç»“æœå°±ä¸ºçœŸã€‚ äºŒå…ƒè¿ç®—ç¬¦ EQUAL åˆ¤æ–­ä¸¤ä¸ªæ•°å€¼æ˜¯å¦ç›¸ç­‰ã€‚ äºŒå…ƒè¿ç®—ç¬¦ LESS åˆ¤æ–­å·¦ä¾§æ•°æ˜¯å¦å°äºå³ä¾§æ•°ã€‚ äºŒå…ƒè¿ç®—ç¬¦ GREATER åˆ¤æ–­å·¦ä¾§æ•°æ˜¯å¦å¤§äºå³ä¾§æ•°ã€‚ äºŒå…ƒè¿ç®—ç¬¦ LESS_EQUAL åˆ¤æ–­å·¦ä¾§æ•°æ˜¯å¦å°äºç­‰äºå³ä¾§æ•°ã€‚ äºŒå…ƒè¿ç®—ç¬¦ GREATER_EQUAL åˆ¤æ–­å·¦ä¾§æ•°æ˜¯å¦å¤§äºç­‰äºå³ä¾§æ•°ã€‚ äºŒå…ƒè¿ç®—ç¬¦ STREQUAL åˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ã€‚ äºŒå…ƒè¿ç®—ç¬¦ STRLESS åˆ¤æ–­å·¦ä¾§å­—ç¬¦ä¸²æ˜¯å¦å°äºå³ä¾§å­—ç¬¦ä¸²ï¼ˆå­—å…¸åºï¼‰ã€‚ äºŒå…ƒè¿ç®—ç¬¦ STRGREATER åˆ¤æ–­å·¦ä¾§å­—ç¬¦ä¸²æ˜¯å¦å¤§äºå³ä¾§å­—ç¬¦ä¸²ï¼ˆå­—å…¸åºï¼‰ã€‚ äºŒå…ƒè¿ç®—ç¬¦ MATCHES åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ äºŒå…ƒè¿ç®—ç¬¦ VERSION_LESS åˆ¤æ–­å·¦ä¾§ç‰ˆæœ¬å·æ˜¯å¦å°äºå³ä¾§ç‰ˆæœ¬å·ã€‚ äºŒå…ƒè¿ç®—ç¬¦ VERSION_EQUAL åˆ¤æ–­ä¸¤ä¸ªç‰ˆæœ¬å·æ˜¯å¦ç›¸ç­‰ã€‚ äºŒå…ƒè¿ç®—ç¬¦ VERSION_GREATER åˆ¤æ–­å·¦ä¾§ç‰ˆæœ¬å·æ˜¯å¦å¤§äºå³ä¾§ç‰ˆæœ¬å·ã€‚ æ„å»ºæ—¶è¯„ä¼°çš„æ§åˆ¶æµï¼šgenerator-expressions ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼ˆgenerator-expressionsï¼Œç®€ç§°ä¸ºgenexï¼‰æ˜¯ä¸€ç§ç”¨äºåœ¨æ„å»ºç”Ÿæˆé˜¶æ®µåŠ¨æ€è¯„ä¼°å’Œæ§åˆ¶è¡Œä¸ºçš„å¼ºå¤§å·¥å…·ã€‚generator-expressioné€šå¸¸ç”¨äºç›®æ ‡å±æ€§ï¼ˆä¾‹å¦‚ç¼–è¯‘é€‰é¡¹ã€é“¾æ¥é€‰é¡¹ç­‰ï¼‰ï¼Œåœ¨é¡¹ç›®çš„ç”Ÿæˆå’Œæ„å»ºé˜¶æ®µæ ¹æ®å…·ä½“çš„æ„å»ºé…ç½®ï¼ˆå¦‚ Debug æˆ– Releaseï¼‰åŠ¨æ€è°ƒæ•´è¡Œä¸ºã€‚\ngenerator-expressionåŸºæœ¬è¯­æ³•\n$\u0026lt;CONDITION:arg1,arg2,...\u0026gt; # CONDITION è¡¨ç¤ºè¡¨è¾¾å¼ç±»å‹ï¼Œarg1, arg2, ... æ˜¯ä¼ é€’ç»™æ¡ä»¶çš„å‚æ•°ã€‚ é…ç½®ç›¸å…³çš„generator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;CONFIG:config\u0026gt; å¦‚æœå½“å‰æ„å»ºé…ç½®ä¸º configï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;CONFIG:Debug\u0026gt;ï¼šåœ¨ Debug é…ç½®ä¸­ä¸ºçœŸã€‚ $\u0026lt;NOT:$\u0026lt;CONFIG:config\u0026gt;\u0026gt; å¦‚æœå½“å‰æ„å»ºé…ç½®ä¸æ˜¯ configï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;NOT:$\u0026lt;CONFIG:Release\u0026gt;\u0026gt;ï¼šåœ¨ Release é…ç½®ä¸­ä¸ºå‡ï¼Œå…¶ä»–é…ç½®ä¸ºçœŸã€‚ $\u0026lt;CONFIGURATION\u0026gt; è¿”å›å½“å‰çš„æ„å»ºé…ç½®ï¼ˆDebugã€Releaseã€RelWithDebInfo ç­‰ï¼‰ã€‚ target_link_libraries(my_target PRIVATE $\u0026lt;CONFIGURATION\u0026gt;) é€»è¾‘ç›¸å…³çš„generator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;AND:condition1,condition2\u0026gt; å¦‚æœ condition1 å’Œ condition2 éƒ½ä¸ºçœŸï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;AND:$\u0026lt;CONFIG:Debug\u0026gt;,$\u0026lt;STREQUAL:WIN32\u0026gt;\u0026gt;ï¼šåŒæ—¶ä¸º Debug é…ç½®å’Œ Windows å¹³å°æ—¶ä¸ºçœŸã€‚ $\u0026lt;OR:condition1,condition2\u0026gt; å¦‚æœ condition1 æˆ– condition2 ä¸ºçœŸï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;OR:$\u0026lt;CONFIG:Debug\u0026gt;,$\u0026lt;STREQUAL:WIN32\u0026gt;\u0026gt;ï¼šæ˜¯ Debug æˆ– Windows æ—¶ä¸ºçœŸã€‚ $\u0026lt;NOT:condition\u0026gt; å¦‚æœ condition ä¸ºå‡ï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;NOT:$\u0026lt;CONFIG:Release\u0026gt;\u0026gt;ï¼šå¦‚æœä¸æ˜¯ Release é…ç½®åˆ™ä¸ºçœŸã€‚ $\u0026lt;BOOL:expression\u0026gt; å°†è¡¨è¾¾å¼ expression è½¬æ¢ä¸ºå¸ƒå°”å€¼ï¼Œ0 ä¸ºå‡ï¼Œå…¶ä»–ä¸ºçœŸã€‚ $\u0026lt;BOOL:1\u0026gt;ï¼šè¿”å›çœŸã€‚ å¹³å°å’Œç¼–è¯‘å™¨ç›¸å…³çš„generator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;PLATFORM_ID:platform\u0026gt; å¦‚æœå½“å‰å¹³å°æ˜¯ platformï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;PLATFORM_ID:Windows\u0026gt;ï¼šå½“å‰å¹³å°ä¸º Windows æ—¶ä¸ºçœŸã€‚ $\u0026lt;STREQUAL:string1,string2\u0026gt; å¦‚æœ string1 å’Œ string2 ç›¸ç­‰ï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;STREQUAL:APPLE,$\u0026lt;PLATFORM_ID:Darwin\u0026gt;\u0026gt;ï¼šè‹¹æœå¹³å°ä¸ºçœŸã€‚ ç›®æ ‡ç”Ÿæˆç›¸å…³çš„generator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;TARGET_EXISTS:tgt\u0026gt; å¦‚æœç›®æ ‡ tgt å­˜åœ¨ï¼Œè¿”å›çœŸã€‚ $\u0026lt;TARGET_EXISTS:my_target\u0026gt;ï¼šç›®æ ‡ my_target å­˜åœ¨æ—¶è¿”å›çœŸã€‚ $\u0026lt;TARGET_PROPERTY:tgt,prop\u0026gt; è¿”å›ç›®æ ‡ tgt çš„å±æ€§ prop çš„å€¼ã€‚ $\u0026lt;TARGET_PROPERTY:my_target,INTERFACE_INCLUDE_DIRECTORIES\u0026gt;è¿”å›ç›®æ ‡my_targetçš„å±æ€§INTERFACE_INCLUDE_DIRECTORIES çš„å€¼ã€‚ ç‰ˆæœ¬ç›¸å…³çš„generator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;VERSION_GREATER:v1,v2\u0026gt; å¦‚æœç‰ˆæœ¬ v1 å¤§äº v2ï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;VERSION_GREATER:3.20,3.10\u0026gt;ï¼šè¿”å›çœŸï¼Œå› ä¸º 3.20 \u0026gt; 3.10ã€‚ $\u0026lt;VERSION_EQUAL:v1,v2\u0026gt; å¦‚æœç‰ˆæœ¬ v1 å’Œ v2 ç›¸ç­‰ï¼Œåˆ™è¿”å›çœŸã€‚ $\u0026lt;VERSION_EQUAL:3.10,3.10\u0026gt;ï¼šè¿”å›çœŸã€‚ æ–‡ä»¶å’Œè·¯å¾„æ“ä½œgenerator-expression è¡¨è¾¾å¼ è¯´æ˜ ç¤ºä¾‹ $\u0026lt;TARGET_FILE:tgt\u0026gt; è¿”å›ç›®æ ‡ tgt çš„ç”Ÿæˆæ–‡ä»¶å®Œæ•´è·¯å¾„ã€‚ $\u0026lt;TARGET_FILE:my_target\u0026gt;ï¼šè·å– my_target ç›®æ ‡çš„ç”Ÿæˆæ–‡ä»¶è·¯å¾„ã€‚ $\u0026lt;TARGET_LINKER_FILE:tgt\u0026gt; è¿”å›ç›®æ ‡ tgt çš„é“¾æ¥å™¨æ–‡ä»¶è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ .lib æˆ– .dll æ–‡ä»¶ï¼‰ã€‚ $\u0026lt;TARGET_LINKER_FILE:my_target\u0026gt;ï¼šè·å– my_target ç›®æ ‡çš„é“¾æ¥æ–‡ä»¶ã€‚ CMakeé…ç½®æ–‡ä»¶ï¼šconfig.h.in ç”Ÿæˆä¾›æºæ–‡ä»¶è¯»å–çš„.hå¤´æ–‡ä»¶ï¼šconfigure_file() ä»æºæ–‡ä»¶ä¸­è¯»å–ä¸€äº›å˜é‡ï¼šfile() æ•´ä½“æ€§ç¤ºä¾‹ï¼šC++ä»£ç è¿ç§»Python è¯¥é¡¹ç›®å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/advanced_process/cxx_pythonã€‚è¯¥é¡¹ç›®çš„CMakeLists.txtå†…å®¹å¦‚ä¸‹ï¼š\ncmake_minimum_required(VERSION 3.9) project(CPy VERSION 0.1 DESCRIPTION \u0026#34;Little C to Python Program\u0026#34; LANGUAGES CXX) # è‡ªå®šä¹‰æˆ‘æƒ³è¦çš„åŒ…çš„è·¯å¾„ï¼šä½äºCondaç¯å¢ƒä¸‹çš„Pythonå¯æ‰§è¡Œæ–‡ä»¶ set(Python_EXECUTABLE \u0026#34;$ENV{CONDA_PYTHON_EXE}\u0026#34;) # æŸ¥æ‰¾Pythonè§£é‡Šå™¨ä»¥åŠè°ƒè¯•å·¥å…·ç»„ä»¶ find_package(Python REQUIRED COMPONENTS Interpreter Development) if(Python_FOUND) message(\u0026#34;Python Found at ${Python_INCLUDE_DIRS}\u0026#34;) # ä»Condaç¯å¢ƒä¸‹çš„PythonæŸ¥æ‰¾pybind11è·¯å¾„ execute_process( COMMAND \u0026#34;${Python_EXECUTABLE}\u0026#34; -m pybind11 --cmakedir RESULT_VARIABLE __pybind_exit_code OUTPUT_VARIABLE __pybind_path OUTPUT_STRIP_TRAILING_WHITESPACE ) if(__pybind_exit_code EQUAL 0) set(pybind11_DIR ${__pybind_path}) find_package(pybind11 REQUIRED) message(\u0026#34;pybind11 Found at ${pybind11_INCLUDE_DIRS}\u0026#34;) # åˆ›å»ºç¼–è¯‘é€‰é¡¹æ¥å£åº“ add_library(compiler_flags INTERFACE) target_compile_features(compiler_flags INTERFACE cxx_std_11) # æ·»åŠ ä¼˜åŒ–é€‰é¡¹ if(NOT MSVC) target_compile_options(compiler_flags INTERFACE -O2 -march=native ) else() target_compile_options(compiler_flags INTERFACE /O2 /arch:AVX2 # å¯¹åº”äº -march=native ) endif() ################## #######CPU######## ################## add_library(ndarray_backend_cpu MODULE src/ndarray_backend_cpu.cc) target_include_directories(ndarray_backend_cpu PRIVATE ${Python_INCLUDE_DIRS} ${pybind11_INCLUDE_DIRS} ) target_link_libraries(ndarray_backend_cpu PUBLIC ${pybind11_LIBRARIES} compiler_flags # é“¾æ¥ç¼–è¯‘é€‰é¡¹æ¥å£åº“ ) pybind11_extension(ndarray_backend_cpu) pybind11_strip(ndarray_backend_cpu) # è¾“å‡ºç¼–è¯‘æ–‡ä»¶ set_target_properties( ndarray_backend_cpu PROPERTIES LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/needle/backend_ndarray CXX_VISIBILITY_PRESET \u0026#34;hidden\u0026#34; ) if(${CMAKE_SYSTEM_NAME} MATCHES \u0026#34;Darwin\u0026#34;) set_property(TARGET ndarray_backend_cpu PROPERTY LINK_OPTIONS -undefined dynamic_lookup) endif() else() message(FATAL_ERROR \u0026#34;Could not find pybind11 in the Python environment!!!\u0026#34;) endif() else() message(FATAL_ERROR \u0026#34;Could not find Python from Miniconda!!!\u0026#34;) endif() æˆ‘ä»¬å¯ä»¥çœ‹åˆ°CMakeLists.txtä¸­çš„åŸºæœ¬ä¸Šä¸æ„å»ºè¿‡ç¨‹ç›¸å…³çš„ä»»åŠ¡çš†ä¸ºç›®æ ‡ï¼ˆEverything is a target)ï¼Œæ¥å£åº“compiler_flagsæ˜¯ç›®æ ‡ï¼ˆè¯¥ç›®æ ‡è¢«è¦æ±‚ä½¿ç”¨Â C++11 æ ‡å‡†ï¼Œåé¢åˆä¸ºå…¶è®¾å®šäº†ç¼–è¯‘é€‰é¡¹ï¼‰ï¼Œç¼–è¯‘src/ndarray_backend_cpu.ccè€Œå½¢æˆçš„åº“æ–‡ä»¶ndarray_backend_cpuä¹Ÿæ˜¯ç›®æ ‡ï¼Œè€Œè¿™äº›å˜é‡éƒ½ä¸æ„å»ºè¿‡ç¨‹é«˜åº¦ç›¸å…³ã€‚\nEverything is a target ç›®æ ‡ç±»å‹ å¯æ‰§è¡Œæ–‡ä»¶ï¼šé€šå¸¸ä½¿ç”¨ add_executable æ¥åˆ›å»ºã€‚ åº“æ–‡ä»¶ï¼šé€šå¸¸ä½¿ç”¨ add_library æ¥åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä»å·²æœ‰packageä¸­æŸ¥æ‰¾ã€‚ è‡ªå®šä¹‰å‘½ä»¤ï¼šä½¿ç”¨ add_custom_target æˆ– add_custom_command åˆ›å»ºã€‚ ç›®æ ‡ä¾èµ–å…³ç³» æŒ‡å®šä¾èµ–å…³ç³»ï¼šä½¿ç”¨target_link_libraryæ¥åˆ¶å®šä¾èµ–å…³ç³»ã€‚ ç›®æ ‡å±æ€§ è®¾å®šç›®æ ‡å±æ€§ï¼štarget_* ç³»åˆ—å‘½ä»¤æ¥ä¸ºç›®æ ‡è®¾ç½®ä¸€ç³»åˆ—çš„å±æ€§ã€‚å¸¸ç”¨çš„æœ‰target_compile_featuresï¼Œtarget_include_directoriesï¼Œtarget_compile_options\u0026hellip; æˆ‘ä»¬ä¹Ÿå¯ä»¥é…ç½®Makefileæ–‡ä»¶æ¥ä½¿å¾—å…ˆcmake -B buildç”Ÿæˆæ„å»ºç³»ç»Ÿæ–‡ä»¶ç„¶åå†è¿è¡Œcmake --build buildæ¥æ‰§è¡Œæ„å»ºæ“ä½œï¼ˆç¼–è¯‘ï¼‰ä½¿ç”¨makeå‘½ä»¤ä¸€æ­¥å®Œæˆã€‚\n.PHONY: lib, pybind, clean, format, all all: lib lib: cmake -B build cmake --build build format: python3 -m black . clang-format -i src/*.cc src/*.cu clean: rm -rf build needle/backend_ndarray/ndarray_backend*.so .PHONYæ˜¯ Makefile ä¸­çš„ä¸€ä¸ªç‰¹æ®Šç›®æ ‡ï¼Œç”¨æ¥å£°æ˜ç›®æ ‡ä¸ç”Ÿæˆä¸å…¶åå­—ç›¸åŒçš„æ–‡ä»¶ã€‚ allç›®æ ‡è¡¨ç¤ºä¸€æ¬¡æ€§æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚åœ¨è¯¥æ–‡ä»¶ä¸­æ‰§è¡Œmake all (make)å’Œmake libç­‰æ•ˆ formatç›®æ ‡ç›®çš„æ˜¯æ ¼å¼åŒ–ä»£ç ã€‚ cleanç›®æ ‡ç”¨äºæ¸…ç†æ„å»ºç”Ÿæˆçš„æ–‡ä»¶ã€‚ ","permalink":"https://fordelkon.github.io/posts/cmake_intro_2/","summary":"\u003cp\u003eä¸Šé¢æˆ‘ä»¬å®ç°äº†CMakeçš„ä¸€å¥—ç®€è¦æ­å»ºæµç¨‹ï¼ŒåŸºæœ¬ä¸Šç®€å•çš„ç¼–è¯‘é…ç½®å°±é ä¸Šé¢çš„å‡ ä¸ªCMakeå‘½ä»¤å°±å¯ä»¥å®Œæˆäº†ã€‚ä½†ä¸€äº›å¤§å‹é¡¹ç›®çš„cmakeçš„é…ç½®å…‰é ä¸Šé¢çš„å‡ ä¸ªCMakeå‘½ä»¤æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œç®€å•æ¥è¯´å¦‚ä½•å¯¼å…¥ç¬¬ä¸‰æ–¹åº“ï¼Œå—¯è¿™å°±å±äºCMakeè¿›é˜¶çš„å†…å®¹äº†\u0026hellip;\u003c/p\u003e","title":"ä½¿ç”¨CMakeçš„è‰ºæœ¯2"},{"content":"è¿˜åœ¨ä½¿ç”¨vs codeè¿›è¡ŒC++çš„ç¯å¢ƒçš„é…ç½®å—ï¼Ÿæƒ³æƒ³å¯¹é‚£äº›.vscodeæ–‡ä»¶å¤¹ä¸‹çš„ä¸€ç³»åˆ—æ–‡ä»¶è¿›è¡Œå•ç‹¬é…ç½®å°±æ„Ÿåˆ°å¤´å¤§ğŸ˜­ï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™æ¥ä½¿ç”¨CMakeæ¥è¿›è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘äº†ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„ä¸€ä¸ª.cxxæ–‡ä»¶ä¸€ä¸ª.vscodeæ–‡ä»¶å¤¹äº†ã€‚å½“ç„¶CMakeçš„ä½œç”¨è¿œä¸æ­¢æ­¤ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨æ¯ç§ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œè®¸å¤šå¤§å‹é¡¹ç›®æ˜¯éœ€è¦é’ˆå¯¹ä¸åŒçš„åŠŸèƒ½è¾…ä»¥ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å®ç°ï¼Œè¿™æ—¶å€™å°±è¦é CMakeæ¥å®šåˆ¶æ•´ä¸ªç¼–è¯‘æµç¨‹äº†\u0026hellip;\nCMakeé é…ç½®æ–‡ä»¶CMakeLists.txtæ¥å®šåˆ¶æ•´ä¸ªç¼–è¯‘æµç¨‹ã€‚ åœ¨CMakeLists.txtæ‰€åœ¨çš„ç›®å½•ä¸‹è¿è¡Œcmake -B buildç”Ÿæˆæ„å»ºç³»ç»Ÿæ–‡ä»¶ç„¶åå†è¿è¡Œcmake --build buildæ¥æ‰§è¡Œæ„å»ºæ“ä½œï¼ˆç¼–è¯‘ï¼‰ã€‚ å°è£…Makefileæ–‡ä»¶æ¥è¿›è¡Œå®šåˆ¶åŒ–makeå‘½ä»¤ã€‚ CMakeLists.txtç¼–å†™å®ç° ä¸€ä¸ªç›®å½•ä¸‹ä¸€ä¸ªæºæ–‡ä»¶ æœ¬èŠ‚å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/brief_process/Demo1ã€‚ ç¼–è¯‘ä¸€ä¸ªmainæ–‡ä»¶ï¼ˆè¿™é‡Œå°±æŒ‡å®šå¸¦æœ‰mainå‡½æ•°çš„æ–‡ä»¶äº†ï¼‰ï¼Œå¿…è¦çš„ä¸‰ä¸ªå‘½ä»¤cmake_minimum_required()ã€project()å’Œadd_executable()ã€‚\n// ./Demo1 // â”œâ”€â”€ CMakeLists.txt // â””â”€â”€ main.cpp âœ… #include \u0026lt;iostream\u0026gt; using namespace std; // æŸ¥æ‰¾å­—ç¬¦ä¸²leftç´¢å¼•ä»¥å·¦ï¼Œrightç´¢å¼•ä»¥å³è¿ç»­å¯¹ç§°å¯è¾¾ç´¢å¼• pair\u0026lt;int, int\u0026gt; expandAroundCenter(const string\u0026amp; s, int left, int right) { while (left \u0026gt;= 0 \u0026amp;\u0026amp; right \u0026lt; s.size() \u0026amp;\u0026amp; s[left] == s[right]) { left--; right++; } return {left + 1, right - 1}; } // æŸ¥æ‰¾æœ€é•¿å›æ–‡å­—ç¬¦ä¸² string longestPalindrome(string s) { int start = 0, end = 0; for (int i = 0; i \u0026lt; s.size(); i++) { pair\u0026lt;int, int\u0026gt; result = expandAroundCenter(s, i, i); int left1 = result.first; int right1 = result.second; result = expandAroundCenter(s, i, i + 1); int left2 = result.first; int right2 = result.second; if (right1 - left1 \u0026gt; end - start) { start = left1; end = right1; } if (right2 - left2 \u0026gt; end - start) { start = left2; end = right2; } } return s.substr(start, end - start + 1); } int main(int argc, char *argv[]) { if (argc \u0026lt; 2) { cout \u0026lt;\u0026lt; \u0026#34;Lack of raw string to find the longest palindrome!!!\u0026#34; \u0026lt;\u0026lt; endl; return 1; } string str = argv[1]; string res = longestPalindrome(str); cout \u0026lt;\u0026lt; \u0026#34;The longest palindrome of `\u0026#34; \u0026lt;\u0026lt; str \u0026lt;\u0026lt; \u0026#34;` is `\u0026#34; \u0026lt;\u0026lt; res \u0026lt;\u0026lt; \u0026#34;`\u0026#34; \u0026lt;\u0026lt; endl; return 0; } # ./Demo1 # â”œâ”€â”€ CMakeLists.txt âœ… # â””â”€â”€ main.cpp # æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # important!!! # è®¾ç½®é¡¹ç›®åç§° project(Demo1 C CXX) # important!!! # å¯ç”¨ C++11 æˆ–æ›´é«˜æ ‡å‡† set(CMAKE_CXX_STANDARD 11) set(CMAKE_CXX_STANDARD_REQUIRED ON) # ä½¿ç”¨main.cppæ„å»ºä¸€ä¸ªåä¸ºDemoçš„å¯æ‰§è¡Œæ–‡ä»¶ add_executable(Demo main.cpp) # important!!! ä¸Šé¢çš„main.cppä¸»è¦å®ç°äº†æŸ¥æ‰¾ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„æœ€é•¿å›æ–‡å­—ç¬¦ä¸²ï¼ŒCMakeLists.txtæ–‡ä»¶æŒ‡å®šäº†æˆ‘ä»¬çš„ç¼–è¯‘é…ç½®ï¼Œåœ¨CMakeLists.txtæ‰€åœ¨çš„ç›®å½•ä¸‹è¿è¡Œcmake -B buildå’Œcmake --build buildæ¥è¿›è¡Œç¼–è¯‘ç„¶åå¾—åˆ°äº†å¦‚ä¸‹å¦‚ä¸‹çš„ç›®å½•æ ‘ç»“æ„ï¼š\n./Demo1 â”œâ”€â”€ CMakeLists.txt â”œâ”€â”€ build âœ… â””â”€â”€ main.cpp æˆ‘ä»¬ç”Ÿæˆçš„Demoå¯æ‰§è¡Œç¨‹åºå°±åœ¨buildç›®å½•ä¸‹ï¼Œå¦‚ä¸‹ï¼š\n./build â”œâ”€â”€ CMakeCache.txt â”œâ”€â”€ CMakeFiles â”œâ”€â”€ Demo âœ… â”œâ”€â”€ Makefile â””â”€â”€ cmake_install.cmake åœ¨è¯¥ç›®å½•ä¸‹è¿è¡Œè¯¥å¯æ‰§è¡Œæ–‡ä»¶ï¼š\n./Demo iloveevolijupyter # The longest palindrome of `iloveevolijupyter` is `iloveevoli` ä¸€ä¸ªç›®å½•ä¸‹å¤šä¸ªæºæ–‡ä»¶ æœ¬èŠ‚å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/brief_process/Demo2ã€‚ æˆ‘ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ä¸Šé¢å¿…è¦çš„ä¸‰ä¸ªå‘½ä»¤cmake_minimum_required()ã€project()å’Œadd_executable()ã€‚ä½†æ˜¯è¿™æ¬¡çš„æºæ–‡ä»¶ä¸æ­¢ä¸€ä¸ªï¼Œè€Œæ˜¯æœ‰ä»¥ä¸‹ä¸‰ä¸ªï¼Œå› æ­¤ç¬¬ä¸‰ä¸ªå‘½ä»¤çš„ä¼ å…¥çš„æºæ–‡ä»¶å‚æ•°éœ€è¦è°ƒæ•´\u0026hellip;æˆ‘ä»¬å¯ä»¥ä¿®æ”¹æˆadd_executable(Demo, main.cpp, strUtils.cpp, strUtils.hpp)ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹è¿œè¿œå¤šäºä¸‰ä¸ªï¼Œæˆ‘ä»¬è¿˜è¦è¿™æ ·å‚»å‚»çš„ä¸€ä¸ªä¸€ä¸ªä¼ å…¥æ–‡ä»¶åç§°çš„å‚æ•°å—ï¼Ÿå…¶å®CMakeçš„aux_source_directory()å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¾—åˆ°æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰çš„æºæ–‡ä»¶ã€‚\naux_source_directory(\u0026lt;dir\u0026gt; \u0026lt;variable\u0026gt;) å‚æ•°ï¼š \u0026lt;dir\u0026gt; ï¼šåŒ…å«æºæ–‡ä»¶çš„ç›®å½•è·¯å¾„ã€‚ \u0026lt;variable\u0026gt; ï¼šç”¨äºå­˜å‚¨åœ¨è¯¥ç›®å½•ä¸­æ‰¾åˆ°çš„æºæ–‡ä»¶çš„å˜é‡åç§°ã€‚ // ./Demo2 // â”œâ”€â”€ CMakeLists.txt // â”œâ”€â”€ main.cpp // â”œâ”€â”€ strUtils.cpp // â””â”€â”€ strUtils.hpp âœ… #ifndef STRUTILS_H #define STRUTILS_H #include \u0026lt;iostream\u0026gt; using namespace std; // æŸ¥æ‰¾æœ€é•¿å›æ–‡å­—ç¬¦ä¸² string longestPalindrome(string s); #endif // ./Demo2 // â”œâ”€â”€ CMakeLists.txt // â”œâ”€â”€ main.cpp // â”œâ”€â”€ strUtils.cpp âœ… // â””â”€â”€ strUtils.hpp #include \u0026lt;iostream\u0026gt; using namespace std; pair\u0026lt;int, int\u0026gt; expandAroundCenter(const string\u0026amp; s, int left, int right) { while (left \u0026gt;= 0 \u0026amp;\u0026amp; right \u0026lt; s.size() \u0026amp;\u0026amp; s[left] == s[right]) { left--; right++; } return {left + 1, right - 1}; } // æŸ¥æ‰¾æœ€é•¿å›æ–‡å­—ç¬¦ä¸² string longestPalindrome(string s) { int start = 0, end = 0; for (int i = 0; i \u0026lt; s.size(); i++) { pair\u0026lt;int, int\u0026gt; result = expandAroundCenter(s, i, i); int left1 = result.first; int right1 = result.second; result = expandAroundCenter(s, i, i + 1); int left2 = result.first; int right2 = result.second; if (right1 - left1 \u0026gt; end - start) { start = left1; end = right1; } if (right2 - left2 \u0026gt; end - start) { start = left2; end = right2; } } return s.substr(start, end - start + 1); } // ./Demo2 // â”œâ”€â”€ CMakeLists.txt // â”œâ”€â”€ main.cpp âœ… // â”œâ”€â”€ strUtils.cpp // â””â”€â”€ strUtils.hpp #include \u0026lt;iostream\u0026gt; #include \u0026#34;strUtils.hpp\u0026#34; using namespace std; int main(int argc, char *argv[]) { if (argc \u0026lt; 2) { cout \u0026lt;\u0026lt; \u0026#34;Lack of raw string to find the longest palindrome!!!\u0026#34; \u0026lt;\u0026lt; endl; return 1; } string str = argv[1]; string res = longestPalindrome(str); cout \u0026lt;\u0026lt; \u0026#34;The longest palindrome of `\u0026#34; \u0026lt;\u0026lt; str \u0026lt;\u0026lt; \u0026#34;` is `\u0026#34; \u0026lt;\u0026lt; res \u0026lt;\u0026lt; \u0026#34;`\u0026#34; \u0026lt;\u0026lt; endl; return 0; } # ./Demo2 # â”œâ”€â”€ CMakeLists.txt âœ… # â”œâ”€â”€ main.cpp # â”œâ”€â”€ strUtils.cpp # â””â”€â”€ strUtils.hpp # æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # è®¾ç½®é¡¹ç›®åç§° project(Demo2 C CXX) # å¯ç”¨ C++11 æˆ–æ›´é«˜æ ‡å‡† set(CMAKE_CXX_STANDARD 11) set(CMAKE_CXX_STANDARD_REQUIRED ON) # æŸ¥æ‰¾Demo2/ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœå­˜è¿›DIR_SRCSã€‚ aux_source_directory(. DIR_SRCS) # important!!! # ä½¿ç”¨main.cppæ„å»ºä¸€ä¸ªåä¸ºDemoçš„å¯æ‰§è¡Œæ–‡ä»¶ add_executable(Demo ${DIR_SRCS}) å¤šä¸ªç›®å½•ä¸‹å¤šä¸ªæºæ–‡ä»¶ æœ¬èŠ‚å¯¹åº”çš„æºä»£ç æ‰€åœ¨ç›®å½•è¯¦è§https://github.com/fordelkon/cmake_tutorial/tree/main/brief_process/Demo3ã€‚ ç°åœ¨æˆ‘ä»¬è¿›ä¸€æ­¥åˆ†é…longestPalindromeå’ŒexpandAroundCenterå‡½æ•°åˆ†åˆ«è¿›å…¥StrUtilsæ–‡ä»¶å¤¹å’ŒMyIncludeæ–‡ä»¶å¤¹ã€‚å¦‚ä¸‹ç»“æ„ï¼š\n./Demo3 â”œâ”€â”€ CMakeLists.txt â”œâ”€â”€ MyInclude â”‚ â”œâ”€â”€ CMakeLists.txt â”‚ â”œâ”€â”€ aroundCenter.cpp â”‚ â””â”€â”€ aroundCenter.hpp â”œâ”€â”€ StrUtils â”‚ â”œâ”€â”€ CMakeLists.txt â”‚ â”œâ”€â”€ palindrome.cpp â”‚ â””â”€â”€ palindrome.hpp â””â”€â”€ main.cpp æˆ‘ä»¬å¸Œæœ›åœ¨palindrome.cppä¸­å¼•ç”¨#include \u0026quot;MyInclude/aroundCenter.hpp\u0026quot;ï¼ŒåŒæ—¶åœ¨main.cppä¸­å¼•ç”¨#include \u0026quot;StrUtils/palindrome.hpp\u0026quot;ã€‚è¿™æ—¶æˆ‘ä»¬ä¾¿éœ€è¦ä½¿ç”¨add_library()ã€target_link_libraries()ã€target_include_directories()å’Œadd_subdirectory()è¿™å››ä¸ªå‘½ä»¤äº†ã€‚\nadd_library() add_library() æ˜¯ CMake ä¸­ç”¨äºå®šä¹‰å’Œåˆ›å»ºä¸€ä¸ªåº“ï¼ˆé™æ€æˆ–åŠ¨æ€ï¼‰çš„å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥è®©ä½ åœ¨æ„å»ºç³»ç»Ÿä¸­åˆ›å»ºè‡ªå·±çš„åº“ï¼Œå¹¶æŒ‡å®šåº“çš„æºæ–‡ä»¶ã€‚\nadd_library(\u0026lt;library_name\u0026gt; \u0026lt;STATIC|SHARED|MODULE\u0026gt; \u0026lt;source_files\u0026gt; ...) å‚æ•°ï¼š \u0026lt;library_name\u0026gt; ï¼šæŒ‡å®šè¦åˆ›å»ºçš„åº“çš„åç§°ã€‚è¿™ä¸ªåå­—ä¼šæˆä¸ºä½ åœ¨é¡¹ç›®ä¸­å¼•ç”¨è¯¥åº“æ—¶ä½¿ç”¨çš„æ ‡è¯†ç¬¦ã€‚ \u0026lt;STATIC|SHARED|MODULE\u0026gt; ï¼šæŒ‡å®šåº“çš„ç±»å‹ã€‚ - STATIC ï¼šç”Ÿæˆä¸€ä¸ªé™æ€åº“ï¼Œæ–‡ä»¶æ‰©å±•åé€šå¸¸æ˜¯ .aï¼ˆç±»Unixï¼‰ æˆ– .libï¼ˆWindowsï¼‰ï¼Œå®ƒåœ¨è¢«é“¾æ¥æ—¶è¢«åµŒå…¥åˆ°ç›®æ ‡ä¸­ã€‚ï¼ˆé»˜è®¤ï¼‰ - SHARED ï¼šç”Ÿæˆä¸€ä¸ªå…±äº«åº“ï¼ˆåŠ¨æ€åº“ï¼‰ï¼Œæ–‡ä»¶æ‰©å±•åé€šå¸¸æ˜¯ .soï¼ˆLinuxï¼‰ï¼Œ.dylibï¼ˆmacOSï¼‰ï¼Œæˆ– .dllï¼ˆWindowsï¼‰ã€‚å…±äº«åº“åœ¨è¿è¡Œæ—¶ç”±æ“ä½œç³»ç»ŸåŠ è½½ã€‚ - MODULE ï¼šç”Ÿæˆä¸€ä¸ªæ¨¡å—åº“ï¼Œè¿™ç§ç±»å‹çš„åº“ä¸ä¼šè¢«é“¾æ¥åˆ°ç›®æ ‡ï¼Œè€Œæ˜¯é€šè¿‡æ“ä½œç³»ç»Ÿçš„æ’ä»¶æœºåˆ¶åŠ è½½ï¼Œé€šå¸¸ç”¨äºæ’ä»¶æ¶æ„ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚ \u0026lt;source_files\u0026gt; ï¼šç”¨äºæ„å»ºåº“çš„æºæ–‡ä»¶åˆ—è¡¨ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæºæ–‡ä»¶ï¼ˆC++æˆ–Cï¼‰ã€‚ target_link_libraries() target_link_libraries()æ˜¯ CMake ä¸­ç”¨äºå°†åº“é“¾æ¥åˆ°å¦ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„å‘½ä»¤ã€‚å®ƒç”¨äºæŒ‡å®šæŸä¸ªç›®æ ‡ï¼ˆå¦‚å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼‰æ‰€ä¾èµ–çš„åº“ï¼Œä»¥ä¾¿åœ¨æ„å»ºæ—¶æ­£ç¡®é“¾æ¥è¿™äº›åº“ã€‚\ntarget_link_libraries(\u0026lt;target_name\u0026gt; \u0026lt;PRIVATE|PUBLIC|INTERFACE\u0026gt;\u0026lt;libraries\u0026gt; ...) å‚æ•°ï¼š \u0026lt;target_name\u0026gt; ï¼šè¿™æ˜¯ç›®æ ‡æ–‡ä»¶çš„åç§°ï¼ˆå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼‰ã€‚ \u0026lt;PRIVATE|PUBLIC|INTERFACE\u0026gt; ï¼šæŒ‡å®šåº“çš„é“¾æ¥æ–¹å¼ã€‚ - PRIVATE ï¼šä»…å½“å‰ç›®æ ‡ä½¿ç”¨æ­¤åº“ï¼Œå…¶ä»–ä¾èµ–å½“å‰ç›®æ ‡çš„ç›®æ ‡ä¸ä¼šå—åˆ°å½±å“ã€‚ï¼ˆé»˜è®¤ï¼‰ - PUBLIC ï¼šå½“å‰ç›®æ ‡å’Œæ‰€æœ‰ä¾èµ–å½“å‰ç›®æ ‡çš„ç›®æ ‡éƒ½ä¼šé“¾æ¥è¿™ä¸ªåº“ã€‚ - INTERFACE ï¼šåªæœ‰ä¾èµ–å½“å‰ç›®æ ‡çš„ç›®æ ‡ä¼šé“¾æ¥æ­¤åº“ï¼Œå½“å‰ç›®æ ‡ä¸ä¼šé“¾æ¥æ­¤åº“ã€‚ \u0026lt;libraries\u0026gt; ï¼šä½ å¸Œæœ›ä¸ç›®æ ‡æ–‡ä»¶é“¾æ¥çš„åº“ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªåº“ã€‚ target_include_directories() target_include_directories()æ˜¯CMakeä¸­ç”¨äºä¸ºç‰¹å®šç›®æ ‡ï¼ˆå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼‰æŒ‡å®šå¤´æ–‡ä»¶æœç´¢è·¯å¾„çš„å‘½ä»¤ã€‚è¿™äº›è·¯å¾„ä¼šå‘ŠçŸ¥ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ç›®æ ‡æ—¶åˆ°å“ªé‡Œå»å¯»æ‰¾å¤´æ–‡ä»¶ã€‚\ntarget_include_directories(\u0026lt;target_name\u0026gt; \u0026lt;INTERFACE|PUBLIC|PRIVATE\u0026gt; \u0026lt;directories\u0026gt;) å‚æ•°ï¼š \u0026lt;target_name\u0026gt; ï¼šä½ æƒ³è¦è®¾ç½®çš„æœç´¢ç›®å½•çš„ç›®æ ‡æ–‡ä»¶ï¼ˆå¯ä»¥æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ï¼‰ã€‚ \u0026lt;INTERFACE|PUBLIC|PRIVATE\u0026gt; ï¼šæŒ‡å®šç›®å½•å¯¹ç›®æ ‡æ–‡ä»¶çš„å¯è§æ€§å’Œé“¾æ¥æ–¹å¼ - INTERFACE ï¼šç›®æ ‡æœ¬èº«ä¸ä¼šä½¿ç”¨è¿™äº›ç›®å½•ï¼Œä½†ä¾èµ–æ­¤ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ä¼šä½¿ç”¨è¿™äº›ç›®å½•ã€‚ - PUBLIC ï¼šç›®æ ‡æœ¬èº«ä¼šä½¿ç”¨è¿™äº›ç›®å½•ï¼Œä¾èµ–æ­¤ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ä¹Ÿä¼šä½¿ç”¨è¿™äº›ç›®å½•ã€‚ - PRIVATE ï¼šç›®æ ‡æœ¬èº«ä¼šä½¿ç”¨è¿™äº›ç›®å½•ï¼Œä¾èµ–äºæ­¤ç›®æ ‡çš„å…¶ä»–ç›®æ ‡ä¸ä¼šä½¿ç”¨è¿™äº›ç›®å½•ã€‚ï¼ˆé»˜è®¤ï¼‰ \u0026lt;directories\u0026gt; ï¼šè¦æ·»åŠ çš„æœç´¢ç›®å½•çš„è·¯å¾„ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„ã€‚ add_subdirectory() add_subdirectory()æ˜¯CMakeä¸­ç”¨äºåœ¨æ„å»ºæ ‘ä¸­åŒ…å«ä¸€ä¸ªå­ç›®å½•ã€‚è¿™ä¸ªå‘½ä»¤å°†å­ç›®å½•ä¸­çš„ CMakeLists.txt æ–‡ä»¶åŒ…å«åˆ°ä¸»ç›®å½•çš„æ„å»ºè¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸”å­ç›®å½•ä¼šä½œä¸ºç‹¬ç«‹çš„æ„å»ºå•å…ƒè¿›è¡Œå¤„ç†ã€‚\nadd_subdirectory(\u0026lt;source_dir\u0026gt; [binary_dir] [EXCLUDE_FROM_ALL]) å‚æ•°ï¼š \u0026lt;source_dir\u0026gt; ï¼šè¦åŒ…å«çš„å­ç›®å½•çš„è·¯å¾„ã€‚ [binary_dir] ï¼šæŒ‡å®šå­ç›®å½•çš„æ„å»ºæ–‡ä»¶è·¯å¾„ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨\u0026lt;souce_dir\u0026gt;ä¸­çš„CMakeLists.txtã€‚ [EXCLUDE_FROM_ALL] ï¼šæŒ‡å®šæ­¤é€‰é¡¹å­ç›®å½•çš„æ„å»ºæ–‡ä»¶ä¸ä¼šè‡ªåŠ¨åŒ…å«åœ¨é»˜è®¤æ„å»ºçš„ç›®æ ‡ä¸­ã€‚ # ./Demo3 # â”œâ”€â”€ CMakeLists.txt # â”œâ”€â”€ MyInclude # â”‚ â”œâ”€â”€ CMakeLists.txt âœ… # â”‚ â”œâ”€â”€ aroundCenter.cpp # â”‚ â””â”€â”€ aroundCenter.hpp # â”œâ”€â”€ StrUtils # â”‚ â”œâ”€â”€ CMakeLists.txt # â”‚ â”œâ”€â”€ palindrome.cpp # â”‚ â””â”€â”€ palindrome.hpp # â””â”€â”€ main.cpp # æŸ¥æ‰¾includeç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœå­˜è¿›DIR_SRCSã€‚ aux_source_directory(. DIR_SRCS) # æŒ‡å®šç”ŸæˆAroundCenteré“¾æ¥åº“ add_library(AroundCenter STATIC ${DIR_SRCS}) # æŒ‡å®šæ­¤é“¾æ¥åº“çš„åŒ…å«ç›®å½• target_include_directories(AroundCenter INTERFACE ${CMAKE_SOURCE_DIR} # æ·»åŠ è¿™è¡Œï¼Œä½¿å¾—å¯ä»¥ä»é¡¹ç›®æ ¹ç›®å½•æœç´¢å¤´æ–‡ä»¶ ) # ./Demo3 # â”œâ”€â”€ CMakeLists.txt # â”œâ”€â”€ MyInclude # â”‚ â”œâ”€â”€ CMakeLists.txt # â”‚ â”œâ”€â”€ aroundCenter.cpp # â”‚ â””â”€â”€ aroundCenter.hpp # â”œâ”€â”€ StrUtils # â”‚ â”œâ”€â”€ CMakeLists.txt âœ… # â”‚ â”œâ”€â”€ palindrome.cpp # â”‚ â””â”€â”€ palindrome.hpp # â””â”€â”€ main.cpp # æŸ¥æ‰¾StrUtilsç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœå­˜è¿›DIR_SRCSã€‚ aux_source_directory(. DIR_SRCS) # æŒ‡å®šç”ŸæˆPalindromeé“¾æ¥åº“ add_library(Palindrome STATIC ${DIR_SRCS}) # é“¾æ¥AroundCenteråˆ°Palindrome,å¾€Palindromeè¢«å¼•ç”¨æ˜¯AroundCenterä¼šè¢«è‡ªåŠ¨å¼•ç”¨ï¼Œ**å½“é“¾æ¥åº“æ–‡ä»¶æ—¶ï¼Œä¸è¦çœç•¥ PUBLIC æˆ– PRIVATE å…³é”®å­—** target_link_libraries(Palindrome PUBLIC AroundCenter) # æŒ‡å®šæ­¤é“¾æ¥åº“çš„åŒ…å«ç›®å½• target_include_directories(Palindrome INTERFACE ${CMAKE_SOURCE_DIR} # æ·»åŠ è¿™è¡Œï¼Œä½¿å¾—å¯ä»¥ä»é¡¹ç›®æ ¹ç›®å½•æœç´¢å¤´æ–‡ä»¶ ) # ./Demo3 # â”œâ”€â”€ CMakeLists.txt âœ… # â”œâ”€â”€ MyInclude # â”‚ â”œâ”€â”€ CMakeLists.txt # â”‚ â”œâ”€â”€ aroundCenter.cpp # â”‚ â””â”€â”€ aroundCenter.hpp # â”œâ”€â”€ StrUtils # â”‚ â”œâ”€â”€ CMakeLists.txt # â”‚ â”œâ”€â”€ palindrome.cpp # â”‚ â””â”€â”€ palindrome.hpp # â””â”€â”€ main.cpp # æŒ‡å®šæœ€å°Cmakeçš„ç‰ˆæœ¬è¦æ±‚ cmake_minimum_required(VERSION 3.9) # è®¾ç½®é¡¹ç›®åç§° project(Demo3 C CXX) # å¯ç”¨ C++11 æˆ–æ›´é«˜æ ‡å‡† set(CMAKE_CXX_STANDARD 11) set(CMAKE_CXX_STANDARD_REQUIRED ON) # æ·»åŠ å­ç›®å½•includeå’ŒStrUtils add_subdirectory(MyInclude) add_subdirectory(StrUtils) # ä½¿ç”¨main.cppæ„å»ºä¸€ä¸ªåä¸ºDemoçš„å¯æ‰§è¡Œæ–‡ä»¶ add_executable(Demo main.cpp) # é“¾æ¥Palindromeåº“åˆ°Demoï¼Œä¼šè‡ªåŠ¨é“¾æ¥åˆ°AroundCenterï¼Œ**å½“é“¾æ¥åº“æ–‡ä»¶æ—¶ï¼Œä¸è¦çœç•¥ PUBLIC æˆ– PRIVATE å…³é”®å­—** target_link_libraries(Demo PRIVATE Palindrome) ä¸‹é¢è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹å¯æ‰§è¡Œæ–‡ä»¶Demoçš„åˆ›å»ºæ‰€éœ€è¦çš„å‡½æ•°ï¼š\nadd_executable()Â æ˜¯åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶çš„å¿…éœ€å‘½ä»¤ target_link_libraries()Â æ˜¯å¯é€‰çš„ï¼Œåªåœ¨éœ€è¦ä½¿ç”¨å…¶ä»–åº“æ—¶æ‰éœ€è¦ å¦‚æœä½¿ç”¨Â target_link_libraries()ï¼Œå¿…é¡»åœ¨Â add_executable()Â ä¹‹å å®ƒä»¬æ˜¯ç‹¬ç«‹çš„å‘½ä»¤ï¼Œä½†åœ¨éœ€è¦ä½¿ç”¨å¤–éƒ¨åº“æ—¶ä¼šé…åˆä½¿ç”¨ æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶çš„ä¸¤é˜¶æ®µï¼š\nç¼–è¯‘é˜¶æ®µï¼ˆCompileï¼‰ï¼šå°†æºä»£ç ï¼ˆå¦‚ .c æˆ– .cpp æ–‡ä»¶ï¼‰è½¬æ¢ä¸ºç›®æ ‡ä»£ç ï¼ˆå³ .o æ–‡ä»¶æˆ– .obj æ–‡ä»¶ï¼‰ã€‚åœ¨æ­¤é˜¶æ®µï¼Œç¼–è¯‘å™¨ä»…æ£€æŸ¥ä»£ç çš„è¯­æ³•ã€è¯­ä¹‰ä»¥åŠåº“ä¸­å‡½æ•°çš„å£°æ˜ï¼ˆå³å¤´æ–‡ä»¶ä¸­çš„å‡½æ•°å£°æ˜ï¼‰ï¼Œä½†ä¸ä¼šå…³å¿ƒå‡½æ•°çš„å®é™…å®šä¹‰æ˜¯å¦å­˜åœ¨ã€‚\né“¾æ¥é˜¶æ®µï¼ˆLinkï¼‰ï¼šå°†å„ä¸ªç¼–è¯‘å¥½çš„ç›®æ ‡æ–‡ä»¶å’Œåº“æ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·ï¼Œå½¢æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‰€æœ‰å‡½æ•°çš„å®é™…å®ç°ï¼ˆå®šä¹‰ï¼‰å¿…é¡»æ‰¾åˆ°ï¼Œé“¾æ¥å™¨ä¼šå°†ç›®æ ‡ä»£ç ä¸åº“æ–‡ä»¶ä¸­çš„å®ç°ç»“åˆèµ·æ¥ï¼Œç¡®ä¿å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥æ­£å¸¸è¿è¡Œã€‚\n","permalink":"https://fordelkon.github.io/posts/cmake_intro_1/","summary":"\u003cp\u003eè¿˜åœ¨ä½¿ç”¨\u003ccode\u003evs code\u003c/code\u003eè¿›è¡ŒC++çš„ç¯å¢ƒçš„é…ç½®å—ï¼Ÿæƒ³æƒ³å¯¹é‚£äº›\u003ccode\u003e.vscode\u003c/code\u003eæ–‡ä»¶å¤¹ä¸‹çš„ä¸€ç³»åˆ—æ–‡ä»¶è¿›è¡Œå•ç‹¬é…ç½®å°±æ„Ÿåˆ°å¤´å¤§ğŸ˜­ï¼Œé‚£ä¹ˆæ˜¯æ—¶å€™æ¥ä½¿ç”¨CMakeæ¥è¿›è¡Œè‡ªåŠ¨åŒ–ç¼–è¯‘äº†ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæˆ‘çš„ä¸€ä¸ª\u003ccode\u003e.cxx\u003c/code\u003eæ–‡ä»¶ä¸€ä¸ª\u003ccode\u003e.vscode\u003c/code\u003eæ–‡ä»¶å¤¹äº†ã€‚å½“ç„¶CMakeçš„ä½œç”¨è¿œä¸æ­¢æ­¤ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨æ¯ç§ç¼–ç¨‹è¯­è¨€çš„ç‰¹æ€§ï¼Œè®¸å¤šå¤§å‹é¡¹ç›®æ˜¯éœ€è¦é’ˆå¯¹ä¸åŒçš„åŠŸèƒ½è¾…ä»¥ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å®ç°ï¼Œè¿™æ—¶å€™å°±è¦é CMakeæ¥å®šåˆ¶æ•´ä¸ªç¼–è¯‘æµç¨‹äº†\u0026hellip;\u003c/p\u003e","title":"ä½¿ç”¨CMakeçš„è‰ºæœ¯1"},{"content":"æœ¬ç½‘ç«™ä½¿ç”¨é™æ€ç½‘ç«™ç”Ÿæˆå™¨ Hugo åˆ›å»ºï¼Œé‡‡ç”¨ PaperMod ä¸»é¢˜ï¼Œå¹¶æ‰˜ç®¡åœ¨ Netlifyã€‚\næœ¬ç½‘ç«™ä½¿ç”¨ Google Analyticsï¼Œå®ƒä¼šä½¿ç”¨ cookiesã€‚è¯¦æƒ…è¯·å‚é˜… Google éšç§æ”¿ç­–ã€æŠ€æœ¯è¯´æ˜ ä»¥åŠ Google å¦‚ä½•ä½¿ç”¨ cookiesã€‚\næ­¤å¤–ï¼Œæœ¬ç½‘ç«™ä½¿ç”¨ giscus æä¾›è¯„è®ºåŠŸèƒ½ã€‚giscus ä¼šä½¿ç”¨ cookiesï¼šè¯¦æƒ…è¯·å‚é˜… giscus éšç§æ”¿ç­–ã€‚\næœ€åï¼Œæœ¬ç½‘ç«™ä¼šé€šè¿‡ cookie è®°ä½ä½ çš„ä¸»é¢˜åå¥½ï¼ˆäº®è‰²æˆ–æš—è‰²æ¨¡å¼ï¼‰ã€‚\nHugoã€PaperMod å’Œ Netlify å¯èƒ½ä¼šä»¥æˆ‘ä¸çŸ¥æƒ…çš„æ–¹å¼æ”¶é›†ä¿¡æ¯ã€‚é™¤äº†è¿™é‡Œæè¿°çš„å†…å®¹ä»¥åŠæˆ‘æœªçŸ¥çš„æ•°æ®æ”¶é›†ä¹‹å¤–ï¼Œæœ¬ç½‘ç«™ä¸ä¼šæ”¶é›†ã€å­˜å‚¨æˆ–åˆ†æä»»ä½•å…¶ä»–ä¿¡æ¯ã€‚\n","permalink":"https://fordelkon.github.io/privacy/","summary":"Privacy policy.","title":"Privacy Policy"},{"content":" ğŸ‘‹Hi! æˆ‘æ˜¯DL Kongã€‚\næˆ‘æ˜¯åœ¨è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦å°±è¯»çš„äººå·¥æ™ºèƒ½æ–¹å‘ç ”ç©¶ç”Ÿã€‚\næˆ‘äº2025å¹´æ¯•ä¸šäºè¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦ï¼Œè·å¾—äººå·¥æ™ºèƒ½å·¥å­¦å­¦å£«å­¦ä½ã€‚\nçƒ­çˆ±æ¼«ç”»ã€å°è¯´ã€åŠ¨æ¼«ï¼Œæ›¾ç»å°è¯•å¯¹Hassaku XL (Illustrious)æ¨¡å‹ä½¿ç”¨dreambooth loraæŠ€æœ¯è¿›è¡Œå¾®è°ƒæ¥å­¦ä¹ è‡ªå·±å–œæ¬¢çš„ç”»å¸ˆçš„ä½œå“é£æ ¼ã€‚\nå­¦ä¹ ç”»å¸ˆé£æ ¼åç”Ÿæˆçš„å›¾ç‰‡ åœ¨æœ¬ç§‘æœŸé—´å®Œæˆäº†æ­å»ºç”Ÿæ€åŒ–è°ƒæ§è£…ç½®ç³»ç»Ÿç½‘é¡µã€ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹è¿›è¡Œç¬”å½•çš„ä¿¡æ¯æ£€ç´¢ä¸å¤„ç†ã€å…¬è·¯é“è·¯è£‚çº¹æ£€æµ‹ç­‰ä¸€ç³»åˆ—é¡¹ç›®ï¼Œç ”ç©¶ç”Ÿå°†ä¼šæŒç»­ä¸°å¯Œé¡¹ç›®ç»å†ã€‚\n","permalink":"https://fordelkon.github.io/about/","summary":"Information about me.","title":"å…³äºæˆ‘"},{"content":"æˆ‘ä»¬å¯ä»¥ä»æ¦‚ç‡çš„è§’åº¦å»æ¢è®¨æ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼Œå‡è®¾æˆ‘ä»¬å·²æœ‰æ•°æ®é›†$ \\mathcal{D}=\\lbrace(\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N} $æˆ–$ \\mathcal{D}=\\lbrace\\mathbf{x}_{i}\\rbrace_{i=1}^{N} $ï¼Œä¸»è¦åŒºåˆ†äºæœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æƒ…å†µã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å¸¸è§æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­æ¨¡å‹è¦å»ºæ¨¡çš„æ¦‚ç‡è¿›è¡Œå¦‚ä¸‹åŒºåˆ†\næœ‰ç›‘ç£åˆ¤åˆ«ï¼šæ¨¡å‹æ ¹æ®è¾“å…¥é¢„æµ‹çœŸå®æ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(y\\mid\\mathbf{x}) $ è‡ªç›‘ç£åˆ¤åˆ«ï¼šæ¨¡å‹æ ¹æ®è¾“å…¥é¢„æµ‹ä¼ªæ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(\\hat{y}\\mid\\mathbf{x}) $ æœ‰ç›‘ç£ç”Ÿæˆï¼šæ¨¡å‹æ ¹æ®çœŸå®æ ‡ç­¾é¢„æµ‹ä¸æ ‡ç­¾å¯¹åº”çš„æ•°æ®é›†çš„ç©ºé—´åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid y) $ æ— ç›‘ç£ç”Ÿæˆï¼šæ¨¡å‹é¢„æµ‹æ•°æ®é›†çš„ç©ºé—´åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}) $ å…¶ä¸­$ \\mathbf{x} $å’Œ$ y $åˆ†åˆ«è¡¨ç¤ºè¾“å…¥å’Œæ ‡ç­¾çš„éšæœºå¼ é‡ï¼Œ$ \\boldsymbol{\\theta} $è¡¨ç¤ºæ¨¡å‹ä¸­å¯å­¦ä¹ çš„å‚æ•°ã€‚ä»æ¦‚ç‡è§’åº¦æ¢è®¨æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬åº”å½“æ˜ç¡®å¦‚ä¸‹å‡è®¾ï¼šè¾“å…¥åˆ°æ¨¡å‹çš„æ•°æ®æ»¡è¶³ç‹¬ç«‹åŒåˆ†å¸ƒ(independent and identically distributed)ã€‚ ä¸åŒæ·±åº¦å­¦ä¹ ä»»åŠ¡æ‰€å­¦ä¹ çš„æ¦‚ç‡åˆ†å¸ƒæ€»ç»“ æœ‰ç›‘ç£åˆ¤åˆ« å·²æœ‰æ•°æ®é›†$ \\mathcal{D}=\\lbrace(\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N} $ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿å¾—æ•°æ®é›†$ \\mathcal{D} $è¢«è§‚æµ‹åˆ°çš„æ¦‚ç‡å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯è¯´ç»™å®šè¾“å…¥$ \\mathbf{x}_{i} $ï¼Œç»è¿‡æ¨¡å‹$ f(\\mathbf{x}, \\boldsymbol{\\theta}) $å¤„ç†ä¹‹åå¾—åˆ°æ½œåœ¨ç©ºé—´$ \\mathbf{z}_{i} $æˆ–$ z_{i} $ï¼Œå…¶ä¸­$ \\mathbf{z}_{i}=f(\\mathbf{x}_{i}, \\boldsymbol{\\theta})\\in \\mathbb{R}^{K} $ï¼Œåœ¨è¿™ä¸ªæ½œåœ¨ç©ºé—´ä¸­æˆ‘ä»¬æœ‰æœ€å¤§çš„æŠŠæ¡é¢„æµ‹å‡º$ y_{i} $ã€‚ä¸Šè¿°æè¿°ç”¨æ•°å­¦å½¢å¼è¡¨è¾¾å¦‚ä¸‹ï¼š\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML} \u0026= \\arg\\max_{\\boldsymbol{\\theta}} p_{\\boldsymbol{\\theta}}(\\mathcal{D}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}} p_{\\boldsymbol{\\theta}}(y_{1}, y_{2}, \\dots, y_{N}\\mid\\mathbf{x}_{1}, \\mathbf{x}_{2}, \\dots, \\mathbf{x}_{N}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}} \\prod_{i=1}^{N} p_{\\boldsymbol{\\theta}}(y_{i}\\mid\\mathbf{x}_{i})\\quad (i.i.d.) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}} \\prod_{i=1}^{N}p(y_{i}\\mid\\mathbf{z}_{i}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}}\\sum_{i=1}^{N}\\log p(y_{i}\\mid\\mathbf{z}_{i}) \\\\ \u0026= \\arg\\min_{\\boldsymbol{\\theta}}-\\sum_{i=1}^{N}\\log p(y_{i}\\mid\\mathbf{z}_{i}) \\end{align} $$ å¸¸ä½¿ç”¨çš„$ y $åˆ†å¸ƒæœ‰$ y\\sim \\mathcal{N}(z, \\sigma^2) $ï¼ˆå›å½’é—®é¢˜ï¼‰ï¼Œ$ y\\sim \\mathrm{Bernoulli}(\\mathrm{sigmoid}(z)) $ï¼ˆäºŒåˆ†ç±»é—®é¢˜ï¼Œä½¿ç”¨$ \\mathrm{sigmoid} $å‡½æ•°ä½¿å¾—æœ€ç»ˆçš„è¾“å‡ºåŒºé—´ä¸º$ [0, 1] $ï¼‰ï¼Œ$ p(y\\mid\\mathbf{z})=\\mathrm{softmax}_{y}(\\mathbf{z})=\\frac{\\exp[z_{y}]}{\\sum_{y'=1}^{K}\\exp[z_{y'}]} $ï¼ˆå¤šåˆ†ç±»é—®é¢˜ï¼Œ$ y\\in\\lbrace 1, 2, \\dots, K\\rbrace $ï¼Œ$ \\mathbf{z}=[z_{1}, z_{2}, \\dots, z_{K}] $ï¼‰ã€‚æ›´å¤šç›¸å…³çš„æ¦‚ç‡åˆ†å¸ƒå¯ä»¥å‚è§å¸¸ç”¨æ¦‚ç‡åˆ†å¸ƒã€‚\næ— ç›‘ç£ç”Ÿæˆ å·²æœ‰æ•°æ®é›†$ \\mathcal{D}=\\lbrace{\\mathbf{x}_{i}}\\rbrace_{i=1}^{N} $ï¼Œæ— ç›‘ç£ç”Ÿæˆçš„ä»»åŠ¡å°±æ˜¯ä½¿ç”¨æ¨¡å‹å­¦ä¹ å‡ºæ•°æ®é›†çš„ç©ºé—´åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}) $ã€‚\n$ \\mathrm{GAN(Generative\\:Adversarial\\:Networks)} $ $ \\mathrm{GAN} $çš„æ€è·¯æ˜¯è®­ç»ƒå‡ºä¸€ä¸ªç”Ÿæˆå™¨$ \\hat{\\mathbf{x}} = f_{g}(\\mathbf{v}, \\boldsymbol{\\theta}^{g}):\\mathcal{V}\\to \\mathcal{X} $å°†æ½œåœ¨ç©ºé—´$ \\mathcal{V} $å¾ˆå¥½åœ°æ˜ å°„åˆ°æ ·æœ¬ç©ºé—´$ \\mathcal{X} $ã€‚è¦è®­ç»ƒå‡ºè¿™æ ·çš„ç”Ÿæˆå™¨ï¼Œ$ \\mathrm{GAN} $é¢å¤–è®­ç»ƒäº†ä¸€ä¸ªåˆ¤åˆ«å™¨$ z = f_{d}(\\mathbf{x}, \\boldsymbol{\\theta}^{d}):\\mathcal{X}\\to \\mathbb{R} $å¯¹ç”Ÿæˆçš„å›¾åƒå’ŒçœŸå®çš„å›¾åƒè¿›è¡ŒåŒºåˆ†ã€‚å¯¹äºç”Ÿæˆå™¨è¾“å…¥æ˜¯æ½œåœ¨ç©ºé—´$ \\mathcal{V} $çš„é‡‡æ ·ï¼Œè€Œå¯¹äºåˆ¤åˆ«å™¨ï¼Œæˆ‘ä»¬å°±æ‹¥æœ‰æ•°æ®é›†$ \\mathcal{D}_{union} = \\lbrace\\mathbf{x}_{i}, 1\\rbrace_{i=1}^N\\cup{\\lbrace\\hat{\\mathbf{x}}_{i}, 0\\rbrace}_{i=1}^{M} = \\lbrace\\tilde{\\mathbf{x}}_{i}, y_{i}\\rbrace_{i=1}^{N+M} $ã€‚åœ¨è®­ç»ƒçš„è¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹ç”Ÿæˆå™¨ï¼Œæˆ‘ä»¬è¦ä½¿å…¶ç”Ÿæˆçš„å›¾åƒæ›´åŠ çœŸå®ï¼ˆä½¿å¾—åˆ¤åˆ«å™¨åˆ¤å®šé«˜æ¦‚ç‡ä¸ºçœŸï¼‰ï¼Œé’ˆå¯¹åˆ¤åˆ«å™¨ï¼Œæˆ‘ä»¬è¦ä½¿åˆ¤åˆ«å™¨èƒ½å¤Ÿå¾ˆå¥½çš„åŒºåˆ†ç”Ÿæˆå™¨ç”Ÿæˆçš„ä¼ªé€ å›¾åƒå’ŒçœŸå®å›¾åƒã€‚ä¸Šé¢è¯´æ³•çš„æ•°å­¦å½¢å¼å¦‚ä¸‹\nå¯¹äºç”Ÿæˆå™¨ï¼š\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML}^{g} \u0026= \\arg\\max_{\\boldsymbol{\\theta}^g} p(y=1\\mid \\hat{z}) \\\\ \u0026= \\arg\\min_{\\boldsymbol{\\theta}^g}\\log p(y=0\\mid \\hat{z})\\quad(\\hat{z} = f_{d}(\\hat{\\mathbf{x}}, \\boldsymbol{\\theta}^d)) \\end{align} $$ å¯¹äºåˆ¤åˆ«å™¨\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML}^{d} \u0026= \\arg\\max_{\\boldsymbol{\\theta}^d} p(y\\mid \\tilde{z}) \\\\ \u0026= \\arg\\min_{\\boldsymbol{\\theta}^d}-\\log p(y\\mid \\tilde{z})\\quad(\\tilde{z} = f_{d}(\\tilde{\\mathbf{x}}, \\boldsymbol{\\theta}^d))) \\end{align} $$ $ \\mathrm{VAE(Varitional\\:AutoEncoders)} $ $ \\mathrm{VAE} $çš„æ€è·¯æ˜¯ä¹Ÿæ˜¯è®­ç»ƒä¸€ä¸ªè§£ç å™¨$ \\hat{\\mathbf{x}} = f_{d}(\\mathbf{v}, \\boldsymbol{\\theta}^{d}): \\mathcal{V}\\to \\mathcal{X} $å°†æ½œåœ¨ç©ºé—´$ \\mathcal{V} $ä¸­å¾ˆå¥½æ˜ å°„åˆ°æ ·æœ¬ç©ºé—´$ \\mathcal{X} $ã€‚ä½†æ˜¯$ \\mathrm{VAE} $æ˜¯é€šè¿‡æœ€å¤§åŒ–å»ºæ¨¡å¾—åˆ°çš„$ p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}) $æ¥å®ç°è®­ç»ƒè¯¥è§£ç å™¨çš„ã€‚è¡¨ç¤ºæˆæ•°å­¦å½¢å¼å¦‚ä¸‹ï¼š\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML}^d \u0026= \\arg\\max_{\\boldsymbol{\\theta}^d} p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}^d} \\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})d\\mathbf{v} \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}^d} \\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid \\mathbf{v})p(\\mathbf{v})d\\mathbf{v} \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}^d} \\log\\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid \\mathbf{v})p(\\mathbf{v})d\\mathbf{v}\\quad \\bigotimes \\quad ( not \\: intractable) \\end{align} $$ ç”±ä¸Šå¼å¯çŸ¥ï¼Œç›´æ¥æ±‚è§£$ \\boldsymbol{\\theta}^d $ä½¿å¾—$ \\log\\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid \\mathbf{v})p(\\mathbf{v})d\\mathbf{v} $æœ€å¤§åŒ–å¾€å¾€ä¸å¯èƒ½ï¼Œæˆ‘ä»¬åº”è¯¥æ‰¾åˆ°$ \\log\\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid \\mathbf{v})p(\\mathbf{v})d\\mathbf{v} $çš„ä¸€ä¸ªä¾¿äºæ±‚è§£$ \\boldsymbol{\\theta}^d $çš„ä¸‹ç•Œ$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^d)\\mathrm{\\:Evidence \\:Lower\\:BOund} $ï¼Œä½¿å¾—æ›´æ–°$ \\boldsymbol{\\theta}^d $è®©ä¸‹ç•Œ$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^d) $å˜å¤§çš„åŒæ—¶ï¼Œèƒ½å¤Ÿé—´æ¥åœ°ä½¿å¾—$ \\log\\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid \\mathbf{v})p(\\mathbf{v})d\\mathbf{v} $å¢å¤§ã€‚\n$$ \\begin{align} \\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x})\u0026=\\log\\int p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})d\\mathbf{v} \\\\ \u0026= \\log \\int q(\\mathbf{v})\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})}{q(\\mathbf{v})}d\\mathbf{v} \\\\ \u0026\\geq \\int q(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})}{q(\\mathbf{v})}d\\mathbf{v} \\quad (\\mathrm{Jensen's\\:inequality}) \\end{align} $$ å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å–ä¸‹ç•Œä¸º\n$$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^d) = \\int q(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})}{q(\\mathbf{v})}d\\mathbf{v} $$ å®é™…æ“ä½œä¸­$ \\mathbf{v} $çš„æ¦‚ç‡åˆ†å¸ƒ$ q(\\mathbf{v}) $é€šå¸¸ä¹Ÿæ˜¯ç”±ç¼–ç å™¨æ¨¡å‹ç”Ÿæˆï¼Œä¹Ÿå°±æ˜¯è¯´ä¸‹ç•Œ$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^d) $æ›´ä¸ºè§„èŒƒçš„å†™æ³•ä¸º$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^e, \\boldsymbol{\\theta}^d) $\n$$ \\begin{align} \\mathrm{ELBO}(\\boldsymbol{\\theta}^e, \\boldsymbol{\\theta}^d) \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}, \\mathbf{v})}{q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})}d\\mathbf{v} \\\\ \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{v}\\mid\\mathbf{x})p_{\\boldsymbol{\\theta}^d}(\\mathbf{x})}{q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})}d\\mathbf{v} \\\\ \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x})d\\mathbf{v} + \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{v}\\mid\\mathbf{x})}{q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})}d\\mathbf{v} \\quad (one\\:perspective) \\\\ \u0026= \\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}) - \\mathrm{D}_{\\mathrm{KL}}\\Big[q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})||p_{\\boldsymbol{\\theta}^d}(\\mathbf{v}\\mid\\mathbf{x})\\Big] \\\\ \\\\ \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log\\frac{p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid\\mathbf{v})p(\\mathbf{v})}{q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})}d\\mathbf{v} \\\\ \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid\\mathbf{v})d\\mathbf{v} + \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log\\frac{p(\\mathbf{v})}{q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})}d\\mathbf{v}\\quad (another\\:perspective) \\\\ \u0026= \\int q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid\\mathbf{v})d\\mathbf{v} - \\mathrm{D}_{\\mathrm{KL}}\\Big[q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})||p(\\mathbf{v})\\Big] \\\\ \u0026\\approx \\log p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}\\mid\\mathbf{v}^*) - \\mathrm{D}_{\\mathrm{KL}}\\Big[q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})||p(\\mathbf{v})\\Big] \\quad (Monte\\:Carlo\\:estimate) \\end{align} $$ ä¸Šè¿°å…¬å¼ä¸­$ q_{\\boldsymbol{\\theta}^e}(\\mathbf{v})\\approx q_{\\boldsymbol{\\theta}^e}(\\mathbf{v}\\mid \\mathbf{x})=\\mathcal{N}(\\mathbf{v}\\mid f_{e}^{\\boldsymbol{\\mu}}(\\mathbf{x}, \\boldsymbol{\\theta}^e), f_{e}^{\\boldsymbol{\\Sigma}}(\\mathbf{x}, \\boldsymbol{\\theta}^e)) $ï¼Œ$ p(\\mathbf{v})=\\mathcal{N}(\\mathbf{v}|0, 1) $ï¼Œ$ \\mathbf{v}^* $ä¹Ÿæ˜¯ä»åˆ†å¸ƒä¸­$ q_{\\boldsymbol{\\theta}^e}(\\mathbf{v}\\mid \\mathbf{x}) $æŠ½æ ·å¾—åˆ°ã€‚ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æœ€å¤§åŒ–$ \\mathrm{ELBO}(\\boldsymbol{\\theta}^e, \\boldsymbol{\\theta}^d) $æ¥è¿›è¡Œä¼˜åŒ–æ¨¡å‹ä»è€Œå¯¹$ p_{\\boldsymbol{\\theta}^d}(\\mathbf{x}) $è¿›è¡Œå»ºæ¨¡ã€‚\n$ \\mathrm{Diffusion\\:Models} $ $ \\mathrm{Diffusion\\:Models} $çš„ç›®æ ‡ä¹Ÿæ˜¯è®­ç»ƒå‡ºä¸€ä¸ªè§£ç å™¨$ \\hat{\\mathbf{x}} = f_{d}(\\mathbf{v}, \\boldsymbol{\\theta}): \\mathcal{V}\\to \\mathcal{X} $å°†æ½œåœ¨ç©ºé—´$ \\mathcal{V} $ä¸­å¾ˆå¥½æ˜ å°„åˆ°æ ·æœ¬ç©ºé—´$ \\mathcal{X} $ã€‚å’Œ$ \\mathrm{VAE} $ä¸€æ ·ï¼Œ$ \\mathrm{Diffusion\\:Models} $çš„ç›®æ ‡ä¹Ÿæ˜¯æœ€å¤§åŒ–$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}) $æ¥å®ç°è®­ç»ƒè¯¥è§£ç å™¨çš„ï¼Œä½†æ˜¯$ \\mathrm{Diffusion\\:Models} $çš„æ½œåœ¨å˜é‡$ \\mathbf{v} $é€šå¸¸æ˜¯é€šè¿‡åŸå§‹è¾“å…¥$ \\mathbf{x} $é€æ¸åŠ å™ªå¾—åˆ°çš„ï¼Œè€Œè§£ç å™¨å­¦ä¹ ä»æ½œåœ¨å˜é‡$ \\mathbf{v} $ä¸€æ­¥æ­¥ç”Ÿæˆé€¼çœŸçš„æ ·æœ¬ã€‚è¿™ä¸€è¿‡ç¨‹çš„å½¢å¼åŒ–è¡¨ç¤ºå¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºäº†æ–¹ä¾¿æ¨å¯¼å…¬å¼ç®€åŒ–ï¼Œä»¤$ \\mathbf{v} = \\mathbf{z}_{T} $\n$$ \\mathrm{forward\\:process}: \\mathbf{x}\\to \\mathbf{z}_{1}\\to \\mathbf{z}_{2}\\to\\dots\\to \\mathbf{z}_{T-1}\\to\\mathbf{z}_{T}\\quad(\\mathbf{v}) $$ $$ \\mathrm{reverse\\:process}: (\\mathbf{v})\\quad\\mathbf{z}_{T}\\to \\mathbf{z}_{T-1}\\to \\mathbf{z}_{T-2}\\to\\dots\\to \\mathbf{z}_{1}\\to\\mathbf{x} $$ æ ¹æ®ä¸Šè¿°æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}) $æœ€å¤§åŒ–æ±‚è§£$ \\boldsymbol{\\theta} $\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML} \u0026= \\arg\\max_{\\boldsymbol{\\theta}}p_{\\boldsymbol{\\theta}}(\\mathbf{x}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}}\\int p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})d\\mathbf{z}_{1\\dots T} \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}}\\log \\int p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})d\\mathbf{z}_{1\\dots T} \\quad \\bigotimes \\quad ( not \\: intractable) \\end{align} $$ å’Œ$ \\mathrm{VAE} $ä¸€æ ·ï¼Œæˆ‘ä»¬å¯»æ‰¾$ \\log \\int p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1}, \\mathbf{z}_{2}, \\dots, \\mathbf{z}_{T-1}, \\mathbf{v})d\\mathbf{z}_{1}d\\mathbf{z}_{2}\\dots d\\mathbf{z}_{T-1}d\\mathbf{v} $çš„ä¸€ä¸ªä¾¿äºä¼˜åŒ–çš„ä¸‹ç•Œ$ \\mathrm{ELBO}(\\boldsymbol{\\theta})\\mathrm{\\:Evidence \\:Lower\\:BOund} $æ¥å¯¹$ \\boldsymbol{\\theta} $è¿›è¡Œä¼˜åŒ–æ±‚è§£\n$$ \\begin{align} \\log p_{\\boldsymbol{\\theta}}(\\mathbf{x}) \u0026= \\log \\int p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})d\\mathbf{z}_{1\\dots T}\\\\ \u0026= \\log\\left[ \\int q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x}) \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})}{q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x})}d\\mathbf{z}_{1\\dots T}\\right] \\\\ \u0026\\geq \\int q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x}) \\log \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})}{q(\\mathbf{z}_{1\\dots T} \\mid \\mathbf{x})}d\\mathbf{z}_{1\\dots T} \\quad (\\mathrm{Jensen's\\:inequality}) \\end{align} $$ ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥å–è¯æ®ä¸‹ç•Œ\n$$ \\mathrm{ELBO}(\\boldsymbol{\\theta}) = \\int q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x}) \\log \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})}{q(\\mathbf{z}_{1\\dots T} \\mid \\mathbf{x})}d\\mathbf{z}_{1\\dots T} $$ åœ¨$ \\mathrm{VAE} $ä¸­ï¼Œç¼–ç å™¨é€šè¿‡å‚æ•°æ¥å­¦ä¹ ç»™å®šè¾“å…¥ä¸‹æ½œåœ¨å˜é‡çš„åéªŒæ¦‚ç‡åˆ†å¸ƒ$ q_{\\boldsymbol{\\theta}^e}(\\mathbf{v}\\mid \\mathbf{x}) $ï¼Œä½†æ˜¯åœ¨$ \\mathrm{Diffusion\\:Models} $ä¸­çš„ç¼–ç å™¨æ˜¯æ²¡æœ‰å‚æ•°çš„ï¼Œå› æ­¤è§£ç å™¨çš„å‚æ•°åœ¨æ›´æ–°æ—¶åº”å½“è€ƒè™‘ä½¿å¾—æ— å‚æ•°ç¼–ç å™¨å°½å¯èƒ½è¿‘ä¼¼åéªŒæ¦‚ç‡åˆ†å¸ƒ$ p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{1}, \\mathbf{z}_{2}, \\dots, \\mathbf{z}_{T-1}, \\mathbf{v}\\mid \\mathbf{x}) $ã€‚\nä¸‹é¢å¯¹$ \\mathrm{ELBO}(\\boldsymbol{\\theta}) $ä¸­çš„$ \\log $é¡¹è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ†æç®€åŒ–ï¼Œ\n$$ \\begin{align} \\log \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})}{q(\\mathbf{z}_{1\\dots T} \\mid \\mathbf{x})} \u0026= \\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\prod_{t=2}^Tp_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})\\cdot p(\\mathbf{z}_{T})}{q(\\mathbf{z}_{1}\\mid\\mathbf{x})\\prod_{t=2}^Tq(\\mathbf{z}_{t}\\mid \\mathbf{z}_{t-1})} \\right]\\\\ \u0026= \\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})}{q(\\mathbf{z}_{1}\\mid \\mathbf{x})} \\right] + \\log\\left[ \\frac{\\prod_{t=2}^Tp_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{\\prod_{t=2}^Tq(\\mathbf{z}_{t}\\mid \\mathbf{z}_{t-1})} \\right] + \\log[p(\\mathbf{z}_{T})] \\\\ \u0026= \\log\\left[ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\right] + \\log\\left[ \\frac{\\prod_{t=2}^Tp_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{\\prod_{t=2}^Tq(\\mathbf{z}_{t - 1}\\mid \\mathbf{z}_{t}, \\mathbf{x})} \\right] + \\log\\left[ \\frac{p(\\mathbf{z}_{T})}{q(\\mathbf{z}_{T}\\mid \\mathbf{x})} \\right]\\quad (Bayes'\\:rule) \\\\ \u0026\\approx \\log\\left[ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\right] + \\sum_{t=2}^{T}\\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{q(\\mathbf{z}_{t - 1}\\mid \\mathbf{z}_{t}, \\mathbf{x})} \\right] \\end{align} $$ æ‰€ä»¥$ \\mathrm{ELBO}(\\boldsymbol{\\theta}) $å¯ä»¥è½¬å˜ä¸º\n$$ \\begin{align} \\mathrm{ELBO}(\\boldsymbol{\\theta}) \u0026= \\int q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x}) \\log \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{x}, \\mathbf{z}_{1\\dots T})}{q(\\mathbf{z}_{1\\dots T} \\mid \\mathbf{x})}d\\mathbf{z}_{1\\dots T} \\\\ \u0026\\approx \\int q(\\mathbf{z}_{1\\dots T}\\mid \\mathbf{x})\\left(\\log\\left[ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\right] + \\sum_{t=2}^{T}\\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{q(\\mathbf{z}_{t - 1}\\mid \\mathbf{z}_{t}, \\mathbf{x})} \\right]\\right)d\\mathbf{z}_{1\\dots T} \\\\ \u0026= \\int q(\\mathbf{z}_{1}\\mid \\mathbf{x})\\log\\left[ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\right]d\\mathbf{z}_{1} + \\sum_{t=2}^{T}\\int q(\\mathbf{z}_{t-1}, \\mathbf{z}_{t}\\mid \\mathbf{x})\\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{q(\\mathbf{z}_{t - 1}\\mid \\mathbf{z}_{t}, \\mathbf{x})} \\right]d\\mathbf{z}_{t-1}d\\mathbf{z}_{t} \\\\ \u0026= \\int q(\\mathbf{z}_{1}\\mid \\mathbf{x})\\log\\left[ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})\\right]d\\mathbf{z}_{1} + \\sum_{t=2}^{T}\\int q(\\mathbf{z}_{t}\\mid\\mathbf{x})q(\\mathbf{z}_{t-1}\\mid \\mathbf{z}_{t}, \\mathbf{x})\\log\\left[ \\frac{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})}{q(\\mathbf{z}_{t - 1}\\mid \\mathbf{z}_{t}, \\mathbf{x})} \\right]d\\mathbf{z}_{t-1}d\\mathbf{z}_{t} \\quad (Bayes'\\:rule) \\\\ \u0026= \\int \\textcolor{blue}{q(\\mathbf{z}_{1}\\mid \\mathbf{x})}\\log\\left[ \\textcolor{green}{p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})}\\right]d\\mathbf{z}_{1} - \\sum_{t=2}^{T}\\int \\textcolor{red}{q(\\mathbf{z}_{t}\\mid\\mathbf{x})}\\mathrm{D}_{\\mathrm{KL}}(\\textcolor{purple}{q(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t}, \\mathbf{x})}||\\textcolor{pink}{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})})d\\mathbf{z}_{t} \\end{align} $$ ä¸Šè¿°$ \\mathrm{ELBO}(\\boldsymbol{\\theta}) $çš„æ‰€æœ‰æ ‡æ˜é¢œè‰²çš„æ¦‚ç‡åˆ†å¸ƒéƒ½å¯ä»¥é€šè¿‡æ­£æ€åˆ†å¸ƒå»ºæ¨¡å‡ºæ¥\n$$ \\textcolor{green}{p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid\\mathbf{z}_{1})} = \\mathcal{N}\\left(\\mathbf{x}\\mid f_{d}(\\mathbf{z}_{1}, \\boldsymbol{\\theta}), \\sigma_{1}^2\\mathbf{I}\\right) $$ $$ \\textcolor{pink}{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})} = \\mathcal{N}\\left(\\mathbf{z}_{t-1}\\mid f_{d}(\\mathbf{z}_{t}, \\boldsymbol{\\theta}), \\sigma_{t}^2\\mathbf{I}\\right) $$ å‰å‘è¿‡ç¨‹($ \\mathrm{Forward\\:Process} $) $$ \\mathbf{z}_{1} = \\sqrt{ 1-\\beta_{1} }\\mathbf{x} + \\sqrt{ \\beta_{1} }\\boldsymbol{\\epsilon}_{1} $$ $$ \\mathbf{z}_{t} = \\sqrt{ 1-\\beta_{t} }\\mathbf{z}_{t-1} + \\sqrt{ \\beta_{t} }\\boldsymbol{\\epsilon}_{t}\\quad\\quad \\forall t\\in 2, \\dots, T $$ å…¶ä¸­$ \\boldsymbol{\\epsilon}_{t} $æ˜¯ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒä¸­æŠ½å–çš„å™ªå£°($ \\boldsymbol{\\epsilon}_{t}\\sim \\mathcal{N}(\\mathbf{0}, \\mathbf{I}) $)ï¼Œå‰å‘è¿‡ç¨‹çš„ç¬¬ä¸€é¡¹è¡°å‡äº†æ•°æ®ä»¥åŠè‡³ä»Šæ·»åŠ çš„ä»»ä½•å™ªå£°ï¼Œç¬¬äºŒé¡¹å¢åŠ äº†æ›´å¤šçš„å™ªå£°ã€‚è¶…å‚æ•°$ \\beta_{t} $åˆ™å†³å®šäº†å™ªå£°çš„æ··åˆé€Ÿåº¦ã€‚æ–¹ç¨‹å½¢å¼è½¬åŒ–æˆæ¦‚ç‡å½¢å¼å¦‚ä¸‹\n$$ \\textcolor{blue}{q(\\mathbf{z}_{1}\\mid\\mathbf{x})} = \\mathcal{N}(\\mathbf{z}_{1}|\\sqrt{ 1-\\beta_{1} }\\mathbf{x}, \\beta_{1}\\mathbf{I}) $$ $$ q(\\mathbf{z}_{t}\\mid\\mathbf{z}_{t-1}) = \\mathcal{N}(\\mathbf{z}_{t}|\\sqrt{ 1 - \\beta_{t} }\\mathbf{z}_{t-1}, \\beta_{t}\\mathbf{I}) $$ ä¸Šè¿°è¿‡ç¨‹å½¢æˆäº†ä¸€ä¸ª$ Markov $é“¾ï¼Œå½“$ T $è¶³å¤Ÿå¤§æ—¶ï¼Œ$ q(\\mathbf{z}_{T}|\\mathbf{x})=q(\\mathbf{z}_{T}) $å°±ä¼šæˆä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒã€‚å·²çŸ¥ä»¥ä¸Šæ¦‚ç‡åˆ†å¸ƒæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ¨å¯¼å‡º$ \\textcolor{purple}{q(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t}, \\mathbf{x})} $\n$$ \\textcolor{purple}{q(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t}, \\mathbf{x})} = \\mathcal{N}\\left( \\mathbf{z}_{t-1}\\mid \\frac{1-\\alpha_{t-1}}{1-\\alpha_{t}}\\sqrt{ 1-\\beta_{t} }\\mathbf{z}_{t} + \\frac{\\sqrt{ \\alpha_{t-1} }\\beta_{t}}{1 - \\alpha_{t}}\\mathbf{x}, \\frac{\\beta_{t}(1 - \\alpha_{t-1})}{1 - \\alpha_{t}}\\mathbf{I} \\right) $$ å…¶ä¸­$ \\alpha_{t} = \\prod_{s=1}^{t}1 - \\beta_{s} $ã€‚\næ‰©æ•£æŸå¤± åŸå§‹æ‰©æ•£æŸå¤± ç»è¿‡æ­£æ€åˆ†å¸ƒå»ºæ¨¡åï¼ŒåŸå§‹æ‰©æ•£æŸå¤±ä¸º\n$$ \\begin{align} -\\mathrm{ELBO}(\\boldsymbol{\\theta}) \u0026= \\sum_{n=1}^N\\Big( -\\log[\\mathcal{N}(\\mathbf{x}_{n}\\mid f_{d}(\\mathbf{z}_{n1}, \\boldsymbol{\\theta}), \\sigma_{1}^2\\mathbf{I})] \\\\ \u0026\\quad\\quad+ \\frac{1}{2\\sigma^2}\\sum_{t=2}^T\\Big\\lvert\\Big\\lvert \\frac{1 - \\alpha_{t-1}}{1 - \\alpha_{t}}\\sqrt{ 1 - \\beta_{t} } \\mathbf{z}_{nt} + \\frac{\\sqrt{ \\alpha_{t - 1} }\\beta_{t}}{1 - \\alpha_{t}}\\mathbf{x}_{n} - f_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta})\\Big\\rvert\\Big\\rvert^2 \\Big) \\end{align} $$ é‡å‚æ•°åŒ–æ‰©æ•£æŸå¤± ç”±å‰å‘è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥æ¨å¯¼å¾—åˆ°\n$$ \\mathbf{z}_{t} = \\sqrt{ \\alpha_{t} }\\cdot \\mathbf{x} + \\sqrt{ 1 - \\alpha_{t} }\\boldsymbol{\\epsilon} $$ $$ \\mathbf{x} = \\frac{1}{\\sqrt{ \\alpha_{t} }}\\cdot \\mathbf{z}_{t} - \\frac{\\sqrt{ 1 - \\alpha_{t} }}{\\sqrt{ \\alpha_{t} }}\\cdot\\boldsymbol{\\epsilon} $$ å°†åŸå§‹æ‰©æ•£æŸå¤±ä¸­çš„$ \\mathbf{x} $æ›¿æ¢æˆ$ \\mathbf{z}_{t} $\n$$ \\begin{align} -\\mathrm{ELBO}(\\boldsymbol{\\theta}) \u0026= \\sum_{n=1}^N\\Big( -\\log[\\mathcal{N}(\\mathbf{x}_{n}\\mid f_{d}(\\mathbf{z}_{n1}, \\boldsymbol{\\theta}), \\sigma_{1}^2\\mathbf{I})] \\\\ \u0026\\quad\\quad+ \\sum_{t=2}^T\\frac{1}{2\\sigma_{t}^2}\\Big\\lvert \\Big\\lvert \\frac{1}{\\sqrt{ 1 - \\beta_{t} }} \\mathbf{z}_{nt} - \\frac{\\beta_{t}}{\\sqrt{ 1-\\alpha_{t} }\\sqrt{ 1-\\beta_{t} }}\\boldsymbol{\\epsilon}_{nt} - f_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta})\\Big\\rvert\\Big\\rvert^2 \\Big) \\\\ \u0026= \\sum_{n=1}^N \\Big(\\frac{1}{2\\sigma_{1}^2}\\Big\\lvert \\Big\\lvert \\mathbf{x}_{n} - f_{d}(\\mathbf{z}_{n1}, \\boldsymbol{\\theta})\\Big\\rvert\\Big\\rvert^2 + \\sum_{t=2}^T\\frac{\\beta_{t}^2}{(1 - \\alpha_{t})(1 - \\beta_{t})2\\sigma_{t}^2}\\Big\\lvert \\Big\\lvert g_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta}) - \\boldsymbol{\\epsilon}_{nt}\\Big\\rvert\\Big\\rvert^2 + C_{n}\\Big)\\quad(Reparameterization\\:of\\:network) \\\\ \\\\ \u0026= \\sum_{n=1}^N\\sum_{t=1}^T\\frac{\\beta_{t}^2}{(1 - \\alpha_{t})(1 - \\beta_{t})2\\sigma_{t}^2}\\Big\\lvert \\Big\\lvert g_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta}) - \\boldsymbol{\\epsilon}_{nt}\\Big\\rvert\\Big\\rvert^2 + C_{n} \\end{align} $$ å…¶ä¸­ç½‘ç»œé‡å‚æ•°åŒ–ä½¿ç”¨å¦‚ä¸‹å…¬å¼$ f_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta}) = \\frac{1}{\\sqrt{ 1 - \\beta_{t} }} \\mathbf{z}_{nt} - \\frac{\\beta_{t}}{\\sqrt{ 1-\\alpha_{t} }\\sqrt{ 1-\\beta_{t} }}g_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta}) $ã€‚æœ‰äº†ä¸Šé¢çš„ç®€çº¦å½¢å¼æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥å¯¹æŸå¤±è¿›è¡Œç®€åŒ–\n$$ \\begin{align} \\mathcal{L}(\\boldsymbol{\\theta}) \u0026= \\sum_{n=1}^N\\sum_{t=1}^T\\Big\\lvert \\Big\\lvert g_{d}(\\mathbf{z}_{nt}, \\boldsymbol{\\theta}) - \\boldsymbol{\\epsilon}_{nt}\\Big\\rvert\\Big\\rvert^2 \\\\ \u0026= \\sum_{n=1}^N\\sum_{t=1}^T\\Big\\lvert \\Big\\lvert g_{d}(\\sqrt{ \\alpha_{t} }\\mathbf{x}_{n} + \\sqrt{ 1-\\alpha_{t} }\\boldsymbol{\\epsilon}_{nt}, \\boldsymbol{\\theta}) - \\boldsymbol{\\epsilon}_{nt}\\Big\\rvert\\Big\\rvert^2 \\end{align} $$ åå‘è¿‡ç¨‹($ \\mathrm{Reverse\\:(Sampling)\\: Process} $) ç”±å¼å­$ \\textcolor{pink}{p_{\\boldsymbol{\\theta}}(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t})} = \\mathcal{N}\\left(\\mathbf{z}_{t-1}\\mid f_{d}(\\mathbf{z}_{t}, \\boldsymbol{\\theta}), \\sigma_{t}^2\\mathbf{I}\\right) $å¯ä»¥å°†æ¦‚ç‡å½¢å¼è½¬åŒ–æˆå¦‚ä¸‹æ–¹ç¨‹å½¢å¼\n$$ \\begin{align} \\mathbf{z}_{t-1} \u0026= f_{d}(\\mathbf{z}_{t}, \\boldsymbol{\\theta}) + \\sigma_{t}\\boldsymbol{\\epsilon}_{t} \\\\ \u0026= \\frac{1}{\\sqrt{ 1 - \\beta_{t} }} \\mathbf{z}_{t} - \\frac{\\beta_{t}}{\\sqrt{ 1-\\alpha_{t} }\\sqrt{ 1-\\beta_{t} }}g_{d}(\\mathbf{z}_{t}, \\boldsymbol{\\theta}) + \\sigma_{t}\\boldsymbol{\\epsilon}_{t} \\\\ \\end{align} $$ å†ç”±å¼å­$ \\textcolor{purple}{q(\\mathbf{z}_{t-1}\\mid\\mathbf{z}_{t}, \\mathbf{x})} = \\mathcal{N}\\left( \\mathbf{z}_{t-1}\\mid \\frac{1-\\alpha_{t-1}}{1-\\alpha_{t}}\\sqrt{ 1-\\beta_{t} }\\mathbf{z}_{t} + \\frac{\\sqrt{ \\alpha_{t-1} }\\beta_{t}}{1 - \\alpha_{t}}\\mathbf{x}, \\frac{\\beta_{t}(1 - \\alpha_{t-1})}{1 - \\alpha_{t}}\\mathbf{I} \\right) $ï¼Œå¯ä»¥ä¼°è®¡$ \\sigma_{t}^2\\approx\\frac{\\beta_{t}(1 - \\alpha_{t-1})}{1 - \\alpha_{t}}\\approx \\beta_{t} $ï¼Œé‚£ä¹ˆåå‘è¿‡ç¨‹å¯ä»¥æ±‚å¾—ã€‚\nè‡ªç›‘ç£å­¦ä¹  å·²æœ‰æ•°æ®é›†$ \\mathcal{D}=\\lbrace{\\mathbf{x}_{i}}\\rbrace_{i=1}^{N} $ï¼Œé€šè¿‡æ•°æ®é›†$ \\mathcal{D} $è‡ªèº«ç”Ÿæˆâ€œä¼ªæ ‡ç­¾â€æˆ‘ä»¬ç»„æˆäº†æ–°çš„å¸¦æœ‰ä¼ªæ ‡ç­¾çš„æ•°æ®é›†$ \\mathcal{D}_{fake}=\\lbrace{\\mathbf{x}_{i}}, \\hat{y}_{i}\\rbrace_{i=1}^{N} $æˆ–$ \\mathcal{D}_{fake}=\\lbrace{\\mathbf{x}_{i}}, \\hat{\\mathbf{y}}_{i}\\rbrace_{i=1}^{N} $ã€‚è‡ªç›‘ç£å­¦ä¹ çš„æ€è·¯æ˜¯è®©å­¦ä¹ è¿‡çš„æ¨¡å‹$ \\mathbf{z} = f(\\mathbf{x}, \\boldsymbol{\\theta}) $å°†åŸå§‹è¾“å…¥ç©ºé—´$ \\mathcal{X} $æ˜ å°„åˆ°æ½œåœ¨ç©ºé—´$ \\mathcal{Z} $ï¼Œåœ¨è¯¥æ½œåœ¨ç©ºé—´ä¸Šå„ä¸ªä¼ªæ ‡ç­¾çš„åŒºåˆ†åº¦å°½å¯èƒ½å¤§ã€‚ä»è¿™ä¸€æ–¹é¢æ¥è¯´ï¼Œè‡ªç›‘ç£å­¦ä¹ å¯ä»¥çœ‹ä½œåœ¨æ•°æ®é›†$ D_{fake} $ä¸Šè¿›è¡Œæœ‰ç›‘ç£å­¦ä¹ ã€‚ä½†æ˜¯ä¼ªæ ‡ç­¾æ¯•ç«Ÿä¸æ˜¯çœŸå®æ ‡ç­¾ï¼Œè‡ªç›‘ç£å­¦ä¹ ä¸»è¦æ˜¯è®©æ¨¡å‹é€šè¿‡å­¦ä¹ $ p(\\hat{y}\\mid\\mathbf{x}) $æˆ–$ p(\\hat{\\mathbf{y}}\\mid\\mathbf{x}) $å»ºç«‹åŸå§‹è¾“å…¥$ \\mathbf{x}_{i} $çš„æ½œåœ¨è¡¨ç¤º$ \\mathbf{z}_{i} $ï¼Œç„¶åå†åº”ç”¨åˆ°ä¸€ç³»åˆ—å…·æœ‰çœŸå®æ ‡ç­¾çš„ä¸‹æ¸¸ä»»åŠ¡ã€‚\nå¯¹æ¯”å­¦ä¹  å¯¹æ¯”å­¦ä¹ ä½œä¸ºå½“å‰è‡ªç›‘ç£å­¦ä¹ é¢†åŸŸçš„çƒ­é—¨ç ”ç©¶æ–¹å‘ï¼Œå…¶ç›®æ ‡æ˜¯è®©æ¨¡å‹ä¸ä¾èµ–äººå·¥æ ‡ç­¾è‡ªåŠ¨å­¦ä¹ åˆ°æœ‰åŒºåˆ†åŠ›çš„ç‰¹å¾è¡¨ç¤ºã€‚æ ¸å¿ƒæ€æƒ³å°±æ˜¯ä½¿å¾—ç›¸ä¼¼çš„æ ·æœ¬ç»è¿‡æ¨¡å‹æ˜ å°„åçš„ç‰¹å¾å°½å¯èƒ½é è¿‘ï¼Œä¸åŒçš„æ ·æœ¬ç»è¿‡æ¨¡å‹æ˜ å°„åçš„ç‰¹å¾å°½å¯èƒ½åˆ†å¼€ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ¨¡å‹$ f(\\mathbf{x}, \\mathbf{x}^{'}, \\boldsymbol{\\theta}) $éœ€è¦å­¦ä¹ æ¦‚ç‡åˆ†å¸ƒ$ p(y\\mid \\mathbf{x}, \\mathcal{X}^{'}) $ä½¿ä¹‹æœ€å¤§åŒ–ï¼Œå…¶ä¸­$ \\mathcal{X}^{'} = \\lbrace\\mathbf{x}_{1}^{'}, \\dots, \\mathbf{x}_{M}^{'}\\rbrace $ï¼Œ$ y $çš„å®šä¹‰ä¸ºæ­£æ ·æœ¬çš„ç´¢å¼•$ y = \\lbrace 1, \\dots, M\\rbrace $ã€‚ç”±è´å¶æ–¯å‡†åˆ™å¯çŸ¥ï¼Œ$ p(y\\mid \\mathbf{x}, \\mathcal{X}^{'}) \\propto p(\\mathcal{X}^{'}\\mid\\mathbf{x}, y)p(y) $ã€‚å‡è®¾æ­£æ ·æœ¬æ¥è‡ªçœŸå®çš„æ¡ä»¶åˆ†å¸ƒ$ p_{data}(\\mathbf{x}^{'}\\mid \\mathbf{x}) $ï¼Œè´Ÿæ ·æœ¬æ¥è‡ªå™ªå£°åˆ†å¸ƒ$ q(\\mathbf{x}^{'}) $ï¼Œæœ‰æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾å¯å¾—$ p(\\mathcal{X}^{'}\\mid\\mathbf{x}, y) = p_{data}(\\mathbf{x}^{'}_{y}\\mid\\mathbf{x})\\prod_{j\\neq y}q(\\mathbf{x}_{j}^{'}) $ã€‚é‚£ä¹ˆç»è¿‡å½’ä¸€åŒ–ä¹‹å$ p(y\\mid \\mathbf{x}, \\mathcal{X}^{'}) = \\dfrac{\\frac{p_{data}(\\mathbf{x}^{'}_{y}\\mid\\mathbf{x})}{q(\\mathbf{x}_{y}^{'})}}{\\sum_{k=1}^{M}\\dfrac{p_{data}(\\mathbf{x}^{'}_{k}\\mid\\mathbf{x})}{q(\\mathbf{x}_{k}^{'})}} $ã€‚ç”±ä¸Šè¿°å…¬å¼çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‚æ•°åŒ–å¯†åº¦æ¯”$ f(\\mathbf{x}, \\mathbf{x}^{'}, \\boldsymbol{\\theta})\\approx\\frac{p_{data}(\\mathbf{x}^{'}\\mid\\mathbf{x})}{q(\\mathbf{x}^{'})} $ï¼Œæ‰€ä»¥$ p_{\\boldsymbol{\\theta}}(y\\mid \\mathbf{x}, \\mathcal{X}^{'})=\\frac{f(\\mathbf{x}, \\mathbf{x}_{y}^{'}, \\boldsymbol{\\theta})}{\\sum_{k=1}^Mf(\\mathbf{x}, \\mathbf{x}_{k}^{'}, \\boldsymbol{\\theta})} $ã€‚\nä¸Šè¿°è¡¨è¿°çš„æ•°å­¦å½¢å¼å¦‚ä¸‹\n$$ \\begin{align} \\boldsymbol{\\theta}_{ML} \u0026= \\arg\\max_{\\boldsymbol{\\theta}} \\prod_{i=1}^{N} p_{\\boldsymbol{\\theta}}(y_{i}\\mid\\mathbf{x}_{i}, \\mathcal{X}^{'})\\quad (i.i.d.) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}}\\sum_{i=1}^{N}\\log p_{\\boldsymbol{\\theta}}(y_{i}\\mid\\mathbf{x}_{i}, \\mathcal{X}^{'}) \\\\ \u0026= \\arg\\max_{\\boldsymbol{\\theta}}\\sum_{i=1}^{N}\\log \\frac{f(\\mathbf{x}_{i}, \\mathbf{x}_{y_{i}}^{'}, \\boldsymbol{\\theta})}{\\sum_{k=1}^Mf(\\mathbf{x}_{i}, \\mathbf{x}_{k}^{'}, \\boldsymbol{\\theta})} \\\\ \u0026= \\arg\\min_{\\boldsymbol{\\theta}}-\\frac{1}{N}\\sum_{i=1}^{N}\\log \\frac{f(\\mathbf{x}_{i}, \\mathbf{x}_{y_{i}}^{'}, \\boldsymbol{\\theta})}{\\sum_{k=1}^Mf(\\mathbf{x}_{i}, \\mathbf{x}_{k}^{'}, \\boldsymbol{\\theta})} \\\\ \u0026= \\arg\\min_{\\boldsymbol{\\theta}}\\frac{1}{N}\\sum_{i=1}^N\\log\\left[ 1 + \\frac{\\sum_{k\\neq y_{i}}f(\\mathbf{x}_{i}, \\mathbf{x}_{k}', \\boldsymbol{\\theta})}{f(\\mathbf{x}_{i}, \\mathbf{x}_{y_{i}}',\\boldsymbol{\\theta})} \\right] \\\\ \u0026= \\arg\\min \\mathbb{E}_{\\mathbf{x}}\\left[\\log\\left[1 + \\frac{q(\\mathbf{x}_{y_{i}}^{'})}{p_{data}(\\mathbf{x}_{y_{i}}^{'}\\mid\\mathbf{x})}\\sum_{k\\neq y_{i}}\\frac{p_{data}(\\mathbf{x}_{k}^{'}\\mid\\mathbf{x})}{q(\\mathbf{x}_{k}^{'})}\\right]\\right] \\\\ \u0026\\approx \\arg\\min \\mathbb{E}_{\\mathbf{x}}\\left[\\log\\left[1 + \\frac{q(\\mathbf{x}_{y_{i}}^{'})}{p_{data}(\\mathbf{x}_{y_{i}}^{'}\\mid\\mathbf{x})}(M-1)\\sum_{k\\neq y_{i}}q(\\mathbf{x}_{k}')\\frac{p_{data}(\\mathbf{x}_{k}^{'}\\mid\\mathbf{x})}{q(\\mathbf{x}_{k}^{'})}\\right]\\right] \\\\ \u0026= \\arg\\min \\mathbb{E}_{\\mathbf{x}}\\left[\\log\\left[1 + \\frac{q(\\mathbf{x}_{y_{i}}^{'})}{p_{data}(\\mathbf{x}_{y_{i}}^{'}\\mid\\mathbf{x})}(M-1)\\right]\\right] \\\\ \u0026\\geq \\arg\\min \\mathbb{E}_{\\mathbf{x}}\\left[\\log \\left[\\frac{q(\\mathbf{x}_{y_{i}}^{'})}{p_{data}(\\mathbf{x}_{y_{i}}^{'}\\mid\\mathbf{x})}M\\right]\\right] \\\\ \u0026= \\arg\\min \\mathbb{E}_{\\mathbf{x}} \\left[\\log \\left[\\frac{q(\\mathbf{x}_{y_{i}}^{'})}{p_{data}(\\mathbf{x}_{y_{i}}^{'}\\mid\\mathbf{x})}M\\right]\\right] \\\\ \u0026= \\arg\\min -I(\\mathcal{X}', \\mathbf{x}) + \\log M \\end{align} $$ ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€å¤§åŒ–$ p(y\\mid \\mathbf{x}, \\mathcal{X}^{'}) $åŒæ—¶ä¹Ÿç­‰ä»·äºæœ€å¤§åŒ–$ \\mathcal{X}' $å’Œ$ \\mathbf{x} $çš„äº’ä¿¡æ¯ï¼Œåœ¨ä¼˜åŒ–æŸå¤±å‡½æ•°çš„è¿‡ç¨‹ä¸­ä½¿å¾—éšæœºå˜é‡$ \\mathbf{x} $å’Œå¯¹åº”çš„æ­£æ ·æœ¬$ \\mathcal{X}' $çš„è€¦åˆç¨‹åº¦å°½å¯èƒ½å¤§ï¼Œä¹Ÿå°±æ˜¯å°½å¯èƒ½ä¿æŒæ­£æ ·æœ¬å¯¹é½ã€‚\n","permalink":"https://fordelkon.github.io/posts/prob_dl/","summary":"\u003cp\u003eæˆ‘ä»¬å¯ä»¥ä»æ¦‚ç‡çš„è§’åº¦å»æ¢è®¨æ·±åº¦å­¦ä¹ ä»»åŠ¡ï¼Œå‡è®¾æˆ‘ä»¬å·²æœ‰æ•°æ®é›†\u003ccode\u003e$ \\mathcal{D}=\\lbrace(\\mathbf{x}_{i}, y_{i})\\rbrace_{i=1}^{N} $\u003c/code\u003eæˆ–\u003ccode\u003e$ \\mathcal{D}=\\lbrace\\mathbf{x}_{i}\\rbrace_{i=1}^{N} $\u003c/code\u003eï¼Œä¸»è¦åŒºåˆ†äºæœ‰æ ‡ç­¾å’Œæ— æ ‡ç­¾çš„æƒ…å†µã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°†å¸¸è§æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¸­æ¨¡å‹è¦å»ºæ¨¡çš„æ¦‚ç‡è¿›è¡Œå¦‚ä¸‹åŒºåˆ†\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæœ‰ç›‘ç£åˆ¤åˆ«ï¼šæ¨¡å‹æ ¹æ®è¾“å…¥é¢„æµ‹çœŸå®æ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒ\u003ccode\u003e$ p_{\\boldsymbol{\\theta}}(y\\mid\\mathbf{x}) $\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eè‡ªç›‘ç£åˆ¤åˆ«ï¼šæ¨¡å‹æ ¹æ®è¾“å…¥é¢„æµ‹ä¼ªæ ‡ç­¾çš„æ¦‚ç‡åˆ†å¸ƒ\u003ccode\u003e$ p_{\\boldsymbol{\\theta}}(\\hat{y}\\mid\\mathbf{x}) $\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eæœ‰ç›‘ç£ç”Ÿæˆï¼šæ¨¡å‹æ ¹æ®çœŸå®æ ‡ç­¾é¢„æµ‹ä¸æ ‡ç­¾å¯¹åº”çš„æ•°æ®é›†çš„ç©ºé—´åˆ†å¸ƒ\u003ccode\u003e$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}\\mid y) $\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eæ— ç›‘ç£ç”Ÿæˆï¼šæ¨¡å‹é¢„æµ‹æ•°æ®é›†çš„ç©ºé—´åˆ†å¸ƒ\u003ccode\u003e$ p_{\\boldsymbol{\\theta}}(\\mathbf{x}) $\u003c/code\u003e\nå…¶ä¸­\u003ccode\u003e$ \\mathbf{x} $\u003c/code\u003eå’Œ\u003ccode\u003e$ y $\u003c/code\u003eåˆ†åˆ«è¡¨ç¤ºè¾“å…¥å’Œæ ‡ç­¾çš„éšæœºå¼ é‡ï¼Œ\u003ccode\u003e$ \\boldsymbol{\\theta} $\u003c/code\u003eè¡¨ç¤ºæ¨¡å‹ä¸­å¯å­¦ä¹ çš„å‚æ•°ã€‚ä»æ¦‚ç‡è§’åº¦æ¢è®¨æ·±åº¦å­¦ä¹ ä»»åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬åº”å½“æ˜ç¡®å¦‚ä¸‹å‡è®¾ï¼š\u003cfont color=\"#c00000\"\u003eè¾“å…¥åˆ°æ¨¡å‹çš„æ•°æ®æ»¡è¶³ç‹¬ç«‹åŒåˆ†å¸ƒ(independent and identically distributed)\u003c/font\u003eã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ccenter\u003e\n  \u003cimg src=\"./img/prob_dl_summary.png\" alt=\"å›¾ç‰‡1\" width=\"400\"\u003e\n\u003c/center\u003e\n\u003ccenter\u003e\u003cstrong\u003eä¸åŒæ·±åº¦å­¦ä¹ ä»»åŠ¡æ‰€å­¦ä¹ çš„æ¦‚ç‡åˆ†å¸ƒæ€»ç»“\u003c/strong\u003e\u003c/center\u003e","title":"æ¦‚ç‡è§†è§’ä¸­çš„æ·±åº¦å­¦ä¹ "}]